//app.module.js
//mark.lawrence

(function () {
    angular.module('app',
    [
        //application modules
        'app.core',
        'app.service',
        'app.filter',

        //feature areas
        'app.nav',
        'app.home',
        'app.censors',
        'app.people',
        'app.settings',
        'app.users',
        'app.profile',
        'app.kiosk'
    ]).config(['$stateProvider', '$urlRouterProvider', config]).run(['$rootScope', 'logger', 'userService', function ($rootScope, logger, service) {
        logger.log('app running');
    }]);

    function config($stateProvider, $urlRouterProvider) {
        //$locationProvider.html5Mode(true);

        $stateProvider
            .state('home',
                    {
                        url: '/',
                        templateUrl: 'app/kiosk/views/home.html',
                        controller: 'KioskController',
                        controllerAs: 'vm',
                        resolve: {
                            censors: function (censorService) {
                                return censorService.get();
                            },
                            config: function (configurationService) {
                                return configurationService.get();
                            }
                        }
                    })
            .state('home.create',
                    {
                        url: 'create',
                        templateUrl: 'app/kiosk/views/partial-create.html'
                    })
            .state('home.search',
                    {
                        url: 'search',
                        templateUrl: 'app/kiosk/views/partial-search.html'
                    })
            .state('home.pledge',
                    {
                        url: 'pledge',
                        templateUrl: 'app/kiosk/views/partial-pledge.html'
                    })
            .state('home.list',
                    {
                        url: 'list',
                        templateUrl: 'app/kiosk/views/partial-list.html'
                    })
            .state('home.finish',
                    {
                        url: 'finish',
                        templateUrl: 'app/kiosk/views/partial-finish.html'
                    })
            .state('home.config',
                    {
                        url: 'configuration',
                        templateUrl: 'app/kiosk/views/partial-config.html'
                    });

        $urlRouterProvider.otherwise('/');
    };
})();
//core.module.js
//mark.lawrence

(function () {
    angular.module('app.core',
        [
            //angular modules
            'ngMessages',
            'angularLocalStorage',
            'ui.router',
            'ngAnimate',

            //custom modules
            'blocks.logger',
            'blocks.exception',

            //third party modules
            'smart-table',
            'ui.bootstrap',
            'ngTagsInput',
            'ngFileUpload',
            'rzModule',
            'switcher',
            'gfl.textAvatar'
        ])
        .constant('toastr', toastr)
        .constant('moment', moment);;
})();
//config.js
//mark.lawrence
(function () {
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.positionClass = 'toast-bottom-right';
    };

    var keyCodes = {
        backspace: 8,
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40,
        insert: 45,
        del: 46
    };

    var apiEndPoints = {
        Censor: 'censor',
        Person: 'person',
        User: 'users',
        Configuration: 'configuration'
    };

    var config = {
        appErrorPrefix: '[CRMC Error] ', //Configure the exceptionHandler decorator
        appTitle: 'CRMC',
        version: '1.0.0',
        apiUrl: 'http://' + window.location.host + '/api/',
        keyCodes: keyCodes,
        apiEndPoints: apiEndPoints
    };

    var defaults = {
        EMAIL_SUFFIX: '@splcenter.org',
        GENERIC_PASSWORD: '1P@ssword'
    };

    angular.module('app.core')
        .config(toastrConfig)
        .constant('config', config)
        .value('defaults', defaults);
})();
//mark.lawrence
//exception.module.js

(function () {
    angular.module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular.module('blocks.logger', []);
})();
//censors.module.js
//mark.lawrence

(function () {
    angular.module('app.censors', []);
})();
//settomgs.module.js
//mark.lawrence

(function () {
    angular.module('app.settings', []);
})();
//filter.module.js
//mark.lawrence

(function () {
    angular.module('app.filter', []);
})();
(function () {
    'use strict';

    angular.module('app.home', []);
})();
(function () {
    'use strict';

    angular.module('app.kiosk', []);
})();

//(function () {
//    "use strict";
//    angular.module('app.kiosk', []);

//    //app.config(['$stateProvider', '$urlRouterProvider', config]);

//    //function config($stateProvider, $urlRouterProvider) {
//    //    //$locationProvider.html5Mode(true);

//    //    $stateProvider
//    //        .state('home',
//    //                {
//    //                    url: '/',
//    //                    templateUrl: 'app/kiosk/views/home.html',
//    //                    controller: 'KioskController',
//    //                    controllerAs: 'vm',
//    //                    resolve: {
//    //                        censors: function (censorService) {
//    //                            return censorService.get();
//    //                        },
//    //                        config: function (configurationService) {
//    //                            return configurationService.get();
//    //                        }
//    //                    }
//    //                })
//    //        .state('home.create',
//    //                {
//    //                    url: 'create',
//    //                    templateUrl: 'app/kiosk/views/partial-create.html'
//    //                })
//    //        .state('home.search',
//    //                {
//    //                    url: 'search',
//    //                    templateUrl: 'app/kiosk/views/partial-search.html'
//    //                })
//    //        .state('home.pledge',
//    //                {
//    //                    url: 'pledge',
//    //                    templateUrl: 'app/kiosk/views/partial-pledge.html'
//    //                })
//    //        .state('home.list',
//    //                {
//    //                    url: 'list',
//    //                    templateUrl: 'app/kiosk/views/partial-list.html'
//    //                })
//    //        .state('home.finish',
//    //                {
//    //                    url: 'finish',
//    //                    templateUrl: 'app/kiosk/views/partial-finish.html'
//    //                })
//    //        .state('home.config',
//    //                {
//    //                    url: 'configuration',
//    //                    templateUrl: 'app/kiosk/views/partial-config.html'
//    //                });

//    //    $urlRouterProvider.otherwise('/');
//    //}
//}());
//mark.lawrence
//nav.module.js

(function () {
    angular.module('app.nav', []);
})();
//people.module.js
//mark.lawrence

(function () {
    angular.module('app.people', []);
})();
//mark.lawrence
//profile.module.js

(function () {
    angular.module('app.profile', []);
})();
//service.module.js
//mark.lawrence

(function () {
    angular.module('app.service', []);
})();
(function () {
    'use strict';

    angular.module('app.users', []);
})();
//mark.lawrence
//exception-handler.provider.js

// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function () {
            return { config: this.config };
        };
    };

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    };

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function (exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = { exception: exception, cause: cause };
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    };
})();
//mark.lawrence
//exception.js

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };

        return service;

        function catcher(message) {
            return function (reason) {
                logger.error(message, reason);
            };
        };
    };
})();
//mark.lawrence
//logger.js

(function () {
    'use strict';

    angular.module('blocks.logger').factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Error: ' + message, data);
        };

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        };

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Success: ' + message, data);
        };

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Warning: ' + message, data);
        };
    };
})();
//manager.js
//mark.lawrence

(function () {
    'use strict';

    var controllerId = 'CensorController';

    angular.module('app.censors').controller(controllerId, CensorController);

    CensorController.$inject = ['logger', '$uibModal', 'censorService'];

    function CensorController(logger, $modal, service) {
        var vm = this;
        vm.title = 'Censor Manager';
        vm.description = 'View and edit censored words';
        vm.isBusy = false;

        vm.censors = [];
        vm.currentEdit = {};
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;

            var searchTerm = '';
            if (typeof (tableState.search.predicateObject) != "undefined") {
                searchTerm = tableState.search.predicateObject.searchTerm;
            }
            vm.isBusy = true;
            service.query(searchTerm)
                .then(function (data) {
                    vm.censors = data;
                    vm.isBusy = false;
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.create = function () {
            var item = {};
            $modal.open({
                templateUrl: '/app/censors/views/censor.html',
                controller: ['$uibModalInstance', 'censorService', 'item', createCensorController],
                controllerAs: 'vm',
                resolve: {
                    item: function () { return item; }
                }
            })
                .result.then(function (data) {
                    vm.censors.unshift(data);
                });
        };

        vm.deleteItem = function (censor) {
            vm.lastDeleted = censor;
            service.remove(censor.id)
                .then(function (data) {
                    var idx = vm.censors.indexOf(censor);
                    vm.censors.splice(idx, 1);
                });
        };

        vm.editItem = function (censor) {
            vm.currentEdit[censor.id] = true;
            vm.itemToEdit = angular.copy(censor);
        };

        vm.saveItem = function (censor) {
            vm.currentEdit[censor.id] = false;
            angular.copy(censor, vm.lastUpdated = {});
            angular.extend(censor, vm.itemToEdit);
            service.update(vm.itemToEdit)
                .then(function (data) {
                    censor = data;
                });
        };

        vm.undoDelete = function () {
            service.create(vm.lastDeleted)
                .then(function (data) {
                    logger.success('Successfully restored ' + data.word);
                    vm.censors.unshift(data);
                    vm.lastDeleted = null;
                });
        };

        vm.undoChange = function () {
            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.censors,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.censors[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.word);
                    vm.lastUpdated = null;
                });
        };
    };

    function createCensorController($modal, service, item) {
        var vm = this;

        vm.item = angular.copy(item);

        vm.close = close;
        vm.save = save;

        function close() {
            $modal.dismiss();
        };

        function save() {
            service.create(vm.item)
                .then(function (data) {
                    vm.item = data;
                    $modal.close(vm.item);
                });
        };
    };
})();
//manager.js
//mark.lawrence

(function () {
    var controllerId = 'SettingsController';

    angular.module('app.settings').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$timeout', 'configurationService'];

    function mainController(logger, $timeout, service) {
        var vm = this;
        vm.title = 'Settings Configuration';

        vm.config = {};
        var hub = $.connection.wot;

        vm.isBusy = false;

        vm.lastSaved = {};
        vm.save = save;
        vm.undo = undo;

        activate();

        function activate() {
            logger.log(controllerId + ' actived');
            $.connection.hub.start()
                .done(function () {
                    logger.info('hub connection successful');
                });
            getSettings();
        };

        function getSettings() {
            service.get()
                .then(function (data) {
                    vm.config = data;
                    vm.lastSaved = angular.copy(vm.config);
                });
        };

        function save() {
            vm.isBusy = true;
            service.update(vm.config)
                .then(function (data) {
                    vm.config = data;
                    hub.server.configurationChange(vm.config)
                        .then(function () {
                            logger.info('Changes saved and sent to WOT');
                        });
                })
                .finally(function () {
                    logger.log('finally compelted');
                    vm.isBusy = false;
                });
        };

        function undo() {
            vm.config = vm.lastSaved;
        };
    };
})();
// blacklist.directive.js
// mark.lawrence

(function () {
    'use strict';

    angular.module('app')
        .directive('blacklistName',
            function () {
                return {
                    restrict: 'A',
                    scope: {
                        blacklist: '='
                    },
                    require: 'ngModel',
                    link: function (scope, ele, attrs, ctrl) {
                        ctrl.$validators.blacklist = function test(modelValue, viewValue) {
                            var value = modelValue || viewValue;
                            //console.log('from directive: value: ' + value);
                            //console.log('from directive: indexOf: ' + scope.blacklist.indexOf(value.toUpperCase()));
                            if (value) return scope.blacklist.indexOf(value.toUpperCase()) == -1;
                        };
                    }
                }
            });
})();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: '^stTable',
            link: function (scope, element, attrs, ctrl) {
                element.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    return scope.$apply(function () {
                        var fieldName = element.context.attributes['st-search'].value;
                        var tableState = ctrl.tableState();
                        tableState.search.predicateObject[fieldName] = '';
                        return ctrl.pipe();
                    });
                });
            }
        };
    });
})();
//app.filter.js
//mark.lawrence

angular.module('app.filter').filter('percentage', ['$filter', function ($filter) {
    return function (input, decimals) {
        return $filter('number')(input * 100, decimals) + '%';
    };
}]);
(function () {
    'use strict';

    var controllerId = 'HomeController';

    angular.module('app.home').controller(controllerId, mainController);

    mainController.$inject = ['peopleService', 'censorService', 'userService', 'storage', 'logger'];

    function mainController(peopleService, censorService, userService, storage, logger) {
        var vm = this;
        vm.title = 'Home';

        vm.stat = {};
        vm.people = [];

        activate();

        var censors = [];

        function activate() {
            logger.log(controllerId + ' active');

            userService.get().then(function (data) {
                vm.user = data;
                localStorage.setItem('currentUser', JSON.stringify(vm.user));
            });

            censors = JSON.parse(storage.get('censors'));

            if (!censors) {
                censorService.query('')
                        .then(function (data) {
                            storage.set('censors', JSON.stringify(data));
                            censors = JSON.parse(storage.get('censors'));
                        });
            }
            refresh();
        };

        function refresh() {
            peopleService.getCurrentStats()
                .then(function (data) {
                    vm.stat = data;
                });

            peopleService.get()
                .then(function (data) {
                    vm.people = data;
                });
        };
    };
})();
//mark.lawrence
//kiosk.js

(function () {
    'use strict';

    var controllerId = 'KioskController';
    angular.module('app').controller(controllerId, KioskController);

    KioskController.$inject = ['$scope', '$log', '$state', '$timeout', 'peopleService', 'configurationService', 'censors', 'config'];

    function KioskController($scope, logger, $state, $timeout, peopleService, configurationService, censors, config) {
        var vm = this;
        var tableStateRef;
        var prevSelection = null;
        var timer;
        var waitTime = 5000;
        var keyCode = '';
        var hub = $.connection.wot;

        vm.title = 'welcome';
        vm.people = [];
        vm.config = config;
        vm.searchModel = {
            page: 1,
            pageSize: 13
        };
        vm.showValidationErrors = false;
        vm.kiosk = localStorage.getItem('kiosk') ? localStorage.getItem('kiosk') : '1';
        vm.availableKiosks = ['1', '2', '3', '4'];

        $.connection.hub.start().done(function () {
            logger.info('hub connection successful');
        });

        vm.toggleName = function (person) {
            if (prevSelection) {
                prevSelection.$selected = false;
            }
            if (prevSelection === person) {
                person.$selected = false;
                vm.person = undefined;
                prevSelection = null;
            } else {
                person.$selected = true;
                vm.person = person;
                prevSelection = person;
            }
            resetTimer();
        };

        vm.setFocus = function (event) {
            vm.editItem = event;

            if (event) vm.editItem = event;
        };

        vm.keyboardInput = function (key) {
            resetTimer();
            vm.showValidationErrors = true;
            var keyCode = key.currentTarget.outerText;
            if (keyCode === 'SPACE') {
                vm.lastLetterIsSpace = true;
                return;
            }

            if (keyCode === 'DEL') {
                vm.editItem.$setViewValue(vm.editItem.$viewValue.substr(0, vm.editItem.$viewValue.length - 1));
                vm.editItem.$render();
                return;
            }

            if (vm.lastLetterIsSpace) {
                vm.editItem.$setViewValue(vm.editItem.$viewValue + ' ' + keyCode);
                vm.lastLetterIsSpace = false;
            } else {
                vm.editItem.$setViewValue(vm.editItem.$viewValue + keyCode);
            }
            vm.editItem.$render();
        };

        vm.paged = function () {
            prevSelection = null;
            vm.searchName(tableStateRef);
        };

        vm.updateKiosk = function () {
            logger.info('changed kiosk', vm.kiosk);
            localStorage.setItem('kiosk', vm.kiosk);
        };

        vm.searchName = function (tableState) {
            tableStateRef = tableState;

            if (vm.searchForm !== undefined && vm.searchForm.$invalid) {
                vm.showValidationErrors = true;
                return;
            }
            var names = vm.searchTerm.split(' ');
            var fn = names[1] ? names[0] : '';
            var ln = names[1] || names[0];

            vm.searchModel.firstname = fn;
            vm.searchModel.lastname = ln;
            vm.searchModel.orderBy = 'firstname';

            peopleService.query(vm.searchModel)
              .then(function (data) {
                  vm.people = data.items;
                  vm.searchModel = data;

                  $state.go('home.list')
                      .then(function () {
                          resetTimer();
                      });
              });
        };

        vm.goBack = function () {
            resetTimer();
            history.back();
        };

        vm.gotoPledge = function () {
            if (vm.createForm.$invalid) {
                vm.showValidationErrors = true;
                toastr.error('Please correct your information');
                return;
            }

            vm.person.dateCreated = moment().format('MM/DD/YYYY HH:mm:ss');
            vm.person.isDonor = vm.person.isPriority = false;
            vm.person.firstname = Humanize.titleCase(vm.person.firstname.toLowerCase());
            vm.person.lastname = Humanize.titleCase(vm.person.lastname.toLowerCase());
            vm.person.fuzzyMatchValue = matchValue(vm.person);
            if (vm.person.emailAddress) vm.person.emailAddress = vm.person.emailAddress.toLowerCase();

            $state.go('home.pledge')
                .then(function () {
                    resetTimer();
                });
        };

        vm.gotoSearch = function () {
            $state.go('home.search')
                .then(function () {
                    vm.showValidationErrors = false;
                    vm.editItem = vm.searchForm.searchTerm;
                    resetTimer();
                });
        };

        vm.gotoCreate = function gotoCreate() {
            $state.go('home.create')
                .then(function () {
                    vm.editItem = vm.createForm.firstname;
                    vm.showValidationErrors = false;
                    vm.person = { firstname: '', lastname: '' };
                    createValidationWatcher();
                    resetTimer();
                });
        };

        vm.cancel = function () {
            vm.person = { firstname: '', lastname: '' };
            vm.searchTerm = '';
            vm.people = [];

            $state.go('home')
                .then(function () {
                    $timeout.cancel(timer);
                });
        };

        vm.finish = function () {
            $state.go('home.finish')
                .then(function () {
                    logger.info('sending to hub');
                    hub.server.addName(vm.kiosk, vm.person)
                        .then(function () {
                            logger.info('Sent person to WOT', vm.person);
                            resetTimer();
                        });
                });
        };

        vm.save = function () {
            peopleService.create(vm.person)
                .then(function (data) {
                    vm.finish();
                });
        };

        vm.unlockSettings = function (key) {
            logger.info('keyCode', keyCode, false);
            if (keyCode.length > 4) {
                keyCode = key;
            } else {
                keyCode += key.toString();
            }

            if (keyCode === '12') {
                $state.go('home.config')
                    .then(function () {
                        keyCode = '';
                        logger.info('current kiosk', vm.kiosk);
                    });
            }
        };

        vm.saveConfig = function () {
            configurationService.update(vm.config)
                .then(function (data) {
                    vm.config = data;
                    toastr.success('Settings Saved!');
                    hub.server.configurationChange(vm.config)
                        .then(function () {
                            logger.info('Changes saved and sent to WOT');
                        });
                });
        };

        function matchValue(person) {
            var value = 0.0;
            var fn = getFullName(person);

            _.forEach(censors, function (censor) {
                var idx = clj_fuzzy.metrics.dice(fn, censor.word);
                if (idx > value) value = idx;
            });
            return value;
        };

        function getFullName(person) {
            return person.firstname + ' ' + person.lastname;
        }

        function resetTimer() {
            $timeout.cancel(timer);
            timer = $timeout(function () {
                vm.cancel();
            }, waitTime);
        };

        function createValidationWatcher() {
            //logger.info('creating watcher', vm.person, false);
            $scope.$watchCollection('vm.person', function (newVal, oldVal) {
                if (vm.person) {
                    resetTimer();
                    var valid = validatePerson(vm.person);
                    if (vm.createForm) {
                        vm.createForm.firstname.$setValidity('blacklist', valid);
                        vm.createForm.lastname.$setValidity('blacklist', valid);
                    }
                }
            });
        };

        function validatePerson(person) {
            var fullName = (person.firstname ? person.firstname : '') + ' ' + (person.lastname ? person.lastname : '');
            var firstmatch = censors.some(function (e) { return e.word.toUpperCase() === (person.firstname ? person.firstname.toUpperCase() : ''); });
            var lastmatch = censors.some(function (e) { return e.word.toUpperCase() === (person.lastname ? person.lastname.toUpperCase() : ''); });
            var fullmatch = censors.some(function (e) { return e.word.toUpperCase() === fullName.toUpperCase(); });

            var match = firstmatch || lastmatch || fullmatch;
            return !match;
        };
    };
})();
//mark.lawrence
//nav.js

(function () {
    'use strict';

    var controllerId = 'NavController';

    angular.module('app.users').controller(controllerId, mainController);

    mainController.$inject = ['logger'];

    function mainController(logger) {
        var vm = this;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        }
    };
})();
//manager.js
//mark.lawrence

(function () {
    var controllerId = 'PeopleController';

    angular.module('app.people').controller(controllerId, PeopleController);

    PeopleController.$inject = ['logger', 'peopleService', '$uibModal', 'config'];

    function PeopleController(logger, service, $modal, config) {
        var vm = this;
        var keyCodes = config.keyCodes;

        vm.title = "People Manager";

        vm.currentEdit = null;
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;

        vm.people = [];
        vm.searchModel = {
            page: 1,
            pageSize: 15,
            orderBy: 'Firstname',
            orderDirection: 'desc'
        };
        vm.searchTerm = '';

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        };

        vm.addItem = function addItem() {
            $modal.open({
                templateUrl: '/app/people/views/person.html',
                //controller: ['logger', '$uibModalInstance', 'peopleService', 'item', 'vm', 'storage', editPersonController],
                controller: ['logger', '$uibModalInstance', 'peopleService', 'vm', 'storage', editPersonController],
                controllerAs: 'vm',
                resolve: {
                    vm: vm
                }
            })
                .result.then(function (data) {
                    vm.people.unshift(data);
                    logger.success('Successfully created ' + getFullName(data));
                });
        };

        vm.editItem = function editItem(item) {
            vm.currentEdit = item;
            $modal.open({
                templateUrl: '/app/people/views/person.html',
                //controller: ['logger', '$uibModalInstance', 'peopleService', 'item', 'vm', 'storage', editPersonController],
                controller: ['logger', '$uibModalInstance', 'peopleService', 'vm', 'storage', editPersonController],
                controllerAs: 'vm',
                resolve: {
                    vm: vm
                }
            })
                .result.then(function (data) {
                    vm.lastUpdated = angular.copy(vm.currentEdit);
                    angular.extend(item, data);
                    logger.success('Successfully updated ' + getFullName(data));
                });
        };

        vm.deleteItem = function deleteItem(person) {
            service.remove(person.id)
                .then(function (data) {
                    vm.lastDeleted = person;
                    var idx = vm.people.indexOf(person);
                    vm.people.splice(idx, 1);
                    logger.warning('Deleted person ' + person.firstname + ' ' + person.lastname);
                });
        };

        vm.undoDelete = function () {
            service.create(vm.lastDeleted)
                .then(function (data) {
                    logger.success('Successfully restored ' + data.firstname + ' ' + data.lastname);
                    vm.people.unshift(data);
                    vm.lastDeleted = null;
                });
        };

        vm.undoChange = function () {
            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.people,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.people[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + vm.lastUpdated.firstname + ' ' + vm.lastUpdated.lastname);
                    vm.lastUpdated = null;
                });
        };

        vm.search = function search(tableState) {
            tableStateRef = tableState;
            if (!vm.searchModel.isPriority) vm.searchModel.isPriority = null;

            vm.searchModel.dateCreated = vm.daysFilter
                ? moment().subtract(parseInt(vm.daysFilter), 'days').format('MM/DD/YYYY')
                : null;

            if (typeof (tableState.sort.predicate) != "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }
            if (typeof (tableState.search.predicateObject) != "undefined") {
                vm.daysFilter = tableState.search.predicateObject.dateCreated ? null : vm.daysFilter;
                vm.searchModel.dateCreated = vm.daysFilter
                    ? vm.searchModel.dateCreated
                    : tableState.search.predicateObject.dateCreated;

                if (tableState.search.predicateObject.fuzzyMatchValue) {
                    vm.searchModel.fuzzyMatchValue = tableState.search.predicateObject.fuzzyMatchValue / 100;
                } else {
                    vm.searchModel.fuzzyMatchValue = null;
                }

                vm.searchModel.isDonor = tableState.search.predicateObject.isDonor;
                vm.searchModel.firstname = tableState.search.predicateObject.firstname;
                vm.searchModel.lastname = tableState.search.predicateObject.lastname;
                vm.searchModel.zipcode = tableState.search.predicateObject.zipCode;
                vm.searchModel.emailAddress = tableState.search.predicateObject.emailAddress;
                vm.searchModel.isPriority = tableState.search.predicateObject.isPriority;
            }

            vm.isBusy = true;
            service.query(vm.searchModel)
                .then(function (data) {
                    vm.people = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        };

        vm.pages = function paged(pageNum) {
            search(tableStateRef);
        };

        vm.quickFilter = function () {
            vm.search(tableStateRef);
        };

        function getFullName(person) {
            return person.firstname + ' ' + person.lastname;
        };
    }

    //function editPersonController(logger, $modal, service, item, model, storage) {
    function editPersonController(logger, $modal, service, model, storage) {
        var vm = this;
        //TODO: Can be made global??
        var censors = JSON.parse(storage.get('censors'));

        vm.item = angular.copy(model.currentEdit);

        vm.close = function () {
            $modal.dismiss();
        };

        vm.matchValue = function () {
            var value = 0.0;
            var fn = getFullName(vm.item);

            _.forEach(censors,
                function (censor) {
                    var idx = clj_fuzzy.metrics.dice(fn, censor.word);
                    if (idx > value) value = idx;
                });
            vm.item.fuzzyMatchValue = value;
        };

        vm.save = function () {
            if (vm.item.id) {
                service.update(vm.item)
                    .then(function (data) {
                        $modal.close(data);
                    });
            } else {
                service.create(vm.item)
                    .then(function (data) {
                        $modal.close(data);
                    });
            }
        };

        function getFullName(item) {
            return item.firstname + ' ' + item.lastname;
        };
    };
})();
//mark.lawrence
//profile.js

(function () {
    'use strict';

    var controllerId = 'ProfileController';

    angular.module('app.users').controller(controllerId, mainController);

    mainController.$inject = ['$scope', '$http', 'logger', 'userService', 'defaults', 'config', '$rootScope'];

    function mainController($scope, $http, logger, service, defaults, config, $rootScope) {
        var vm = this;
        vm.title = 'Profile Manager';
        vm.description = 'Update your profile';

        vm.user = {};

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        };

        vm.fileSelected = function ($files, $file, $event, $rejectedFiles) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var dataURL = reader.result;
                vm.user.userPhoto = dataURL.split(',')[1];
                vm.user.userPhotoType = $file.type;
            };
            reader.readAsDataURL($file);
        };

        vm.save = function () {
            vm.isBusy = true;
            service.update(vm.user)
                .then(function (data) {
                    vm.user = data;
                    localStorage.setItem('currentUser', JSON.stringify(vm.user));
                })
                .finally(function () {
                    vm.isBusy = false;
                    vm.file = null;
                    vm.profileForm.$setPristine();
                    vm.avatarForm.$setPristine();
                });
        };
    };
})();
//censor.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'censorService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Censor;

        var service = {
            create: create,
            get: get,
            query: query,
            update: update,
            remove: remove
        };

        return service;

        function create(censor) {
            return $http.post(url, censor).then(_success);
        };

        function get() {
            return $http.get(url).then(_success);
        };

        function query(searchTerm) {
            if (searchTerm == undefined) {
                return get();
            } else {
                return $http.get(url + '/?search=' + searchTerm).then(_success);
            }
        };

        function update(censor) {
            return $http.put(url, censor).then(_success);
        };

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        };

        function _success(response) {
            return response.data;
        };
    }
})();
//configuration.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'configurationService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded ');
        var url = config.apiUrl + config.apiEndPoints.Configuration;

        var service = {
            get: get,
            update: update
        }

        return service;

        function get() {
            return $http.get(url).then(_success);
        }

        function update(config) {
            return $http.put(url, config).then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
//people.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'peopleService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config, exception) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Person;

        var service = {
            create: create,
            get: get,
            query: query,
            update: update,
            remove: remove,
            getCurrentStats: getCurrentStats
        }

        return service;

        function create(censor) {
            return $http.post(url, censor).then(_success);
        }

        function get() {
            return $http.get(url)
                .then(_success)
                .catch(function (message) { exception.catcher('Failed to retrieve people')(message); });
        }

        function query(search) {
            return $http.post(url + '/search', search)
                .then(_success)
                .catch(function (message) { exception.catcher('Failed to retrieve people')(message); });
        }

        function update(person) {
            return $http.put(url, person).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function getCurrentStats() {
            return $http.get(url + '/stat')
                .then(_success)
                .catch(function (message) { exception.catcher('Failed to retrieve stats')(message); });
        }

        function _success(response) {
            return response.data;
        }
    }
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'userService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.User;

        var service = {
            availableRoles: availableRoles,
            create: create,
            get: get,
            query: query,
            remove: remove,
            update: update,
            uploadAvatar: uploadAvatar
        }

        return service;

        function availableRoles() {
            return $http.get(url + '/roles').then(_success);
        }

        function create(user) {
            return $http.post(url, user).then(_success);
        }

        //TODO: Need a getbyname function
        function get() {
            return $http.get(url).then(_success);
        }

        function query(searchTerm) {
            if (searchTerm != undefined && searchTerm.length > 0) {
                return $http.get(url + '?searchTerm=' + searchTerm).then(_success);
            } else {
                return get(url);
            }
        }

        function update(user) {
            return $http.put(url, user).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function uploadAvatar(username, avatar) {
            var formData = new FormData();
            formData.append('file', avatar);

            return $http.post(url + '/uploadAvatar/' + username + '/',
                    formData,
                    { headers: { 'Content-Type': undefined } }
                )
                .then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
(function () {
    'use strict';

    var controllerId = 'UserController';

    angular.module('app.users').controller(controllerId, UserController);

    UserController.$inject = ['logger', 'userService', 'defaults', 'config'];

    function UserController(logger, service, defaults, config) {
        var vm = this;
        vm.title = 'User Manager';
        vm.description = 'Edit and update users';
        var keyCodes = config.keyCodes;

        vm.availableRoles = [];
        vm.clearCreate = clearCreate;
        vm.currentEdit = {};
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        vm.user = {
            //userName: null,
            roles: ['user'],
            fullName: '',
            password: defaults.GENERIC_PASSWORD
        };

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getAvailableRoles();
        };

        vm.addItem = function () {
            vm.user.fullName = parseFullName(vm.user.userName);
            vm.user.email = vm.user.userName + defaults.EMAIL_SUFFIX;

            service.create(vm.user)
                .then(function (data) {
                    //TODO: mapping would allow removal of extend method
                    vm.user = angular.extend(vm.user, data);
                    vm.users.unshift(angular.copy(vm.user));
                    logger.success('User ' + vm.user.userName + ' created!');
                    vm.user.userName = null;
                    //TODO: show error user already exists
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.deleteItem = function (user) {
            angular.copy(user, vm.lastDeleted = {});
            service.remove(user.id)
                .then(function (data) {
                    var idx = vm.users.indexOf(user);
                    vm.users.splice(idx, 1);
                });
        };

        vm.editItem = function (user) {
            vm.currentEdit[user.id] = true;
            angular.copy(user, vm.itemToEdit = {});
        };

        function getAvailableRoles() {
            service.availableRoles()
                .then(function (data) {
                    vm.availableRoles = data;
                });
        };

        vm.saveItem = function (user) {
            vm.isBusy = true;

            vm.currentEdit[user.id] = false;
            angular.copy(user, vm.lastUpdated = {});
            logger.log('lastUpdated', vm.lastUpdated);
            var roles = [];

            _.forEach(vm.itemToEdit.roles,
                function (role) {
                    roles.push(role.name);
                });
            vm.itemToEdit.roles = roles;

            service.update(vm.itemToEdit)
                .then(function (data) {
                    angular.extend(user, data);
                    logger.success('User ' + data.userName + ' updated!');
                    vm.isBusy = false;
                });
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;
            var searchTerm;

            if (typeof (tableState.search.predicateObject) != 'undefined') {
                searchTerm = tableState.search.predicateObject.searchTerm;
            }

            vm.isBusy = true;
            service.query(searchTerm)
                .then(function (data) {
                    vm.users = data;
                    logger.log('users', vm.users);
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        vm.undoDelete = function () {
            var roles = [];

            _.forEach(vm.lastDeleted.roles, function (role) {
                roles.push(role.name);
                logger.log('role', role.name);
            });
            vm.lastDeleted.roles = roles;
            vm.lastDeleted.password = defaults.GENERIC_PASSWORD;

            service.create(vm.lastDeleted).then(function (data) {
                logger.success('Successfully restored ' + data.userName);
                vm.users.unshift(data);
                vm.lastDeleted = null;
            });
        };

        vm.undoChange = function () {
            vm.isBusy = true;

            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.users,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.users[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.userName);
                    vm.lastUpdated = null;
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        function clearCreate($event) {
            if ($event.keyCode === keyCodes.esc) {
                vm.user.userName = '';
            };
        };

        function parseFullName(name) {
            var arr = name.split('.');
            var fullname = '';

            _.forEach(arr, function (v) {
                fullname += _.capitalize(v) + ' ';
            });

            return _.trim(fullname);
        };
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb3JlL2NvcmUubW9kdWxlLmpzIiwiY29yZS9jb25maWcuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5tb2R1bGUuanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5tb2R1bGUuanMiLCJjZW5zb3JzL2NlbnNvcnMubW9kdWxlLmpzIiwiY29uZmlndXJhdGlvbi9zZXR0aW5ncy5tb2R1bGUuanMiLCJmaWx0ZXJzL2ZpbHRlci5tb2R1bGUuanMiLCJob21lL2hvbWUubW9kdWxlLmpzIiwia2lvc2sva2lvc2subW9kdWxlLmpzIiwibmF2L25hdi5tb2R1bGUuanMiLCJwZW9wbGUvcGVvcGxlLm1vZHVsZS5qcyIsInByb2ZpbGUvcHJvZmlsZS5tb2R1bGUuanMiLCJzZXJ2aWNlcy9zZXJ2aWNlLm1vZHVsZS5qcyIsInVzZXJzL3VzZXJzLm1vZHVsZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLWhhbmRsZXIucHJvdmlkZXIuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLmpzIiwiY2Vuc29ycy9jZW5zb3JzLmpzIiwiY29uZmlndXJhdGlvbi9zZXR0aW5ncy5qcyIsImRpcmVjdGl2ZXMvYmxhY2tsaXN0LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvY2xlYXIta2V5LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvc21hcnQtdGFibGUuZGlyZWN0aXZlLmpzIiwiZmlsdGVycy9hcHAuZmlsdGVycy5qcyIsImhvbWUvaG9tZS5qcyIsImtpb3NrL2tpb3NrLmpzIiwibmF2L25hdi5qcyIsInBlb3BsZS9wZW9wbGUuanMiLCJwcm9maWxlL3Byb2ZpbGUuanMiLCJzZXJ2aWNlcy9jZW5zb3Iuc2VydmljZS5qcyIsInNlcnZpY2VzL2NvbmZpZ3VyYXRpb24uc2VydmljZS5qcyIsInNlcnZpY2VzL3Blb3BsZS5zZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlci5zZXJ2aWNlLmpzIiwidXNlcnMvdXNlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6TUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNyRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6Im1vZHVsZXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy9hcHAubW9kdWxlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnLFxyXG4gICAgW1xyXG4gICAgICAgIC8vYXBwbGljYXRpb24gbW9kdWxlc1xyXG4gICAgICAgICdhcHAuY29yZScsXHJcbiAgICAgICAgJ2FwcC5zZXJ2aWNlJyxcclxuICAgICAgICAnYXBwLmZpbHRlcicsXHJcblxyXG4gICAgICAgIC8vZmVhdHVyZSBhcmVhc1xyXG4gICAgICAgICdhcHAubmF2JyxcclxuICAgICAgICAnYXBwLmhvbWUnLFxyXG4gICAgICAgICdhcHAuY2Vuc29ycycsXHJcbiAgICAgICAgJ2FwcC5wZW9wbGUnLFxyXG4gICAgICAgICdhcHAuc2V0dGluZ3MnLFxyXG4gICAgICAgICdhcHAudXNlcnMnLFxyXG4gICAgICAgICdhcHAucHJvZmlsZScsXHJcbiAgICAgICAgJ2FwcC5raW9zaydcclxuICAgIF0pLmNvbmZpZyhbJyRzdGF0ZVByb3ZpZGVyJywgJyR1cmxSb3V0ZXJQcm92aWRlcicsIGNvbmZpZ10pLnJ1bihbJyRyb290U2NvcGUnLCAnbG9nZ2VyJywgJ3VzZXJTZXJ2aWNlJywgZnVuY3Rpb24gKCRyb290U2NvcGUsIGxvZ2dlciwgc2VydmljZSkge1xyXG4gICAgICAgIGxvZ2dlci5sb2coJ2FwcCBydW5uaW5nJyk7XHJcbiAgICB9XSk7XHJcblxyXG4gICAgZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuICAgICAgICAvLyRsb2NhdGlvblByb3ZpZGVyLmh0bWw1TW9kZSh0cnVlKTtcclxuXHJcbiAgICAgICAgJHN0YXRlUHJvdmlkZXJcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJy8nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9ob21lLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyOiAnS2lvc2tDb250cm9sbGVyJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW5zb3JzOiBmdW5jdGlvbiAoY2Vuc29yU2VydmljZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW5zb3JTZXJ2aWNlLmdldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbmZpZzogZnVuY3Rpb24gKGNvbmZpZ3VyYXRpb25TZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lLmNyZWF0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdjcmVhdGUnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLWNyZWF0ZS5odG1sJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZS5zZWFyY2gnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnc2VhcmNoJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1zZWFyY2guaHRtbCdcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUucGxlZGdlJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJ3BsZWRnZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL3BhcnRpYWwtcGxlZGdlLmh0bWwnXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lLmxpc3QnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnbGlzdCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL3BhcnRpYWwtbGlzdC5odG1sJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZS5maW5pc2gnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnZmluaXNoJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1maW5pc2guaHRtbCdcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUuY29uZmlnJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJ2NvbmZpZ3VyYXRpb24nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLWNvbmZpZy5odG1sJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vY29yZS5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJyxcclxuICAgICAgICBbXHJcbiAgICAgICAgICAgIC8vYW5ndWxhciBtb2R1bGVzXHJcbiAgICAgICAgICAgICduZ01lc3NhZ2VzJyxcclxuICAgICAgICAgICAgJ2FuZ3VsYXJMb2NhbFN0b3JhZ2UnLFxyXG4gICAgICAgICAgICAndWkucm91dGVyJyxcclxuICAgICAgICAgICAgJ25nQW5pbWF0ZScsXHJcblxyXG4gICAgICAgICAgICAvL2N1c3RvbSBtb2R1bGVzXHJcbiAgICAgICAgICAgICdibG9ja3MubG9nZ2VyJyxcclxuICAgICAgICAgICAgJ2Jsb2Nrcy5leGNlcHRpb24nLFxyXG5cclxuICAgICAgICAgICAgLy90aGlyZCBwYXJ0eSBtb2R1bGVzXHJcbiAgICAgICAgICAgICdzbWFydC10YWJsZScsXHJcbiAgICAgICAgICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgICAgICAgICAnbmdUYWdzSW5wdXQnLFxyXG4gICAgICAgICAgICAnbmdGaWxlVXBsb2FkJyxcclxuICAgICAgICAgICAgJ3J6TW9kdWxlJyxcclxuICAgICAgICAgICAgJ3N3aXRjaGVyJyxcclxuICAgICAgICAgICAgJ2dmbC50ZXh0QXZhdGFyJ1xyXG4gICAgICAgIF0pXHJcbiAgICAgICAgLmNvbnN0YW50KCd0b2FzdHInLCB0b2FzdHIpXHJcbiAgICAgICAgLmNvbnN0YW50KCdtb21lbnQnLCBtb21lbnQpOztcclxufSkoKTsiLCIvL2NvbmZpZy5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGZ1bmN0aW9uIHRvYXN0ckNvbmZpZyh0b2FzdHIpIHtcclxuICAgICAgICB0b2FzdHIub3B0aW9ucy50aW1lT3V0ID0gNDAwMDtcclxuICAgICAgICB0b2FzdHIub3B0aW9ucy5wb3NpdGlvbkNsYXNzID0gJ3RvYXN0LWJvdHRvbS1yaWdodCc7XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBrZXlDb2RlcyA9IHtcclxuICAgICAgICBiYWNrc3BhY2U6IDgsXHJcbiAgICAgICAgdGFiOiA5LFxyXG4gICAgICAgIGVudGVyOiAxMyxcclxuICAgICAgICBlc2M6IDI3LFxyXG4gICAgICAgIHNwYWNlOiAzMixcclxuICAgICAgICBwYWdldXA6IDMzLFxyXG4gICAgICAgIHBhZ2Vkb3duOiAzNCxcclxuICAgICAgICBlbmQ6IDM1LFxyXG4gICAgICAgIGhvbWU6IDM2LFxyXG4gICAgICAgIGxlZnQ6IDM3LFxyXG4gICAgICAgIHVwOiAzOCxcclxuICAgICAgICByaWdodDogMzksXHJcbiAgICAgICAgZG93bjogNDAsXHJcbiAgICAgICAgaW5zZXJ0OiA0NSxcclxuICAgICAgICBkZWw6IDQ2XHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBhcGlFbmRQb2ludHMgPSB7XHJcbiAgICAgICAgQ2Vuc29yOiAnY2Vuc29yJyxcclxuICAgICAgICBQZXJzb246ICdwZXJzb24nLFxyXG4gICAgICAgIFVzZXI6ICd1c2VycycsXHJcbiAgICAgICAgQ29uZmlndXJhdGlvbjogJ2NvbmZpZ3VyYXRpb24nXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBjb25maWcgPSB7XHJcbiAgICAgICAgYXBwRXJyb3JQcmVmaXg6ICdbQ1JNQyBFcnJvcl0gJywgLy9Db25maWd1cmUgdGhlIGV4Y2VwdGlvbkhhbmRsZXIgZGVjb3JhdG9yXHJcbiAgICAgICAgYXBwVGl0bGU6ICdDUk1DJyxcclxuICAgICAgICB2ZXJzaW9uOiAnMS4wLjAnLFxyXG4gICAgICAgIGFwaVVybDogJ2h0dHA6Ly8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyAnL2FwaS8nLFxyXG4gICAgICAgIGtleUNvZGVzOiBrZXlDb2RlcyxcclxuICAgICAgICBhcGlFbmRQb2ludHM6IGFwaUVuZFBvaW50c1xyXG4gICAgfTtcclxuXHJcbiAgICB2YXIgZGVmYXVsdHMgPSB7XHJcbiAgICAgICAgRU1BSUxfU1VGRklYOiAnQHNwbGNlbnRlci5vcmcnLFxyXG4gICAgICAgIEdFTkVSSUNfUEFTU1dPUkQ6ICcxUEBzc3dvcmQnXHJcbiAgICB9O1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY29yZScpXHJcbiAgICAgICAgLmNvbmZpZyh0b2FzdHJDb25maWcpXHJcbiAgICAgICAgLmNvbnN0YW50KCdjb25maWcnLCBjb25maWcpXHJcbiAgICAgICAgLnZhbHVlKCdkZWZhdWx0cycsIGRlZmF1bHRzKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9leGNlcHRpb24ubW9kdWxlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2Jsb2Nrcy5leGNlcHRpb24nLCBbJ2Jsb2Nrcy5sb2dnZXInXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicsIFtdKTtcclxufSkoKTsiLCIvL2NlbnNvcnMubW9kdWxlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY2Vuc29ycycsIFtdKTtcclxufSkoKTsiLCIvL3NldHRvbWdzLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNldHRpbmdzJywgW10pO1xyXG59KSgpOyIsIi8vZmlsdGVyLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmZpbHRlcicsIFtdKTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaG9tZScsIFtdKTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAua2lvc2snLCBbXSk7XHJcbn0pKCk7XHJcblxyXG4vLyhmdW5jdGlvbiAoKSB7XHJcbi8vICAgIFwidXNlIHN0cmljdFwiO1xyXG4vLyAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmtpb3NrJywgW10pO1xyXG5cclxuLy8gICAgLy9hcHAuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgY29uZmlnXSk7XHJcblxyXG4vLyAgICAvL2Z1bmN0aW9uIGNvbmZpZygkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbi8vICAgIC8vICAgIC8vJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuLy8gICAgLy8gICAgJHN0YXRlUHJvdmlkZXJcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZScsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHVybDogJy8nLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvaG9tZS5odG1sJyxcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdLaW9za0NvbnRyb2xsZXInLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIGNlbnNvcnM6IGZ1bmN0aW9uIChjZW5zb3JTZXJ2aWNlKSB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZW5zb3JTZXJ2aWNlLmdldCgpO1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIH0sXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBmdW5jdGlvbiAoY29uZmlndXJhdGlvblNlcnZpY2UpIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbmZpZ3VyYXRpb25TZXJ2aWNlLmdldCgpO1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIH1cclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSlcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZS5jcmVhdGUnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB1cmw6ICdjcmVhdGUnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1jcmVhdGUuaHRtbCdcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSlcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZS5zZWFyY2gnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB1cmw6ICdzZWFyY2gnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1zZWFyY2guaHRtbCdcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSlcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZS5wbGVkZ2UnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB1cmw6ICdwbGVkZ2UnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1wbGVkZ2UuaHRtbCdcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSlcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZS5saXN0JyxcclxuLy8gICAgLy8gICAgICAgICAgICAgICAge1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdXJsOiAnbGlzdCcsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLWxpc3QuaHRtbCdcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSlcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZS5maW5pc2gnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB1cmw6ICdmaW5pc2gnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1maW5pc2guaHRtbCdcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSlcclxuLy8gICAgLy8gICAgICAgIC5zdGF0ZSgnaG9tZS5jb25maWcnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB1cmw6ICdjb25maWd1cmF0aW9uJyxcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL3BhcnRpYWwtY29uZmlnLmh0bWwnXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuLy8gICAgLy8gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZSgnLycpO1xyXG4vLyAgICAvL31cclxuLy99KCkpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL25hdi5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLm5hdicsIFtdKTtcclxufSkoKTsiLCIvL3Blb3BsZS5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wZW9wbGUnLCBbXSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vcHJvZmlsZS5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnByb2ZpbGUnLCBbXSk7XHJcbn0pKCk7IiwiLy9zZXJ2aWNlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnLCBbXSk7XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJywgW10pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi1oYW5kbGVyLnByb3ZpZGVyLmpzXHJcblxyXG4vLyBJbmNsdWRlIGluIGluZGV4Lmh0bWwgc28gdGhhdCBhcHAgbGV2ZWwgZXhjZXB0aW9ucyBhcmUgaGFuZGxlZC5cclxuLy8gRXhjbHVkZSBmcm9tIHRlc3RSdW5uZXIuaHRtbCB3aGljaCBzaG91bGQgcnVuIGV4YWN0bHkgd2hhdCBpdCB3YW50cyB0byBydW5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyXHJcbiAgICAgICAgLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicpXHJcbiAgICAgICAgLnByb3ZpZGVyKCdleGNlcHRpb25IYW5kbGVyJywgZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKVxyXG4gICAgICAgIC5jb25maWcoY29uZmlnKTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIE11c3QgY29uZmlndXJlIHRoZSBleGNlcHRpb24gaGFuZGxpbmdcclxuICAgICAqIEByZXR1cm4ge1t0eXBlXX1cclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uSGFuZGxlclByb3ZpZGVyKCkge1xyXG4gICAgICAgIC8qIGpzaGludCB2YWxpZHRoaXM6dHJ1ZSAqL1xyXG4gICAgICAgIHRoaXMuY29uZmlnID0ge1xyXG4gICAgICAgICAgICBhcHBFcnJvclByZWZpeDogdW5kZWZpbmVkXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy5jb25maWd1cmUgPSBmdW5jdGlvbiAoYXBwRXJyb3JQcmVmaXgpIHtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcuYXBwRXJyb3JQcmVmaXggPSBhcHBFcnJvclByZWZpeDtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLiRnZXQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7IGNvbmZpZzogdGhpcy5jb25maWcgfTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIENvbmZpZ3VyZSBieSBzZXR0aW5nIGFuIG9wdGlvbmFsIHN0cmluZyB2YWx1ZSBmb3IgYXBwRXJyb3JQcmVmaXguXHJcbiAgICAgKiBBY2Nlc3NpYmxlIHZpYSBjb25maWcuYXBwRXJyb3JQcmVmaXggKHZpYSBjb25maWcgdmFsdWUpLlxyXG4gICAgICogQHBhcmFtICB7W3R5cGVdfSAkcHJvdmlkZVxyXG4gICAgICogQHJldHVybiB7W3R5cGVdfVxyXG4gICAgICogQG5nSW5qZWN0XHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGNvbmZpZygkcHJvdmlkZSkge1xyXG4gICAgICAgICRwcm92aWRlLmRlY29yYXRvcignJGV4Y2VwdGlvbkhhbmRsZXInLCBleHRlbmRFeGNlcHRpb25IYW5kbGVyKTtcclxuICAgIH07XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBFeHRlbmQgdGhlICRleGNlcHRpb25IYW5kbGVyIHNlcnZpY2UgdG8gYWxzbyBkaXNwbGF5IGEgdG9hc3QuXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9ICRkZWxlZ2F0ZVxyXG4gICAgICogQHBhcmFtICB7T2JqZWN0fSBleGNlcHRpb25IYW5kbGVyXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGxvZ2dlclxyXG4gICAgICogQHJldHVybiB7RnVuY3Rpb259IHRoZSBkZWNvcmF0ZWQgJGV4Y2VwdGlvbkhhbmRsZXIgc2VydmljZVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBleHRlbmRFeGNlcHRpb25IYW5kbGVyKCRkZWxlZ2F0ZSwgZXhjZXB0aW9uSGFuZGxlciwgbG9nZ2VyKSB7XHJcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChleGNlcHRpb24sIGNhdXNlKSB7XHJcbiAgICAgICAgICAgIHZhciBhcHBFcnJvclByZWZpeCA9IGV4Y2VwdGlvbkhhbmRsZXIuY29uZmlnLmFwcEVycm9yUHJlZml4IHx8ICcnO1xyXG4gICAgICAgICAgICB2YXIgZXJyb3JEYXRhID0geyBleGNlcHRpb246IGV4Y2VwdGlvbiwgY2F1c2U6IGNhdXNlIH07XHJcbiAgICAgICAgICAgIGV4Y2VwdGlvbi5tZXNzYWdlID0gYXBwRXJyb3JQcmVmaXggKyBleGNlcHRpb24ubWVzc2FnZTtcclxuICAgICAgICAgICAgJGRlbGVnYXRlKGV4Y2VwdGlvbiwgY2F1c2UpO1xyXG4gICAgICAgICAgICAvKipcclxuICAgICAgICAgICAgICogQ291bGQgYWRkIHRoZSBlcnJvciB0byBhIHNlcnZpY2UncyBjb2xsZWN0aW9uLFxyXG4gICAgICAgICAgICAgKiBhZGQgZXJyb3JzIHRvICRyb290U2NvcGUsIGxvZyBlcnJvcnMgdG8gcmVtb3RlIHdlYiBzZXJ2ZXIsXHJcbiAgICAgICAgICAgICAqIG9yIGxvZyBsb2NhbGx5LiBPciB0aHJvdyBoYXJkLiBJdCBpcyBlbnRpcmVseSB1cCB0byB5b3UuXHJcbiAgICAgICAgICAgICAqIHRocm93IGV4Y2VwdGlvbjtcclxuICAgICAgICAgICAgICpcclxuICAgICAgICAgICAgICogQGV4YW1wbGVcclxuICAgICAgICAgICAgICogICAgIHRocm93IHsgbWVzc2FnZTogJ2Vycm9yIG1lc3NhZ2Ugd2UgYWRkZWQnIH07XHJcbiAgICAgICAgICAgICAqL1xyXG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZXhjZXB0aW9uLm1lc3NhZ2UsIGVycm9yRGF0YSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZXhjZXB0aW9uLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdibG9ja3MuZXhjZXB0aW9uJylcclxuICAgICAgICAuZmFjdG9yeSgnZXhjZXB0aW9uJywgZXhjZXB0aW9uKTtcclxuXHJcbiAgICAvKiBAbmdJbmplY3QgKi9cclxuICAgIGZ1bmN0aW9uIGV4Y2VwdGlvbihsb2dnZXIpIHtcclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY2F0Y2hlcjogY2F0Y2hlclxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjYXRjaGVyKG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uIChyZWFzb24pIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihtZXNzYWdlLCByZWFzb24pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2xvZ2dlci5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmxvZ2dlcicpLmZhY3RvcnkoJ2xvZ2dlcicsIGxvZ2dlcik7XHJcblxyXG4gICAgbG9nZ2VyLiRpbmplY3QgPSBbJyRsb2cnLCAndG9hc3RyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbG9nZ2VyKCRsb2csIHRvYXN0cikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBzaG93VG9hc3RzOiB0cnVlLFxyXG5cclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLFxyXG4gICAgICAgICAgICBpbmZvOiBpbmZvLFxyXG4gICAgICAgICAgICBzdWNjZXNzOiBzdWNjZXNzLFxyXG4gICAgICAgICAgICB3YXJuaW5nOiB3YXJuaW5nLFxyXG5cclxuICAgICAgICAgICAgLy8gc3RyYWlnaHQgdG8gY29uc29sZTsgYnlwYXNzIHRvYXN0clxyXG4gICAgICAgICAgICBsb2c6ICRsb2cubG9nXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcbiAgICAgICAgLy8vLy8vLy8vLy8vLy8vLy8vLy8vXHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGVycm9yKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5lcnJvcihtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cuZXJyb3IoJ0Vycm9yOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gaW5mbyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xyXG4gICAgICAgICAgICB0b2FzdHIuaW5mbyhtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cuaW5mbygnSW5mbzogJyArIG1lc3NhZ2UsIGRhdGEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHN1Y2Nlc3MobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcclxuICAgICAgICAgICAgdG9hc3RyLnN1Y2Nlc3MobWVzc2FnZSwgdGl0bGUpO1xyXG4gICAgICAgICAgICAkbG9nLmluZm8oJ1N1Y2Nlc3M6ICcgKyBtZXNzYWdlLCBkYXRhKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB3YXJuaW5nKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci53YXJuaW5nKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy53YXJuKCdXYXJuaW5nOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYW5hZ2VyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0NlbnNvckNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuY2Vuc29ycycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBDZW5zb3JDb250cm9sbGVyKTtcclxuXHJcbiAgICBDZW5zb3JDb250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckdWliTW9kYWwnLCAnY2Vuc29yU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIENlbnNvckNvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ0NlbnNvciBNYW5hZ2VyJztcclxuICAgICAgICB2bS5kZXNjcmlwdGlvbiA9ICdWaWV3IGFuZCBlZGl0IGNlbnNvcmVkIHdvcmRzJztcclxuICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgdm0uY2Vuc29ycyA9IFtdO1xyXG4gICAgICAgIHZtLmN1cnJlbnRFZGl0ID0ge307XHJcbiAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuICAgICAgICB2bS5pdGVtVG9FZGl0ID0ge307XHJcblxyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaCA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG5cclxuICAgICAgICAgICAgdmFyIHNlYXJjaFRlcm0gPSAnJztcclxuICAgICAgICAgICAgaWYgKHR5cGVvZiAodGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0KSAhPSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXJtID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS5xdWVyeShzZWFyY2hUZXJtKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW5zb3JzID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbEVkaXQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbaWRdID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY3JlYXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgaXRlbSA9IHt9O1xyXG4gICAgICAgICAgICAkbW9kYWwub3Blbih7XHJcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9hcHAvY2Vuc29ycy92aWV3cy9jZW5zb3IuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyOiBbJyR1aWJNb2RhbEluc3RhbmNlJywgJ2NlbnNvclNlcnZpY2UnLCAnaXRlbScsIGNyZWF0ZUNlbnNvckNvbnRyb2xsZXJdLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIGl0ZW06IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGl0ZW07IH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5yZXN1bHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnNvcnMudW5zaGlmdChkYXRhKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbiAoY2Vuc29yKSB7XHJcbiAgICAgICAgICAgIHZtLmxhc3REZWxldGVkID0gY2Vuc29yO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlbW92ZShjZW5zb3IuaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSB2bS5jZW5zb3JzLmluZGV4T2YoY2Vuc29yKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW5zb3JzLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZWRpdEl0ZW0gPSBmdW5jdGlvbiAoY2Vuc29yKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W2NlbnNvci5pZF0gPSB0cnVlO1xyXG4gICAgICAgICAgICB2bS5pdGVtVG9FZGl0ID0gYW5ndWxhci5jb3B5KGNlbnNvcik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZUl0ZW0gPSBmdW5jdGlvbiAoY2Vuc29yKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W2NlbnNvci5pZF0gPSBmYWxzZTtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KGNlbnNvciwgdm0ubGFzdFVwZGF0ZWQgPSB7fSk7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGNlbnNvciwgdm0uaXRlbVRvRWRpdCk7XHJcbiAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLml0ZW1Ub0VkaXQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNlbnNvciA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvRGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5sYXN0RGVsZXRlZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCAnICsgZGF0YS53b3JkKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jZW5zb3JzLnVuc2hpZnQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udW5kb0NoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0ubGFzdFVwZGF0ZWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5jZW5zb3JzLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbiAodSwgaSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHUuaWQgPT09IHZtLmxhc3RVcGRhdGVkLmlkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdm0uY2Vuc29yc1tpXSA9IHZtLmxhc3RVcGRhdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlc3RvcmVkICcgKyBkYXRhLndvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIGZ1bmN0aW9uIGNyZWF0ZUNlbnNvckNvbnRyb2xsZXIoJG1vZGFsLCBzZXJ2aWNlLCBpdGVtKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgdm0uaXRlbSA9IGFuZ3VsYXIuY29weShpdGVtKTtcclxuXHJcbiAgICAgICAgdm0uY2xvc2UgPSBjbG9zZTtcclxuICAgICAgICB2bS5zYXZlID0gc2F2ZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZSgpIHtcclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0uaXRlbSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXRlbSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKHZtLml0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYW5hZ2VyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnU2V0dGluZ3NDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNldHRpbmdzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAnJHRpbWVvdXQnLCAnY29uZmlndXJhdGlvblNlcnZpY2UnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIsICR0aW1lb3V0LCBzZXJ2aWNlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdTZXR0aW5ncyBDb25maWd1cmF0aW9uJztcclxuXHJcbiAgICAgICAgdm0uY29uZmlnID0ge307XHJcbiAgICAgICAgdmFyIGh1YiA9ICQuY29ubmVjdGlvbi53b3Q7XHJcblxyXG4gICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2bS5sYXN0U2F2ZWQgPSB7fTtcclxuICAgICAgICB2bS5zYXZlID0gc2F2ZTtcclxuICAgICAgICB2bS51bmRvID0gdW5kbztcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmVkJyk7XHJcbiAgICAgICAgICAgICQuY29ubmVjdGlvbi5odWIuc3RhcnQoKVxyXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdodWIgY29ubmVjdGlvbiBzdWNjZXNzZnVsJyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgZ2V0U2V0dGluZ3MoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRTZXR0aW5ncygpIHtcclxuICAgICAgICAgICAgc2VydmljZS5nZXQoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb25maWcgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RTYXZlZCA9IGFuZ3VsYXIuY29weSh2bS5jb25maWcpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc2F2ZSgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0uY29uZmlnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb25maWcgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGh1Yi5zZXJ2ZXIuY29uZmlndXJhdGlvbkNoYW5nZSh2bS5jb25maWcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdDaGFuZ2VzIHNhdmVkIGFuZCBzZW50IHRvIFdPVCcpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygnZmluYWxseSBjb21wZWx0ZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVuZG8oKSB7XHJcbiAgICAgICAgICAgIHZtLmNvbmZpZyA9IHZtLmxhc3RTYXZlZDtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvLyBibGFja2xpc3QuZGlyZWN0aXZlLmpzXHJcbi8vIG1hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpXHJcbiAgICAgICAgLmRpcmVjdGl2ZSgnYmxhY2tsaXN0TmFtZScsXHJcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzdHJpY3Q6ICdBJyxcclxuICAgICAgICAgICAgICAgICAgICBzY29wZToge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBibGFja2xpc3Q6ICc9J1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLiR2YWxpZGF0b3JzLmJsYWNrbGlzdCA9IGZ1bmN0aW9uIHRlc3QobW9kZWxWYWx1ZSwgdmlld1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgdmFsdWUgPSBtb2RlbFZhbHVlIHx8IHZpZXdWYWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2Zyb20gZGlyZWN0aXZlOiB2YWx1ZTogJyArIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coJ2Zyb20gZGlyZWN0aXZlOiBpbmRleE9mOiAnICsgc2NvcGUuYmxhY2tsaXN0LmluZGV4T2YodmFsdWUudG9VcHBlckNhc2UoKSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlKSByZXR1cm4gc2NvcGUuYmxhY2tsaXN0LmluZGV4T2YodmFsdWUudG9VcHBlckNhc2UoKSkgPT0gLTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9jbGVhci1rZXkuZGlyZWN0aXZlLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcpLmRpcmVjdGl2ZShcImNsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ25nTW9kZWwnLFxyXG4gICAgICAgICAgICBsaW5rOiBmdW5jdGlvbiAoc2NvcGUsIGVsLCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWwub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kc2V0Vmlld1ZhbHVlKG51bGwpO1xyXG4gICAgICAgICAgICAgICAgICAgIGN0cmwuJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLiRhcHBseSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vc21hcnQtdGFibGUuY2xlYXJLZXkuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwic3RDbGVhcktleVwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVzdHJpY3Q6ICdFQScsXHJcbiAgICAgICAgICAgIHJlcXVpcmU6ICdec3RUYWJsZScsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWxlbWVudCwgYXR0cnMsIGN0cmwpIHtcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQub24oJ2tleWRvd24nLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZXZlbnQud2hpY2ggIT09IDI3KSB7IHJldHVybjsgfSAvLyBjaGVjayBrZXkgaG93IHlvdSB3YW50XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNjb3BlLiRhcHBseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBmaWVsZE5hbWUgPSBlbGVtZW50LmNvbnRleHQuYXR0cmlidXRlc1snc3Qtc2VhcmNoJ10udmFsdWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciB0YWJsZVN0YXRlID0gY3RybC50YWJsZVN0YXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdFtmaWVsZE5hbWVdID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjdHJsLnBpcGUoKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgIH0pO1xyXG59KSgpOyIsIi8vYXBwLmZpbHRlci5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbmFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVyJykuZmlsdGVyKCdwZXJjZW50YWdlJywgWyckZmlsdGVyJywgZnVuY3Rpb24gKCRmaWx0ZXIpIHtcclxuICAgIHJldHVybiBmdW5jdGlvbiAoaW5wdXQsIGRlY2ltYWxzKSB7XHJcbiAgICAgICAgcmV0dXJuICRmaWx0ZXIoJ251bWJlcicpKGlucHV0ICogMTAwLCBkZWNpbWFscykgKyAnJSc7XHJcbiAgICB9O1xyXG59XSk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0hvbWVDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmhvbWUnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ3Blb3BsZVNlcnZpY2UnLCAnY2Vuc29yU2VydmljZScsICd1c2VyU2VydmljZScsICdzdG9yYWdlJywgJ2xvZ2dlciddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKHBlb3BsZVNlcnZpY2UsIGNlbnNvclNlcnZpY2UsIHVzZXJTZXJ2aWNlLCBzdG9yYWdlLCBsb2dnZXIpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ0hvbWUnO1xyXG5cclxuICAgICAgICB2bS5zdGF0ID0ge307XHJcbiAgICAgICAgdm0ucGVvcGxlID0gW107XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIHZhciBjZW5zb3JzID0gW107XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZlJyk7XHJcblxyXG4gICAgICAgICAgICB1c2VyU2VydmljZS5nZXQoKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjdXJyZW50VXNlcicsIEpTT04uc3RyaW5naWZ5KHZtLnVzZXIpKTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBjZW5zb3JzID0gSlNPTi5wYXJzZShzdG9yYWdlLmdldCgnY2Vuc29ycycpKTtcclxuXHJcbiAgICAgICAgICAgIGlmICghY2Vuc29ycykge1xyXG4gICAgICAgICAgICAgICAgY2Vuc29yU2VydmljZS5xdWVyeSgnJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0b3JhZ2Uuc2V0KCdjZW5zb3JzJywgSlNPTi5zdHJpbmdpZnkoZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2Vuc29ycyA9IEpTT04ucGFyc2Uoc3RvcmFnZS5nZXQoJ2NlbnNvcnMnKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlZnJlc2goKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiByZWZyZXNoKCkge1xyXG4gICAgICAgICAgICBwZW9wbGVTZXJ2aWNlLmdldEN1cnJlbnRTdGF0cygpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnN0YXQgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICBwZW9wbGVTZXJ2aWNlLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBlb3BsZSA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9raW9zay5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ0tpb3NrQ29udHJvbGxlcic7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIEtpb3NrQ29udHJvbGxlcik7XHJcblxyXG4gICAgS2lvc2tDb250cm9sbGVyLiRpbmplY3QgPSBbJyRzY29wZScsICckbG9nJywgJyRzdGF0ZScsICckdGltZW91dCcsICdwZW9wbGVTZXJ2aWNlJywgJ2NvbmZpZ3VyYXRpb25TZXJ2aWNlJywgJ2NlbnNvcnMnLCAnY29uZmlnJ107XHJcblxyXG4gICAgZnVuY3Rpb24gS2lvc2tDb250cm9sbGVyKCRzY29wZSwgbG9nZ2VyLCAkc3RhdGUsICR0aW1lb3V0LCBwZW9wbGVTZXJ2aWNlLCBjb25maWd1cmF0aW9uU2VydmljZSwgY2Vuc29ycywgY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2YXIgdGFibGVTdGF0ZVJlZjtcclxuICAgICAgICB2YXIgcHJldlNlbGVjdGlvbiA9IG51bGw7XHJcbiAgICAgICAgdmFyIHRpbWVyO1xyXG4gICAgICAgIHZhciB3YWl0VGltZSA9IDUwMDA7XHJcbiAgICAgICAgdmFyIGtleUNvZGUgPSAnJztcclxuICAgICAgICB2YXIgaHViID0gJC5jb25uZWN0aW9uLndvdDtcclxuXHJcbiAgICAgICAgdm0udGl0bGUgPSAnd2VsY29tZSc7XHJcbiAgICAgICAgdm0ucGVvcGxlID0gW107XHJcbiAgICAgICAgdm0uY29uZmlnID0gY29uZmlnO1xyXG4gICAgICAgIHZtLnNlYXJjaE1vZGVsID0ge1xyXG4gICAgICAgICAgICBwYWdlOiAxLFxyXG4gICAgICAgICAgICBwYWdlU2l6ZTogMTNcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLnNob3dWYWxpZGF0aW9uRXJyb3JzID0gZmFsc2U7XHJcbiAgICAgICAgdm0ua2lvc2sgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgna2lvc2snKSA/IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdraW9zaycpIDogJzEnO1xyXG4gICAgICAgIHZtLmF2YWlsYWJsZUtpb3NrcyA9IFsnMScsICcyJywgJzMnLCAnNCddO1xyXG5cclxuICAgICAgICAkLmNvbm5lY3Rpb24uaHViLnN0YXJ0KCkuZG9uZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdodWIgY29ubmVjdGlvbiBzdWNjZXNzZnVsJyk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIHZtLnRvZ2dsZU5hbWUgPSBmdW5jdGlvbiAocGVyc29uKSB7XHJcbiAgICAgICAgICAgIGlmIChwcmV2U2VsZWN0aW9uKSB7XHJcbiAgICAgICAgICAgICAgICBwcmV2U2VsZWN0aW9uLiRzZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChwcmV2U2VsZWN0aW9uID09PSBwZXJzb24pIHtcclxuICAgICAgICAgICAgICAgIHBlcnNvbi4kc2VsZWN0ZWQgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIHZtLnBlcnNvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgICAgICAgICAgIHByZXZTZWxlY3Rpb24gPSBudWxsO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgcGVyc29uLiRzZWxlY3RlZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB2bS5wZXJzb24gPSBwZXJzb247XHJcbiAgICAgICAgICAgICAgICBwcmV2U2VsZWN0aW9uID0gcGVyc29uO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc2V0VGltZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZXRGb2N1cyA9IGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICB2bS5lZGl0SXRlbSA9IGV2ZW50O1xyXG5cclxuICAgICAgICAgICAgaWYgKGV2ZW50KSB2bS5lZGl0SXRlbSA9IGV2ZW50O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmtleWJvYXJkSW5wdXQgPSBmdW5jdGlvbiAoa2V5KSB7XHJcbiAgICAgICAgICAgIHJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgdm0uc2hvd1ZhbGlkYXRpb25FcnJvcnMgPSB0cnVlO1xyXG4gICAgICAgICAgICB2YXIga2V5Q29kZSA9IGtleS5jdXJyZW50VGFyZ2V0Lm91dGVyVGV4dDtcclxuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09ICdTUEFDRScpIHtcclxuICAgICAgICAgICAgICAgIHZtLmxhc3RMZXR0ZXJJc1NwYWNlID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKGtleUNvZGUgPT09ICdERUwnKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5lZGl0SXRlbS4kc2V0Vmlld1ZhbHVlKHZtLmVkaXRJdGVtLiR2aWV3VmFsdWUuc3Vic3RyKDAsIHZtLmVkaXRJdGVtLiR2aWV3VmFsdWUubGVuZ3RoIC0gMSkpO1xyXG4gICAgICAgICAgICAgICAgdm0uZWRpdEl0ZW0uJHJlbmRlcigpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAodm0ubGFzdExldHRlcklzU3BhY2UpIHtcclxuICAgICAgICAgICAgICAgIHZtLmVkaXRJdGVtLiRzZXRWaWV3VmFsdWUodm0uZWRpdEl0ZW0uJHZpZXdWYWx1ZSArICcgJyArIGtleUNvZGUpO1xyXG4gICAgICAgICAgICAgICAgdm0ubGFzdExldHRlcklzU3BhY2UgPSBmYWxzZTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHZtLmVkaXRJdGVtLiRzZXRWaWV3VmFsdWUodm0uZWRpdEl0ZW0uJHZpZXdWYWx1ZSArIGtleUNvZGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHZtLmVkaXRJdGVtLiRyZW5kZXIoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5wYWdlZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcHJldlNlbGVjdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE5hbWUodGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udXBkYXRlS2lvc2sgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdjaGFuZ2VkIGtpb3NrJywgdm0ua2lvc2spO1xyXG4gICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgna2lvc2snLCB2bS5raW9zayk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2VhcmNoTmFtZSA9IGZ1bmN0aW9uICh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG5cclxuICAgICAgICAgICAgaWYgKHZtLnNlYXJjaEZvcm0gIT09IHVuZGVmaW5lZCAmJiB2bS5zZWFyY2hGb3JtLiRpbnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93VmFsaWRhdGlvbkVycm9ycyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdmFyIG5hbWVzID0gdm0uc2VhcmNoVGVybS5zcGxpdCgnICcpO1xyXG4gICAgICAgICAgICB2YXIgZm4gPSBuYW1lc1sxXSA/IG5hbWVzWzBdIDogJyc7XHJcbiAgICAgICAgICAgIHZhciBsbiA9IG5hbWVzWzFdIHx8IG5hbWVzWzBdO1xyXG5cclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZmlyc3RuYW1lID0gZm47XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmxhc3RuYW1lID0gbG47XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyQnkgPSAnZmlyc3RuYW1lJztcclxuXHJcbiAgICAgICAgICAgIHBlb3BsZVNlcnZpY2UucXVlcnkodm0uc2VhcmNoTW9kZWwpXHJcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgdm0ucGVvcGxlID0gZGF0YS5pdGVtcztcclxuICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSBkYXRhO1xyXG5cclxuICAgICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lLmxpc3QnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmdvQmFjayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICBoaXN0b3J5LmJhY2soKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5nb3RvUGxlZGdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodm0uY3JlYXRlRm9ybS4kaW52YWxpZCkge1xyXG4gICAgICAgICAgICAgICAgdm0uc2hvd1ZhbGlkYXRpb25FcnJvcnMgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgdG9hc3RyLmVycm9yKCdQbGVhc2UgY29ycmVjdCB5b3VyIGluZm9ybWF0aW9uJyk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZtLnBlcnNvbi5kYXRlQ3JlYXRlZCA9IG1vbWVudCgpLmZvcm1hdCgnTU0vREQvWVlZWSBISDptbTpzcycpO1xyXG4gICAgICAgICAgICB2bS5wZXJzb24uaXNEb25vciA9IHZtLnBlcnNvbi5pc1ByaW9yaXR5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgIHZtLnBlcnNvbi5maXJzdG5hbWUgPSBIdW1hbml6ZS50aXRsZUNhc2Uodm0ucGVyc29uLmZpcnN0bmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgdm0ucGVyc29uLmxhc3RuYW1lID0gSHVtYW5pemUudGl0bGVDYXNlKHZtLnBlcnNvbi5sYXN0bmFtZS50b0xvd2VyQ2FzZSgpKTtcclxuICAgICAgICAgICAgdm0ucGVyc29uLmZ1enp5TWF0Y2hWYWx1ZSA9IG1hdGNoVmFsdWUodm0ucGVyc29uKTtcclxuICAgICAgICAgICAgaWYgKHZtLnBlcnNvbi5lbWFpbEFkZHJlc3MpIHZtLnBlcnNvbi5lbWFpbEFkZHJlc3MgPSB2bS5wZXJzb24uZW1haWxBZGRyZXNzLnRvTG93ZXJDYXNlKCk7XHJcblxyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUucGxlZGdlJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNldFRpbWVyKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5nb3RvU2VhcmNoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUuc2VhcmNoJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zaG93VmFsaWRhdGlvbkVycm9ycyA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmVkaXRJdGVtID0gdm0uc2VhcmNoRm9ybS5zZWFyY2hUZXJtO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmdvdG9DcmVhdGUgPSBmdW5jdGlvbiBnb3RvQ3JlYXRlKCkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUuY3JlYXRlJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5lZGl0SXRlbSA9IHZtLmNyZWF0ZUZvcm0uZmlyc3RuYW1lO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dWYWxpZGF0aW9uRXJyb3JzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGVyc29uID0geyBmaXJzdG5hbWU6ICcnLCBsYXN0bmFtZTogJycgfTtcclxuICAgICAgICAgICAgICAgICAgICBjcmVhdGVWYWxpZGF0aW9uV2F0Y2hlcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0ucGVyc29uID0geyBmaXJzdG5hbWU6ICcnLCBsYXN0bmFtZTogJycgfTtcclxuICAgICAgICAgICAgdm0uc2VhcmNoVGVybSA9ICcnO1xyXG4gICAgICAgICAgICB2bS5wZW9wbGUgPSBbXTtcclxuXHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZScpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHRpbWVyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmZpbmlzaCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lLmZpbmlzaCcpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ3NlbmRpbmcgdG8gaHViJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaHViLnNlcnZlci5hZGROYW1lKHZtLmtpb3NrLCB2bS5wZXJzb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdTZW50IHBlcnNvbiB0byBXT1QnLCB2bS5wZXJzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHBlb3BsZVNlcnZpY2UuY3JlYXRlKHZtLnBlcnNvbilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZmluaXNoKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmxvY2tTZXR0aW5ncyA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ2tleUNvZGUnLCBrZXlDb2RlLCBmYWxzZSk7XHJcbiAgICAgICAgICAgIGlmIChrZXlDb2RlLmxlbmd0aCA+IDQpIHtcclxuICAgICAgICAgICAgICAgIGtleUNvZGUgPSBrZXk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBrZXlDb2RlICs9IGtleS50b1N0cmluZygpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gJzEyJykge1xyXG4gICAgICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lLmNvbmZpZycpXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBrZXlDb2RlID0gJyc7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKCdjdXJyZW50IGtpb3NrJywgdm0ua2lvc2spO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZUNvbmZpZyA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgY29uZmlndXJhdGlvblNlcnZpY2UudXBkYXRlKHZtLmNvbmZpZylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY29uZmlnID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB0b2FzdHIuc3VjY2VzcygnU2V0dGluZ3MgU2F2ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgaHViLnNlcnZlci5jb25maWd1cmF0aW9uQ2hhbmdlKHZtLmNvbmZpZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ0NoYW5nZXMgc2F2ZWQgYW5kIHNlbnQgdG8gV09UJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gbWF0Y2hWYWx1ZShwZXJzb24pIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gMC4wO1xyXG4gICAgICAgICAgICB2YXIgZm4gPSBnZXRGdWxsTmFtZShwZXJzb24pO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKGNlbnNvcnMsIGZ1bmN0aW9uIChjZW5zb3IpIHtcclxuICAgICAgICAgICAgICAgIHZhciBpZHggPSBjbGpfZnV6enkubWV0cmljcy5kaWNlKGZuLCBjZW5zb3Iud29yZCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoaWR4ID4gdmFsdWUpIHZhbHVlID0gaWR4O1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEZ1bGxOYW1lKHBlcnNvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gcGVyc29uLmZpcnN0bmFtZSArICcgJyArIHBlcnNvbi5sYXN0bmFtZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlc2V0VGltZXIoKSB7XHJcbiAgICAgICAgICAgICR0aW1lb3V0LmNhbmNlbCh0aW1lcik7XHJcbiAgICAgICAgICAgIHRpbWVyID0gJHRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgdm0uY2FuY2VsKCk7XHJcbiAgICAgICAgICAgIH0sIHdhaXRUaW1lKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGVWYWxpZGF0aW9uV2F0Y2hlcigpIHtcclxuICAgICAgICAgICAgLy9sb2dnZXIuaW5mbygnY3JlYXRpbmcgd2F0Y2hlcicsIHZtLnBlcnNvbiwgZmFsc2UpO1xyXG4gICAgICAgICAgICAkc2NvcGUuJHdhdGNoQ29sbGVjdGlvbigndm0ucGVyc29uJywgZnVuY3Rpb24gKG5ld1ZhbCwgb2xkVmFsKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAodm0ucGVyc29uKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB2YWxpZCA9IHZhbGlkYXRlUGVyc29uKHZtLnBlcnNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZtLmNyZWF0ZUZvcm0pIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY3JlYXRlRm9ybS5maXJzdG5hbWUuJHNldFZhbGlkaXR5KCdibGFja2xpc3QnLCB2YWxpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZtLmNyZWF0ZUZvcm0ubGFzdG5hbWUuJHNldFZhbGlkaXR5KCdibGFja2xpc3QnLCB2YWxpZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB2YWxpZGF0ZVBlcnNvbihwZXJzb24pIHtcclxuICAgICAgICAgICAgdmFyIGZ1bGxOYW1lID0gKHBlcnNvbi5maXJzdG5hbWUgPyBwZXJzb24uZmlyc3RuYW1lIDogJycpICsgJyAnICsgKHBlcnNvbi5sYXN0bmFtZSA/IHBlcnNvbi5sYXN0bmFtZSA6ICcnKTtcclxuICAgICAgICAgICAgdmFyIGZpcnN0bWF0Y2ggPSBjZW5zb3JzLnNvbWUoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUud29yZC50b1VwcGVyQ2FzZSgpID09PSAocGVyc29uLmZpcnN0bmFtZSA/IHBlcnNvbi5maXJzdG5hbWUudG9VcHBlckNhc2UoKSA6ICcnKTsgfSk7XHJcbiAgICAgICAgICAgIHZhciBsYXN0bWF0Y2ggPSBjZW5zb3JzLnNvbWUoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUud29yZC50b1VwcGVyQ2FzZSgpID09PSAocGVyc29uLmxhc3RuYW1lID8gcGVyc29uLmxhc3RuYW1lLnRvVXBwZXJDYXNlKCkgOiAnJyk7IH0pO1xyXG4gICAgICAgICAgICB2YXIgZnVsbG1hdGNoID0gY2Vuc29ycy5zb21lKGZ1bmN0aW9uIChlKSB7IHJldHVybiBlLndvcmQudG9VcHBlckNhc2UoKSA9PT0gZnVsbE5hbWUudG9VcHBlckNhc2UoKTsgfSk7XHJcblxyXG4gICAgICAgICAgICB2YXIgbWF0Y2ggPSBmaXJzdG1hdGNoIHx8IGxhc3RtYXRjaCB8fCBmdWxsbWF0Y2g7XHJcbiAgICAgICAgICAgIHJldHVybiAhbWF0Y2g7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vbmF2LmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnTmF2Q29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VycycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIobG9nZ2VyKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICAgICAgdm0udXNlciA9IEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2N1cnJlbnRVc2VyJykpO1xyXG4gICAgICAgIH1cclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYW5hZ2VyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnUGVvcGxlQ29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5wZW9wbGUnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgUGVvcGxlQ29udHJvbGxlcik7XHJcblxyXG4gICAgUGVvcGxlQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAncGVvcGxlU2VydmljZScsICckdWliTW9kYWwnLCAnY29uZmlnJ107XHJcblxyXG4gICAgZnVuY3Rpb24gUGVvcGxlQ29udHJvbGxlcihsb2dnZXIsIHNlcnZpY2UsICRtb2RhbCwgY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2YXIga2V5Q29kZXMgPSBjb25maWcua2V5Q29kZXM7XHJcblxyXG4gICAgICAgIHZtLnRpdGxlID0gXCJQZW9wbGUgTWFuYWdlclwiO1xyXG5cclxuICAgICAgICB2bS5jdXJyZW50RWRpdCA9IG51bGw7XHJcbiAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuXHJcbiAgICAgICAgdm0ucGVvcGxlID0gW107XHJcbiAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiAxNSxcclxuICAgICAgICAgICAgb3JkZXJCeTogJ0ZpcnN0bmFtZScsXHJcbiAgICAgICAgICAgIG9yZGVyRGlyZWN0aW9uOiAnZGVzYydcclxuICAgICAgICB9O1xyXG4gICAgICAgIHZtLnNlYXJjaFRlcm0gPSAnJztcclxuXHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uYWRkSXRlbSA9IGZ1bmN0aW9uIGFkZEl0ZW0oKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wZW9wbGUvdmlld3MvcGVyc29uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgLy9jb250cm9sbGVyOiBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdwZW9wbGVTZXJ2aWNlJywgJ2l0ZW0nLCAndm0nLCAnc3RvcmFnZScsIGVkaXRQZXJzb25Db250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3Blb3BsZVNlcnZpY2UnLCAndm0nLCAnc3RvcmFnZScsIGVkaXRQZXJzb25Db250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB2bTogdm1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5yZXN1bHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBlb3BsZS51bnNoaWZ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgY3JlYXRlZCAnICsgZ2V0RnVsbE5hbWUoZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZWRpdEl0ZW0gPSBmdW5jdGlvbiBlZGl0SXRlbShpdGVtKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0ID0gaXRlbTtcclxuICAgICAgICAgICAgJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvYXBwL3Blb3BsZS92aWV3cy9wZXJzb24uaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAvL2NvbnRyb2xsZXI6IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3Blb3BsZVNlcnZpY2UnLCAnaXRlbScsICd2bScsICdzdG9yYWdlJywgZWRpdFBlcnNvbkNvbnRyb2xsZXJdLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlcjogWydsb2dnZXInLCAnJHVpYk1vZGFsSW5zdGFuY2UnLCAncGVvcGxlU2VydmljZScsICd2bScsICdzdG9yYWdlJywgZWRpdFBlcnNvbkNvbnRyb2xsZXJdLFxyXG4gICAgICAgICAgICAgICAgY29udHJvbGxlckFzOiAndm0nLFxyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZToge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtOiB2bVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBhbmd1bGFyLmNvcHkodm0uY3VycmVudEVkaXQpO1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZXh0ZW5kKGl0ZW0sIGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgdXBkYXRlZCAnICsgZ2V0RnVsbE5hbWUoZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGZ1bmN0aW9uIGRlbGV0ZUl0ZW0ocGVyc29uKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucmVtb3ZlKHBlcnNvbi5pZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBwZXJzb247XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHZtLnBlb3BsZS5pbmRleE9mKHBlcnNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGVvcGxlLnNwbGljZShpZHgsIDEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCdEZWxldGVkIHBlcnNvbiAnICsgcGVyc29uLmZpcnN0bmFtZSArICcgJyArIHBlcnNvbi5sYXN0bmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvRGVsZXRlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5sYXN0RGVsZXRlZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCAnICsgZGF0YS5maXJzdG5hbWUgKyAnICcgKyBkYXRhLmxhc3RuYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wZW9wbGUudW5zaGlmdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZSh2bS5sYXN0VXBkYXRlZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLnBlb3BsZSxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHUsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlkID09PSB2bS5sYXN0VXBkYXRlZC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnBlb3BsZVtpXSA9IHZtLmxhc3RVcGRhdGVkO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlc3RvcmVkICcgKyB2bS5sYXN0VXBkYXRlZC5maXJzdG5hbWUgKyAnICcgKyB2bS5sYXN0VXBkYXRlZC5sYXN0bmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2VhcmNoID0gZnVuY3Rpb24gc2VhcmNoKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcbiAgICAgICAgICAgIGlmICghdm0uc2VhcmNoTW9kZWwuaXNQcmlvcml0eSkgdm0uc2VhcmNoTW9kZWwuaXNQcmlvcml0eSA9IG51bGw7XHJcblxyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5kYXRlQ3JlYXRlZCA9IHZtLmRheXNGaWx0ZXJcclxuICAgICAgICAgICAgICAgID8gbW9tZW50KCkuc3VidHJhY3QocGFyc2VJbnQodm0uZGF5c0ZpbHRlciksICdkYXlzJykuZm9ybWF0KCdNTS9ERC9ZWVlZJylcclxuICAgICAgICAgICAgICAgIDogbnVsbDtcclxuXHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc29ydC5wcmVkaWNhdGUpICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyQnkgPSB0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJEaXJlY3Rpb24gPSB0YWJsZVN0YXRlLnNvcnQucmV2ZXJzZSA/ICdkZXNjJyA6ICdhc2MnO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0eXBlb2YgKHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdCkgIT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgICAgICAgdm0uZGF5c0ZpbHRlciA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5kYXRlQ3JlYXRlZCA/IG51bGwgOiB2bS5kYXlzRmlsdGVyO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZGF0ZUNyZWF0ZWQgPSB2bS5kYXlzRmlsdGVyXHJcbiAgICAgICAgICAgICAgICAgICAgPyB2bS5zZWFyY2hNb2RlbC5kYXRlQ3JlYXRlZFxyXG4gICAgICAgICAgICAgICAgICAgIDogdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmRhdGVDcmVhdGVkO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZnV6enlNYXRjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZnV6enlNYXRjaFZhbHVlID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmZ1enp5TWF0Y2hWYWx1ZSAvIDEwMDtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZnV6enlNYXRjaFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc0Rvbm9yID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmlzRG9ub3I7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5maXJzdG5hbWUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZmlyc3RuYW1lO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwubGFzdG5hbWUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QubGFzdG5hbWU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC56aXBjb2RlID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnppcENvZGU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5lbWFpbEFkZHJlc3MgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZW1haWxBZGRyZXNzO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuaXNQcmlvcml0eSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5pc1ByaW9yaXR5O1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHZtLnNlYXJjaE1vZGVsKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wZW9wbGUgPSBkYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnBhZ2VzID0gZnVuY3Rpb24gcGFnZWQocGFnZU51bSkge1xyXG4gICAgICAgICAgICBzZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ucXVpY2tGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRGdWxsTmFtZShwZXJzb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBlcnNvbi5maXJzdG5hbWUgKyAnICcgKyBwZXJzb24ubGFzdG5hbWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICAvL2Z1bmN0aW9uIGVkaXRQZXJzb25Db250cm9sbGVyKGxvZ2dlciwgJG1vZGFsLCBzZXJ2aWNlLCBpdGVtLCBtb2RlbCwgc3RvcmFnZSkge1xyXG4gICAgZnVuY3Rpb24gZWRpdFBlcnNvbkNvbnRyb2xsZXIobG9nZ2VyLCAkbW9kYWwsIHNlcnZpY2UsIG1vZGVsLCBzdG9yYWdlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICAvL1RPRE86IENhbiBiZSBtYWRlIGdsb2JhbD8/XHJcbiAgICAgICAgdmFyIGNlbnNvcnMgPSBKU09OLnBhcnNlKHN0b3JhZ2UuZ2V0KCdjZW5zb3JzJykpO1xyXG5cclxuICAgICAgICB2bS5pdGVtID0gYW5ndWxhci5jb3B5KG1vZGVsLmN1cnJlbnRFZGl0KTtcclxuXHJcbiAgICAgICAgdm0uY2xvc2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRtb2RhbC5kaXNtaXNzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ubWF0Y2hWYWx1ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdmFyIHZhbHVlID0gMC4wO1xyXG4gICAgICAgICAgICB2YXIgZm4gPSBnZXRGdWxsTmFtZSh2bS5pdGVtKTtcclxuXHJcbiAgICAgICAgICAgIF8uZm9yRWFjaChjZW5zb3JzLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKGNlbnNvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSBjbGpfZnV6enkubWV0cmljcy5kaWNlKGZuLCBjZW5zb3Iud29yZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGlkeCA+IHZhbHVlKSB2YWx1ZSA9IGlkeDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5pdGVtLmZ1enp5TWF0Y2hWYWx1ZSA9IHZhbHVlO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNhdmUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5pdGVtLmlkKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZSh2bS5pdGVtKVxyXG4gICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICRtb2RhbC5jbG9zZShkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UuY3JlYXRlKHZtLml0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RnVsbE5hbWUoaXRlbSkge1xyXG4gICAgICAgICAgICByZXR1cm4gaXRlbS5maXJzdG5hbWUgKyAnICcgKyBpdGVtLmxhc3RuYW1lO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL3Byb2ZpbGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdQcm9maWxlQ29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC51c2VycycpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRodHRwJywgJ2xvZ2dlcicsICd1c2VyU2VydmljZScsICdkZWZhdWx0cycsICdjb25maWcnLCAnJHJvb3RTY29wZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKCRzY29wZSwgJGh0dHAsIGxvZ2dlciwgc2VydmljZSwgZGVmYXVsdHMsIGNvbmZpZywgJHJvb3RTY29wZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnUHJvZmlsZSBNYW5hZ2VyJztcclxuICAgICAgICB2bS5kZXNjcmlwdGlvbiA9ICdVcGRhdGUgeW91ciBwcm9maWxlJztcclxuXHJcbiAgICAgICAgdm0udXNlciA9IHt9O1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICB2bS51c2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudFVzZXInKSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZmlsZVNlbGVjdGVkID0gZnVuY3Rpb24gKCRmaWxlcywgJGZpbGUsICRldmVudCwgJHJlamVjdGVkRmlsZXMpIHtcclxuICAgICAgICAgICAgdmFyIHJlYWRlciA9IG5ldyBGaWxlUmVhZGVyKCk7XHJcbiAgICAgICAgICAgIHJlYWRlci5vbmxvYWQgPSBmdW5jdGlvbiAoZSkge1xyXG4gICAgICAgICAgICAgICAgdmFyIGRhdGFVUkwgPSByZWFkZXIucmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgdm0udXNlci51c2VyUGhvdG8gPSBkYXRhVVJMLnNwbGl0KCcsJylbMV07XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyLnVzZXJQaG90b1R5cGUgPSAkZmlsZS50eXBlO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTCgkZmlsZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0uaXNCdXN5ID0gdHJ1ZTtcclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0udXNlcilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlciA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2N1cnJlbnRVc2VyJywgSlNPTi5zdHJpbmdpZnkodm0udXNlcikpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5maWxlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wcm9maWxlRm9ybS4kc2V0UHJpc3RpbmUoKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hdmF0YXJGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9jZW5zb3Iuc2VydmljZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICdjZW5zb3JTZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5DZW5zb3I7XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShjZW5zb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBjZW5zb3IpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KHNlYXJjaFRlcm0pIHtcclxuICAgICAgICAgICAgaWYgKHNlYXJjaFRlcm0gPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gZ2V0KCk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvP3NlYXJjaD0nICsgc2VhcmNoVGVybSkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoY2Vuc29yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBjZW5zb3IpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvJyArIGlkKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG59KSgpOyIsIi8vY29uZmlndXJhdGlvbi5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ2NvbmZpZ3VyYXRpb25TZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCAnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuQ29uZmlndXJhdGlvbjtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGdldDogZ2V0LFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKGNvbmZpZykge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgY29uZmlnKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL3Blb3BsZS5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3Blb3BsZVNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcsIGV4Y2VwdGlvbikge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuUGVyc29uO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICAgICAgICAgIGdldDogZ2V0LFxyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnksXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlLFxyXG4gICAgICAgICAgICByZW1vdmU6IHJlbW92ZSxcclxuICAgICAgICAgICAgZ2V0Q3VycmVudFN0YXRzOiBnZXRDdXJyZW50U3RhdHNcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUoY2Vuc29yKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCwgY2Vuc29yKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcylcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkgeyBleGNlcHRpb24uY2F0Y2hlcignRmFpbGVkIHRvIHJldHJpZXZlIHBlb3BsZScpKG1lc3NhZ2UpOyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHF1ZXJ5KHNlYXJjaCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL3NlYXJjaCcsIHNlYXJjaClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7IGV4Y2VwdGlvbi5jYXRjaGVyKCdGYWlsZWQgdG8gcmV0cmlldmUgcGVvcGxlJykobWVzc2FnZSk7IH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKHBlcnNvbikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgcGVyc29uKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlbW92ZShpZCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZGVsZXRlKHVybCArICcvJyArIGlkKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldEN1cnJlbnRTdGF0cygpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnL3N0YXQnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oX3N1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKG1lc3NhZ2UpIHsgZXhjZXB0aW9uLmNhdGNoZXIoJ0ZhaWxlZCB0byByZXRyaWV2ZSBzdGF0cycpKG1lc3NhZ2UpOyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSkoKTsiLCIvL3VzZXIuc2VydmljZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIHNlcnZpY2VJZCA9ICd1c2VyU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZykge1xyXG4gICAgICAgIGxvZ2dlci5sb2coc2VydmljZUlkICsgJyBsb2FkZWQnKTtcclxuICAgICAgICB2YXIgdXJsID0gY29uZmlnLmFwaVVybCArIGNvbmZpZy5hcGlFbmRQb2ludHMuVXNlcjtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGF2YWlsYWJsZVJvbGVzOiBhdmFpbGFibGVSb2xlcyxcclxuICAgICAgICAgICAgY3JlYXRlOiBjcmVhdGUsXHJcbiAgICAgICAgICAgIGdldDogZ2V0LFxyXG4gICAgICAgICAgICBxdWVyeTogcXVlcnksXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgdXBsb2FkQXZhdGFyOiB1cGxvYWRBdmF0YXJcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJldHVybiBzZXJ2aWNlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhdmFpbGFibGVSb2xlcygpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwgKyAnL3JvbGVzJykudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBjcmVhdGUodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIHVzZXIpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy9UT0RPOiBOZWVkIGEgZ2V0YnluYW1lIGZ1bmN0aW9uXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBxdWVyeShzZWFyY2hUZXJtKSB7XHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hUZXJtICE9IHVuZGVmaW5lZCAmJiBzZWFyY2hUZXJtLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJz9zZWFyY2hUZXJtPScgKyBzZWFyY2hUZXJtKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXQodXJsKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBkYXRlKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIHVzZXIpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsICsgJy8nICsgaWQpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdXBsb2FkQXZhdGFyKHVzZXJuYW1lLCBhdmF0YXIpIHtcclxuICAgICAgICAgICAgdmFyIGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGZvcm1EYXRhLmFwcGVuZCgnZmlsZScsIGF2YXRhcik7XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwgKyAnL3VwbG9hZEF2YXRhci8nICsgdXNlcm5hbWUgKyAnLycsXHJcbiAgICAgICAgICAgICAgICAgICAgZm9ybURhdGEsXHJcbiAgICAgICAgICAgICAgICAgICAgeyBoZWFkZXJzOiB7ICdDb250ZW50LVR5cGUnOiB1bmRlZmluZWQgfSB9XHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ1VzZXJDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIFVzZXJDb250cm9sbGVyKTtcclxuXHJcbiAgICBVc2VyQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAndXNlclNlcnZpY2UnLCAnZGVmYXVsdHMnLCAnY29uZmlnJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVXNlckNvbnRyb2xsZXIobG9nZ2VyLCBzZXJ2aWNlLCBkZWZhdWx0cywgY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdVc2VyIE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gJ0VkaXQgYW5kIHVwZGF0ZSB1c2Vycyc7XHJcbiAgICAgICAgdmFyIGtleUNvZGVzID0gY29uZmlnLmtleUNvZGVzO1xyXG5cclxuICAgICAgICB2bS5hdmFpbGFibGVSb2xlcyA9IFtdO1xyXG4gICAgICAgIHZtLmNsZWFyQ3JlYXRlID0gY2xlYXJDcmVhdGU7XHJcbiAgICAgICAgdm0uY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgIHZtLml0ZW1Ub0VkaXQgPSB7fTtcclxuXHJcbiAgICAgICAgdm0udXNlciA9IHtcclxuICAgICAgICAgICAgLy91c2VyTmFtZTogbnVsbCxcclxuICAgICAgICAgICAgcm9sZXM6IFsndXNlciddLFxyXG4gICAgICAgICAgICBmdWxsTmFtZTogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBkZWZhdWx0cy5HRU5FUklDX1BBU1NXT1JEXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIGdldEF2YWlsYWJsZVJvbGVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uYWRkSXRlbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0udXNlci5mdWxsTmFtZSA9IHBhcnNlRnVsbE5hbWUodm0udXNlci51c2VyTmFtZSk7XHJcbiAgICAgICAgICAgIHZtLnVzZXIuZW1haWwgPSB2bS51c2VyLnVzZXJOYW1lICsgZGVmYXVsdHMuRU1BSUxfU1VGRklYO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0udXNlcilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBtYXBwaW5nIHdvdWxkIGFsbG93IHJlbW92YWwgb2YgZXh0ZW5kIG1ldGhvZFxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXIgPSBhbmd1bGFyLmV4dGVuZCh2bS51c2VyLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2Vycy51bnNoaWZ0KGFuZ3VsYXIuY29weSh2bS51c2VyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1VzZXIgJyArIHZtLnVzZXIudXNlck5hbWUgKyAnIGNyZWF0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlci51c2VyTmFtZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBzaG93IGVycm9yIHVzZXIgYWxyZWFkeSBleGlzdHNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbEVkaXQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbaWRdID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuY29weSh1c2VyLCB2bS5sYXN0RGVsZXRlZCA9IHt9KTtcclxuICAgICAgICAgICAgc2VydmljZS5yZW1vdmUodXNlci5pZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHZtLnVzZXJzLmluZGV4T2YodXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5lZGl0SXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W3VzZXIuaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KHVzZXIsIHZtLml0ZW1Ub0VkaXQgPSB7fSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlUm9sZXMoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuYXZhaWxhYmxlUm9sZXMoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVSb2xlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlSXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFt1c2VyLmlkXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmNvcHkodXNlciwgdm0ubGFzdFVwZGF0ZWQgPSB7fSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coJ2xhc3RVcGRhdGVkJywgdm0ubGFzdFVwZGF0ZWQpO1xyXG4gICAgICAgICAgICB2YXIgcm9sZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5pdGVtVG9FZGl0LnJvbGVzLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJvbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByb2xlcy5wdXNoKHJvbGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0uaXRlbVRvRWRpdC5yb2xlcyA9IHJvbGVzO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0uaXRlbVRvRWRpdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodXNlciwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1VzZXIgJyArIGRhdGEudXNlck5hbWUgKyAnIHVwZGF0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgdmFyIHNlYXJjaFRlcm07XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXJtID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucXVlcnkoc2VhcmNoVGVybSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ3VzZXJzJywgdm0udXNlcnMpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnVuZG9EZWxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByb2xlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxhc3REZWxldGVkLnJvbGVzLCBmdW5jdGlvbiAocm9sZSkge1xyXG4gICAgICAgICAgICAgICAgcm9sZXMucHVzaChyb2xlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygncm9sZScsIHJvbGUubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5sYXN0RGVsZXRlZC5yb2xlcyA9IHJvbGVzO1xyXG4gICAgICAgICAgICB2bS5sYXN0RGVsZXRlZC5wYXNzd29yZCA9IGRlZmF1bHRzLkdFTkVSSUNfUEFTU1dPUkQ7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5sYXN0RGVsZXRlZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCAnICsgZGF0YS51c2VyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB2bS51c2Vycy51bnNoaWZ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0ubGFzdFVwZGF0ZWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS51c2VycyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHUsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlkID09PSB2bS5sYXN0VXBkYXRlZC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzW2ldID0gdm0ubGFzdFVwZGF0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEudXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhckNyZWF0ZSgkZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKCRldmVudC5rZXlDb2RlID09PSBrZXlDb2Rlcy5lc2MpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXIudXNlck5hbWUgPSAnJztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwYXJzZUZ1bGxOYW1lKG5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIGFyciA9IG5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gJyc7XHJcblxyXG4gICAgICAgICAgICBfLmZvckVhY2goYXJyLCBmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgICAgICAgZnVsbG5hbWUgKz0gXy5jYXBpdGFsaXplKHYpICsgJyAnO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfLnRyaW0oZnVsbG5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
