//app.module.js
//mark.lawrence

(function () {
    angular.module('app',
    [
        //application modules
        'app.core',
        'app.service',
        'app.filter',

        //feature areas
        'app.nav',
        'app.home',
        'app.censors',
        'app.people',
        'app.settings',
        'app.users',
        'app.profile',
        'app.kiosk'
    ]).config(['$stateProvider', '$urlRouterProvider', config]).run(['$rootScope', 'logger', 'userService', function ($rootScope, logger, service) {
        logger.log('app running');
    }]);

    function config($stateProvider, $urlRouterProvider) {
        //$locationProvider.html5Mode(true);

        $stateProvider
            .state('home',
                    {
                        url: '/',
                        templateUrl: 'app/kiosk/views/home.html',
                        controller: 'KioskController',
                        controllerAs: 'vm',
                        resolve: {
                            censors: function (censorService) {
                                return censorService.get();
                            },
                            config: function (configurationService) {
                                return configurationService.get();
                            }
                        }
                    })
            .state('home.create',
                    {
                        url: 'create',
                        templateUrl: 'app/kiosk/views/partial-create.html'
                    })
            .state('home.search',
                    {
                        url: 'search',
                        templateUrl: 'app/kiosk/views/partial-search.html'
                    })
            .state('home.pledge',
                    {
                        url: 'pledge',
                        templateUrl: 'app/kiosk/views/partial-pledge.html'
                    })
            .state('home.list',
                    {
                        url: 'list',
                        templateUrl: 'app/kiosk/views/partial-list.html'
                    })
            .state('home.finish',
                    {
                        url: 'finish',
                        templateUrl: 'app/kiosk/views/partial-finish.html'
                    })
            .state('home.config',
                    {
                        url: 'configuration',
                        templateUrl: 'app/kiosk/views/partial-config.html'
                    });

        $urlRouterProvider.otherwise('/');
    };
})();
//core.module.js
//mark.lawrence

(function () {
    angular.module('app.core',
        [
            //angular modules
            'ngMessages',
            'angularLocalStorage',
            'ui.router',
            'ngAnimate',

            //custom modules
            'blocks.logger',
            'blocks.exception',

            //third party modules
            'smart-table',
            'ui.bootstrap',
            'ngTagsInput',
            'ngFileUpload',
            'rzModule',
            'switcher',
            'gfl.textAvatar'
        ])
        .constant('toastr', toastr)
        .constant('moment', moment);;
})();
//config.js
//mark.lawrence
(function () {
    function toastrConfig(toastr) {
        toastr.options.timeOut = 4000;
        toastr.options.positionClass = 'toast-bottom-right';
    };

    var keyCodes = {
        backspace: 8,
        tab: 9,
        enter: 13,
        esc: 27,
        space: 32,
        pageup: 33,
        pagedown: 34,
        end: 35,
        home: 36,
        left: 37,
        up: 38,
        right: 39,
        down: 40,
        insert: 45,
        del: 46
    };

    var apiEndPoints = {
        Censor: 'censor',
        Person: 'person',
        User: 'users',
        Configuration: 'configuration'
    };

    var config = {
        appErrorPrefix: '[CRMC Error] ', //Configure the exceptionHandler decorator
        appTitle: 'CRMC',
        version: '1.0.0',
        apiUrl: 'http://' + window.location.host + '/api/',
        keyCodes: keyCodes,
        apiEndPoints: apiEndPoints
    };

    var defaults = {
        EMAIL_SUFFIX: '@splcenter.org',
        GENERIC_PASSWORD: '1P@ssword'
    };

    angular.module('app.core')
        .config(toastrConfig)
        .constant('config', config)
        .value('defaults', defaults);
})();
//mark.lawrence
//exception.module.js

(function () {
    angular.module('blocks.exception', ['blocks.logger']);
})();
(function () {
    'use strict';

    angular.module('blocks.logger', []);
})();
//censors.module.js
//mark.lawrence

(function () {
    angular.module('app.censors', []);
})();
//settomgs.module.js
//mark.lawrence

(function () {
    angular.module('app.settings', []);
})();
//filter.module.js
//mark.lawrence

(function () {
    angular.module('app.filter', []);
})();
(function () {
    'use strict';

    angular.module('app.home', []);
})();
(function () {
    'use strict';

    angular.module('app.kiosk', []);
})();

//(function () {
//    "use strict";
//    angular.module('app.kiosk', []);

//    //app.config(['$stateProvider', '$urlRouterProvider', config]);

//    //function config($stateProvider, $urlRouterProvider) {
//    //    //$locationProvider.html5Mode(true);

//    //    $stateProvider
//    //        .state('home',
//    //                {
//    //                    url: '/',
//    //                    templateUrl: 'app/kiosk/views/home.html',
//    //                    controller: 'KioskController',
//    //                    controllerAs: 'vm',
//    //                    resolve: {
//    //                        censors: function (censorService) {
//    //                            return censorService.get();
//    //                        },
//    //                        config: function (configurationService) {
//    //                            return configurationService.get();
//    //                        }
//    //                    }
//    //                })
//    //        .state('home.create',
//    //                {
//    //                    url: 'create',
//    //                    templateUrl: 'app/kiosk/views/partial-create.html'
//    //                })
//    //        .state('home.search',
//    //                {
//    //                    url: 'search',
//    //                    templateUrl: 'app/kiosk/views/partial-search.html'
//    //                })
//    //        .state('home.pledge',
//    //                {
//    //                    url: 'pledge',
//    //                    templateUrl: 'app/kiosk/views/partial-pledge.html'
//    //                })
//    //        .state('home.list',
//    //                {
//    //                    url: 'list',
//    //                    templateUrl: 'app/kiosk/views/partial-list.html'
//    //                })
//    //        .state('home.finish',
//    //                {
//    //                    url: 'finish',
//    //                    templateUrl: 'app/kiosk/views/partial-finish.html'
//    //                })
//    //        .state('home.config',
//    //                {
//    //                    url: 'configuration',
//    //                    templateUrl: 'app/kiosk/views/partial-config.html'
//    //                });

//    //    $urlRouterProvider.otherwise('/');
//    //}
//}());
//mark.lawrence
//nav.module.js

(function () {
    angular.module('app.nav', []);
})();
//people.module.js
//mark.lawrence

(function () {
    angular.module('app.people', []);
})();
//mark.lawrence
//profile.module.js

(function () {
    angular.module('app.profile', []);
})();
//service.module.js
//mark.lawrence

(function () {
    angular.module('app.service', []);
})();
(function () {
    'use strict';

    angular.module('app.users', []);
})();
//mark.lawrence
//exception-handler.provider.js

// Include in index.html so that app level exceptions are handled.
// Exclude from testRunner.html which should run exactly what it wants to run
(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .provider('exceptionHandler', exceptionHandlerProvider)
        .config(config);

    /**
     * Must configure the exception handling
     * @return {[type]}
     */
    function exceptionHandlerProvider() {
        /* jshint validthis:true */
        this.config = {
            appErrorPrefix: undefined
        };

        this.configure = function (appErrorPrefix) {
            this.config.appErrorPrefix = appErrorPrefix;
        };

        this.$get = function () {
            return { config: this.config };
        };
    };

    /**
     * Configure by setting an optional string value for appErrorPrefix.
     * Accessible via config.appErrorPrefix (via config value).
     * @param  {[type]} $provide
     * @return {[type]}
     * @ngInject
     */
    function config($provide) {
        $provide.decorator('$exceptionHandler', extendExceptionHandler);
    };

    /**
     * Extend the $exceptionHandler service to also display a toast.
     * @param  {Object} $delegate
     * @param  {Object} exceptionHandler
     * @param  {Object} logger
     * @return {Function} the decorated $exceptionHandler service
     */
    function extendExceptionHandler($delegate, exceptionHandler, logger) {
        return function (exception, cause) {
            var appErrorPrefix = exceptionHandler.config.appErrorPrefix || '';
            var errorData = { exception: exception, cause: cause };
            exception.message = appErrorPrefix + exception.message;
            $delegate(exception, cause);
            /**
             * Could add the error to a service's collection,
             * add errors to $rootScope, log errors to remote web server,
             * or log locally. Or throw hard. It is entirely up to you.
             * throw exception;
             *
             * @example
             *     throw { message: 'error message we added' };
             */
            logger.error(exception.message, errorData);
        };
    };
})();
//mark.lawrence
//exception.js

(function () {
    'use strict';

    angular
        .module('blocks.exception')
        .factory('exception', exception);

    /* @ngInject */
    function exception(logger) {
        var service = {
            catcher: catcher
        };

        return service;

        function catcher(message) {
            return function (reason) {
                logger.error(message, reason);
            };
        };
    };
})();
//mark.lawrence
//logger.js

(function () {
    'use strict';

    angular.module('blocks.logger').factory('logger', logger);

    logger.$inject = ['$log', 'toastr'];

    function logger($log, toastr) {
        var service = {
            showToasts: true,

            error: error,
            info: info,
            success: success,
            warning: warning,

            // straight to console; bypass toastr
            log: $log.log
        };

        return service;
        /////////////////////

        function error(message, data, title) {
            toastr.error(message, title);
            $log.error('Error: ' + message, data);
        };

        function info(message, data, title) {
            toastr.info(message, title);
            $log.info('Info: ' + message, data);
        };

        function success(message, data, title) {
            toastr.success(message, title);
            $log.info('Success: ' + message, data);
        };

        function warning(message, data, title) {
            toastr.warning(message, title);
            $log.warn('Warning: ' + message, data);
        };
    };
})();
//manager.js
//mark.lawrence

(function () {
    'use strict';

    var controllerId = 'CensorController';

    angular.module('app.censors').controller(controllerId, CensorController);

    CensorController.$inject = ['logger', '$uibModal', 'censorService'];

    function CensorController(logger, $modal, service) {
        var vm = this;
        vm.title = 'Censor Manager';
        vm.description = 'View and edit censored words';
        vm.isBusy = false;

        vm.censors = [];
        vm.currentEdit = {};
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;

            var searchTerm = '';
            if (typeof (tableState.search.predicateObject) != "undefined") {
                searchTerm = tableState.search.predicateObject.searchTerm;
            }
            vm.isBusy = true;
            service.query(searchTerm)
                .then(function (data) {
                    vm.censors = data;
                    vm.isBusy = false;
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.create = function () {
            var item = {};
            $modal.open({
                templateUrl: '/app/censors/views/censor.html',
                controller: ['$uibModalInstance', 'censorService', 'item', createCensorController],
                controllerAs: 'vm',
                resolve: {
                    item: function () { return item; }
                }
            })
                .result.then(function (data) {
                    vm.censors.unshift(data);
                });
        };

        vm.deleteItem = function (censor) {
            vm.lastDeleted = censor;
            service.remove(censor.id)
                .then(function (data) {
                    var idx = vm.censors.indexOf(censor);
                    vm.censors.splice(idx, 1);
                });
        };

        vm.editItem = function (censor) {
            vm.currentEdit[censor.id] = true;
            vm.itemToEdit = angular.copy(censor);
        };

        vm.saveItem = function (censor) {
            vm.currentEdit[censor.id] = false;
            angular.copy(censor, vm.lastUpdated = {});
            angular.extend(censor, vm.itemToEdit);
            service.update(vm.itemToEdit)
                .then(function (data) {
                    censor = data;
                });
        };

        vm.undoDelete = function () {
            service.create(vm.lastDeleted)
                .then(function (data) {
                    logger.success('Successfully restored ' + data.word);
                    vm.censors.unshift(data);
                    vm.lastDeleted = null;
                });
        };

        vm.undoChange = function () {
            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.censors,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.censors[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.word);
                    vm.lastUpdated = null;
                });
        };
    };

    function createCensorController($modal, service, item) {
        var vm = this;

        vm.item = angular.copy(item);

        vm.close = close;
        vm.save = save;

        function close() {
            $modal.dismiss();
        };

        function save() {
            service.create(vm.item)
                .then(function (data) {
                    vm.item = data;
                    $modal.close(vm.item);
                });
        };
    };
})();
//manager.js
//mark.lawrence

(function () {
    var controllerId = 'SettingsController';

    angular.module('app.settings').controller(controllerId, mainController);

    mainController.$inject = ['logger', '$timeout', 'configurationService'];

    function mainController(logger, $timeout, service) {
        var vm = this;
        vm.title = 'Settings Configuration';

        vm.config = {};
        var hub = $.connection.wot;

        vm.isBusy = false;

        vm.lastSaved = {};
        vm.save = save;
        vm.undo = undo;

        activate();

        function activate() {
            logger.log(controllerId + ' actived');
            $.connection.hub.start()
                .done(function () {
                    logger.info('hub connection successful');
                });
            getSettings();
        };

        function getSettings() {
            service.get()
                .then(function (data) {
                    vm.config = data;
                    vm.lastSaved = angular.copy(vm.config);
                });
        };

        function save() {
            vm.isBusy = true;
            service.update(vm.config)
                .then(function (data) {
                    vm.config = data;
                    hub.server.configurationChange(vm.config)
                        .then(function () {
                            logger.info('Changes saved and sent to WOT');
                        });
                })
                .finally(function () {
                    logger.log('finally compelted');
                    vm.isBusy = false;
                });
        };

        function undo() {
            vm.config = vm.lastSaved;
        };
    };
})();
// blacklist.directive.js
// mark.lawrence

(function () {
    'use strict';

    angular.module('app')
        .directive('blacklistName',
            function () {
                return {
                    restrict: 'A',
                    scope: {
                        blacklist: '='
                    },
                    require: 'ngModel',
                    link: function (scope, ele, attrs, ctrl) {
                        ctrl.$validators.blacklist = function test(modelValue, viewValue) {
                            var value = modelValue || viewValue;
                            //console.log('from directive: value: ' + value);
                            //console.log('from directive: indexOf: ' + scope.blacklist.indexOf(value.toUpperCase()));
                            if (value) return scope.blacklist.indexOf(value.toUpperCase()) == -1;
                        };
                    }
                }
            });
})();
//mark.lawrence
//clear-key.directive.js

(function () {
    angular.module('app').directive("clearKey", function () {
        return {
            restrict: 'EA',
            require: 'ngModel',
            link: function (scope, el, attrs, ctrl) {
                el.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    ctrl.$setViewValue(null);
                    ctrl.$render();
                    scope.$apply();
                });
            }
        };
    });
})();
//mark.lawrence
//smart-table.clearKey.js

(function () {
    angular.module('app').directive("stClearKey", function () {
        return {
            restrict: 'EA',
            require: '^stTable',
            link: function (scope, element, attrs, ctrl) {
                element.on('keydown', function (event) {
                    if (event.which !== 27) { return; } // check key how you want
                    return scope.$apply(function () {
                        var fieldName = element.context.attributes['st-search'].value;
                        var tableState = ctrl.tableState();
                        tableState.search.predicateObject[fieldName] = '';
                        return ctrl.pipe();
                    });
                });
            }
        };
    });
})();
//app.filter.js
//mark.lawrence

angular.module('app.filter').filter('percentage', ['$filter', function ($filter) {
    return function (input, decimals) {
        return $filter('number')(input * 100, decimals) + '%';
    };
}]);
(function () {
    'use strict';

    var controllerId = 'HomeController';

    angular.module('app.home').controller(controllerId, mainController);

    mainController.$inject = ['peopleService', 'censorService', 'userService', 'storage', 'logger'];

    function mainController(peopleService, censorService, userService, storage, logger) {
        var vm = this;
        vm.title = 'Home';

        vm.stat = {};
        vm.people = [];

        activate();

        var censors = [];

        function activate() {
            logger.log(controllerId + ' active');

            userService.get().then(function (data) {
                vm.user = data;
                localStorage.setItem('currentUser', JSON.stringify(vm.user));
            });

            censors = JSON.parse(storage.get('censors'));

            if (!censors) {
                censorService.query('')
                        .then(function (data) {
                            storage.set('censors', JSON.stringify(data));
                            censors = JSON.parse(storage.get('censors'));
                        });
            }
            refresh();
        };

        function refresh() {
            peopleService.getCurrentStats()
                .then(function (data) {
                    vm.stat = data;
                });

            peopleService.get()
                .then(function (data) {
                    vm.people = data;
                });
        };
    };
})();
//mark.lawrence
//kiosk.js

(function () {
    'use strict';

    var controllerId = 'KioskController';
    angular.module('app').controller(controllerId, KioskController);

    KioskController.$inject = ['$scope', '$log', '$state', '$timeout', 'peopleService', 'configurationService', 'censors', 'config'];

    function KioskController($scope, logger, $state, $timeout, peopleService, configurationService, censors, config) {
        var vm = this;
        var tableStateRef;
        var prevSelection = null;
        var timer;
        var waitTime = 5000;
        var keyCode = '';
        var hub = $.connection.wot;

        vm.title = 'welcome';
        vm.people = [];
        vm.config = config;
        vm.searchModel = {
            page: 1,
            pageSize: 13
        };
        vm.showValidationErrors = false;
        vm.kiosk = localStorage.getItem('kiosk') ? localStorage.getItem('kiosk') : '1';
        vm.availableKiosks = ['1', '2', '3', '4'];

        $.connection.hub.start().done(function () {
            logger.info('hub connection successful');
        });

        vm.toggleName = function (person) {
            if (prevSelection) {
                prevSelection.$selected = false;
            }
            if (prevSelection === person) {
                person.$selected = false;
                vm.person = undefined;
                prevSelection = null;
            } else {
                person.$selected = true;
                vm.person = person;
                prevSelection = person;
            }
            resetTimer();
        };

        vm.setFocus = function (event) {
            vm.editItem = event;

            if (event) vm.editItem = event;
        };

        vm.keyboardInput = function (key) {
            resetTimer();
            vm.showValidationErrors = true;
            var keyCode = key.currentTarget.outerText;
            if (keyCode === 'SPACE') {
                vm.lastLetterIsSpace = true;
                return;
            }

            if (keyCode === 'DEL') {
                vm.editItem.$setViewValue(vm.editItem.$viewValue.substr(0, vm.editItem.$viewValue.length - 1));
                vm.editItem.$render();
                return;
            }

            if (vm.lastLetterIsSpace) {
                vm.editItem.$setViewValue(vm.editItem.$viewValue + ' ' + keyCode);
                vm.lastLetterIsSpace = false;
            } else {
                vm.editItem.$setViewValue(vm.editItem.$viewValue + keyCode);
            }
            vm.editItem.$render();
        };

        vm.paged = function () {
            prevSelection = null;
            vm.searchName(tableStateRef);
        };

        vm.updateKiosk = function () {
            logger.info('changed kiosk', vm.kiosk);
            localStorage.setItem('kiosk', vm.kiosk);
        };

        vm.searchName = function (tableState) {
            tableStateRef = tableState;

            if (vm.searchForm !== undefined && vm.searchForm.$invalid) {
                vm.showValidationErrors = true;
                return;
            }
            var names = vm.searchTerm.split(' ');
            var fn = names[1] ? names[0] : '';
            var ln = names[1] || names[0];

            vm.searchModel.firstname = fn;
            vm.searchModel.lastname = ln;
            vm.searchModel.orderBy = 'firstname';

            peopleService.query(vm.searchModel)
              .then(function (data) {
                  vm.people = data.items;
                  vm.searchModel = data;

                  $state.go('home.list')
                      .then(function () {
                          resetTimer();
                      });
              });
        };

        vm.goBack = function () {
            resetTimer();
            history.back();
        };

        vm.gotoPledge = function () {
            if (vm.createForm.$invalid) {
                vm.showValidationErrors = true;
                toastr.error('Please correct your information');
                return;
            }

            vm.person.dateCreated = moment().format('MM/DD/YYYY HH:mm:ss');
            vm.person.isDonor = vm.person.isPriority = false;
            vm.person.firstname = Humanize.titleCase(vm.person.firstname.toLowerCase());
            vm.person.lastname = Humanize.titleCase(vm.person.lastname.toLowerCase());
            vm.person.fuzzyMatchValue = matchValue(vm.person);
            if (vm.person.emailAddress) vm.person.emailAddress = vm.person.emailAddress.toLowerCase();

            $state.go('home.pledge')
                .then(function () {
                    resetTimer();
                });
        };

        vm.gotoSearch = function () {
            $state.go('home.search')
                .then(function () {
                    vm.showValidationErrors = false;
                    vm.editItem = vm.searchForm.searchTerm;
                    resetTimer();
                });
        };

        vm.gotoCreate = function gotoCreate() {
            $state.go('home.create')
                .then(function () {
                    vm.editItem = vm.createForm.firstname;
                    vm.showValidationErrors = false;
                    vm.person = { firstname: '', lastname: '' };
                    createValidationWatcher();
                    resetTimer();
                });
        };

        vm.cancel = function () {
            vm.person = { firstname: '', lastname: '' };
            vm.searchTerm = '';
            vm.people = [];

            $state.go('home')
                .then(function () {
                    $timeout.cancel(timer);
                });
        };

        vm.finish = function () {
            $state.go('home.finish')
                .then(function () {
                    logger.info('sending to hub');
                    hub.server.addName(vm.kiosk, vm.person)
                        .then(function () {
                            logger.info('Sent person to WOT', vm.person);
                            resetTimer();
                        });
                });
        };

        vm.save = function () {
            peopleService.create(vm.person)
                .then(function (data) {
                    vm.finish();
                });
        };

        vm.unlockSettings = function (key) {
            logger.info('keyCode', keyCode, false);
            if (keyCode.length > 4) {
                keyCode = key;
            } else {
                keyCode += key.toString();
            }

            if (keyCode === '12') {
                $state.go('home.config')
                    .then(function () {
                        keyCode = '';
                        logger.info('current kiosk', vm.kiosk);
                    });
            }
        };

        vm.saveConfig = function () {
            configurationService.update(vm.config)
                .then(function (data) {
                    vm.config = data;
                    toastr.success('Settings Saved!');
                    hub.server.configurationChange(vm.config)
                        .then(function () {
                            logger.info('Changes saved and sent to WOT');
                        });
                });
        };

        function matchValue(person) {
            var value = 0.0;
            var fn = getFullName(person);

            _.forEach(censors, function (censor) {
                var idx = clj_fuzzy.metrics.dice(fn, censor.word);
                if (idx > value) value = idx;
            });
            return value;
        };

        function getFullName(person) {
            return person.firstname + ' ' + person.lastname;
        }

        function resetTimer() {
            $timeout.cancel(timer);
            timer = $timeout(function () {
                vm.cancel();
            }, waitTime);
        };

        function createValidationWatcher() {
            //logger.info('creating watcher', vm.person, false);
            $scope.$watchCollection('vm.person', function (newVal, oldVal) {
                if (vm.person) {
                    resetTimer();
                    var valid = validatePerson(vm.person);
                    if (vm.createForm) {
                        vm.createForm.firstname.$setValidity('blacklist', valid);
                        vm.createForm.lastname.$setValidity('blacklist', valid);
                    }
                }
            });
        };

        function validatePerson(person) {
            var fullName = (person.firstname ? person.firstname : '') + ' ' + (person.lastname ? person.lastname : '');
            var firstmatch = censors.some(function (e) { return e.word.toUpperCase() === (person.firstname ? person.firstname.toUpperCase() : ''); });
            var lastmatch = censors.some(function (e) { return e.word.toUpperCase() === (person.lastname ? person.lastname.toUpperCase() : ''); });
            var fullmatch = censors.some(function (e) { return e.word.toUpperCase() === fullName.toUpperCase(); });

            var match = firstmatch || lastmatch || fullmatch;
            return !match;
        };
    };
})();
//mark.lawrence
//nav.js

(function () {
    'use strict';

    var controllerId = 'NavController';

    angular.module('app.users').controller(controllerId, mainController);

    mainController.$inject = ['logger'];

    function mainController(logger) {
        var vm = this;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        }
    };
})();
//manager.js
//mark.lawrence

(function () {
    var controllerId = 'PeopleController';

    angular.module('app.people').controller(controllerId, PeopleController);

    PeopleController.$inject = ['logger', 'peopleService', '$uibModal', 'config'];

    function PeopleController(logger, service, $modal, config) {
        var vm = this;
        var keyCodes = config.keyCodes;

        vm.title = "People Manager";

        vm.currentEdit = null;
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;

        vm.people = [];
        vm.searchModel = {
            page: 1,
            pageSize: 15,
            orderBy: 'Firstname',
            orderDirection: 'desc'
        };
        vm.searchTerm = '';

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
        };

        vm.addItem = function addItem() {
            vm.lastDeleted = null;
            vm.lastUpdated = null;
            $modal.open({
                templateUrl: '/app/people/views/person.html',
                //controller: ['logger', '$uibModalInstance', 'peopleService', 'item', 'vm', 'storage', editPersonController],
                controller: ['logger', '$uibModalInstance', 'peopleService', 'vm', 'storage', editPersonController],
                controllerAs: 'vm',
                resolve: {
                    vm: vm
                }
            })
                .result.then(function (data) {
                    vm.people.unshift(data);
                    logger.success('Successfully created ' + getFullName(data));
                });
        };

        vm.editItem = function editItem(item) {
            vm.currentEdit = item;
            vm.lastDeleted = null;
            vm.lastUpdated = null;
            $modal.open({
                templateUrl: '/app/people/views/person.html',
                //controller: ['logger', '$uibModalInstance', 'peopleService', 'item', 'vm', 'storage', editPersonController],
                controller: ['logger', '$uibModalInstance', 'peopleService', 'vm', 'storage', editPersonController],
                controllerAs: 'vm',
                resolve: {
                    vm: vm
                }
            })
                .result.then(function (data) {
                    vm.lastUpdated = angular.copy(vm.currentEdit);
                    angular.extend(item, data);
                    logger.success('Successfully updated ' + getFullName(data));
                }).finally(function () {
                    vm.currentEdit = null;
                });
        };

        vm.deleteItem = function deleteItem(person) {
            service.remove(person.id)
                .then(function (data) {
                    vm.lastDeleted = person;
                    var idx = vm.people.indexOf(person);
                    vm.people.splice(idx, 1);
                    logger.warning('Deleted person ' + person.firstname + ' ' + person.lastname);
                });
        };

        vm.undoDelete = function () {
            service.create(vm.lastDeleted)
                .then(function (data) {
                    logger.success('Successfully restored ' + data.firstname + ' ' + data.lastname);
                    vm.people.unshift(data);
                    vm.lastDeleted = null;
                });
        };

        vm.undoChange = function () {
            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.people,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.people[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + vm.lastUpdated.firstname + ' ' + vm.lastUpdated.lastname);
                    vm.lastUpdated = null;
                });
        };

        vm.search = function search(tableState) {
            tableStateRef = tableState;

            if (!vm.searchModel.isPriority) vm.searchModel.isPriority = null;

            vm.searchModel.dateCreated = vm.daysFilter
                ? moment().subtract(parseInt(vm.daysFilter), 'days').format('MM/DD/YYYY')
                : null;
            if (typeof (tableState.sort.predicate) != "undefined") {
                vm.searchModel.orderBy = tableState.sort.predicate;
                vm.searchModel.orderDirection = tableState.sort.reverse ? 'desc' : 'asc';
            }
            if (typeof (tableState.search.predicateObject) != "undefined") {
                if (tableState.search.predicateObject.fuzzyMatchValue) {
                    vm.fuzzyMatchValue = null;
                    vm.searchModel.fuzzyMatchValue = tableState.search.predicateObject.fuzzyMatchValue / 100;
                } else {
                    vm.searchModel.fuzzyMatchValue = vm.fuzzyMatchValue;
                }

                vm.daysFilter = tableState.search.predicateObject.dateCreated ? null : vm.daysFilter;
                vm.searchModel.dateCreated = vm.daysFilter
                    ? vm.searchModel.dateCreated
                    : tableState.search.predicateObject.dateCreated;

                vm.searchModel.isDonor = tableState.search.predicateObject.isDonor;
                vm.searchModel.firstname = tableState.search.predicateObject.firstname;
                vm.searchModel.lastname = tableState.search.predicateObject.lastname;
                vm.searchModel.zipcode = tableState.search.predicateObject.zipCode;
                vm.searchModel.emailAddress = tableState.search.predicateObject.emailAddress;
                vm.searchModel.isPriority = tableState.search.predicateObject.isPriority;
            } else {
                vm.searchModel.fuzzyMatchValue = vm.fuzzyMatchValue;
            }

            vm.isBusy = true;
            service.query(vm.searchModel)
                .then(function (data) {
                    vm.people = data.items;
                    vm.searchModel = data;
                    vm.isBusy = false;
                });
        };

        vm.paged = function paged(pageNum) {
            vm.lastDeleted = null;
            vm.lastUpdated = null;
            vm.search(tableStateRef);
        };

        vm.quickFilter = function () {
            vm.search(tableStateRef);
        };

        function getFullName(person) {
            return person.firstname + ' ' + person.lastname;
        };
    }

    function editPersonController(logger, $modal, service, model, storage) {
        var vm = this;
        //TODO: Can be made global??
        var censors = JSON.parse(storage.get('censors'));

        vm.item = angular.copy(model.currentEdit);

        vm.close = function () {
            $modal.dismiss();
        };

        vm.matchValue = function () {
            var value = 0.0;
            var fn = getFullName(vm.item);

            _.forEach(censors,
                function (censor) {
                    var idx = clj_fuzzy.metrics.dice(fn, censor.word);
                    if (idx > value) value = idx;
                });
            vm.item.fuzzyMatchValue = value;
        };

        vm.save = function () {
            if (vm.item.id) {
                service.update(vm.item)
                    .then(function (data) {
                        $modal.close(data);
                    });
            } else {
                service.create(vm.item)
                    .then(function (data) {
                        $modal.close(data);
                    });
            }
        };

        function getFullName(item) {
            return item.firstname + ' ' + item.lastname;
        };
    };
})();
//mark.lawrence
//profile.js

(function () {
    'use strict';

    var controllerId = 'ProfileController';

    angular.module('app.users').controller(controllerId, mainController);

    mainController.$inject = ['$scope', '$http', 'logger', 'userService', 'defaults', 'config', '$rootScope'];

    function mainController($scope, $http, logger, service, defaults, config, $rootScope) {
        var vm = this;
        vm.title = 'Profile Manager';
        vm.description = 'Update your profile';

        vm.user = {};

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            vm.user = JSON.parse(localStorage.getItem('currentUser'));
        };

        vm.fileSelected = function ($files, $file, $event, $rejectedFiles) {
            var reader = new FileReader();
            reader.onload = function (e) {
                var dataURL = reader.result;
                vm.user.userPhoto = dataURL.split(',')[1];
                vm.user.userPhotoType = $file.type;
            };
            reader.readAsDataURL($file);
        };

        vm.save = function () {
            vm.isBusy = true;
            service.update(vm.user)
                .then(function (data) {
                    vm.user = data;
                    localStorage.setItem('currentUser', JSON.stringify(vm.user));
                })
                .finally(function () {
                    vm.isBusy = false;
                    vm.file = null;
                    vm.profileForm.$setPristine();
                    vm.avatarForm.$setPristine();
                });
        };
    };
})();
//censor.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'censorService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Censor;

        var service = {
            create: create,
            get: get,
            query: query,
            update: update,
            remove: remove
        };

        return service;

        function create(censor) {
            return $http.post(url, censor).then(_success);
        };

        function get() {
            return $http.get(url).then(_success);
        };

        function query(searchTerm) {
            if (searchTerm == undefined) {
                return get();
            } else {
                return $http.get(url + '/?search=' + searchTerm).then(_success);
            }
        };

        function update(censor) {
            return $http.put(url, censor).then(_success);
        };

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        };

        function _success(response) {
            return response.data;
        };
    }
})();
//configuration.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'configurationService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded ');
        var url = config.apiUrl + config.apiEndPoints.Configuration;

        var service = {
            get: get,
            update: update
        }

        return service;

        function get() {
            return $http.get(url).then(_success);
        }

        function update(config) {
            return $http.put(url, config).then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
//people.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'peopleService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config, exception) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.Person;

        var service = {
            create: create,
            get: get,
            query: query,
            update: update,
            remove: remove,
            getCurrentStats: getCurrentStats
        }

        return service;

        function create(censor) {
            return $http.post(url, censor).then(_success);
        }

        function get() {
            return $http.get(url)
                .then(_success)
                .catch(function (message) { exception.catcher('Failed to retrieve people')(message); });
        }

        function query(search) {
            return $http.post(url + '/search', search)
                .then(_success)
                .catch(function (message) { exception.catcher('Failed to retrieve people')(message); });
        }

        function update(person) {
            return $http.put(url, person).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function getCurrentStats() {
            return $http.get(url + '/stat')
                .then(_success)
                .catch(function (message) { exception.catcher('Failed to retrieve stats')(message); });
        }

        function _success(response) {
            return response.data;
        }
    }
})();
//user.service.js
//mark.lawrence

(function () {
    'use strict';

    var serviceId = 'userService';
    angular.module('app.service').factory(serviceId, serviceController);

    function serviceController(logger, $http, config) {
        logger.log(serviceId + ' loaded');
        var url = config.apiUrl + config.apiEndPoints.User;

        var service = {
            availableRoles: availableRoles,
            create: create,
            get: get,
            query: query,
            remove: remove,
            update: update
        }

        return service;

        function availableRoles() {
            return $http.get(url + '/roles').then(_success);
        }

        function create(user) {
            return $http.post(url, user).then(_success, function (error) {
                logger.log('error', error);
            });
        }

        //TODO: Need a getbyname function
        function get() {
            return $http.get(url).then(_success);
        }

        function query(searchTerm) {
            url += '/search/';

            if (searchTerm != undefined && searchTerm.length > 0) {
                url += '?' + searchTerm;
            };
            return $http.get(url).then(_success);
        }

        function update(user) {
            return $http.put(url, user).then(_success);
        }

        function remove(id) {
            return $http.delete(url + '/' + id).then(_success);
        }

        function _success(response) {
            return response.data;
        }
    }
})();
(function () {
    'use strict';

    var controllerId = 'UserController';

    angular.module('app.users').controller(controllerId, UserController);

    UserController.$inject = ['logger', 'userService', 'defaults', 'config'];

    function UserController(logger, service, defaults, config) {
        var vm = this;
        vm.title = 'User Manager';
        vm.description = 'Edit and update users';
        var keyCodes = config.keyCodes;

        vm.availableRoles = [];
        vm.clearCreate = clearCreate;
        vm.currentEdit = {};
        vm.isBusy = false;
        vm.lastDeleted = null;
        vm.lastUpdated = null;
        vm.itemToEdit = {};

        vm.user = {
            //userName: null,
            roles: ['user'],
            fullName: '',
            password: defaults.GENERIC_PASSWORD
        };

        var tableStateRef;

        activate();

        function activate() {
            logger.log(controllerId + ' activated');
            getAvailableRoles();
        };

        vm.addItem = function () {
            vm.user.fullName = parseFullName(vm.user.userName);
            vm.user.email = vm.user.userName + defaults.EMAIL_SUFFIX;

            service.create(vm.user)
                .then(function (data) {
                    //TODO: mapping would allow removal of extend method
                    vm.user = angular.extend(vm.user, data);
                    vm.users.unshift(angular.copy(vm.user));
                    logger.success('User ' + vm.user.userName + ' created!');
                    vm.user.userName = null;
                    //TODO: show error user already exists
                });
        };

        vm.cancelEdit = function (id) {
            vm.currentEdit[id] = false;
        };

        vm.deleteItem = function (user) {
            angular.copy(user, vm.lastDeleted = {});
            service.remove(user.id)
                .then(function (data) {
                    var idx = vm.users.indexOf(user);
                    vm.users.splice(idx, 1);
                });
        };

        vm.editItem = function (user) {
            vm.currentEdit[user.id] = true;
            angular.copy(user, vm.itemToEdit = {});
        };

        function getAvailableRoles() {
            service.availableRoles()
                .then(function (data) {
                    vm.availableRoles = data;
                });
        };

        vm.saveItem = function (user) {
            vm.isBusy = true;

            vm.currentEdit[user.id] = false;
            angular.copy(user, vm.lastUpdated = {});
            logger.log('lastUpdated', vm.lastUpdated);
            var roles = [];

            _.forEach(vm.itemToEdit.roles,
                function (role) {
                    roles.push(role.name);
                });
            vm.itemToEdit.roles = roles;

            service.update(vm.itemToEdit)
                .then(function (data) {
                    angular.extend(user, data);
                    logger.success('User ' + data.userName + ' updated!');
                    vm.isBusy = false;
                });
        };

        vm.search = function (tableState) {
            tableStateRef = tableState;
            var searchTerm;

            if (typeof (tableState.search.predicateObject) != 'undefined') {
                searchTerm = tableState.search.predicateObject.searchTerm;
            }

            vm.isBusy = true;
            service.query(searchTerm)
                .then(function (data) {
                    vm.users = data;
                    logger.log('users', vm.users);
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        vm.undoDelete = function () {
            var roles = [];

            _.forEach(vm.lastDeleted.roles, function (role) {
                roles.push(role.name);
                logger.log('role', role.name);
            });
            vm.lastDeleted.roles = roles;
            vm.lastDeleted.password = defaults.GENERIC_PASSWORD;

            service.create(vm.lastDeleted).then(function (data) {
                logger.success('Successfully restored ' + data.userName);
                vm.users.unshift(data);
                vm.lastDeleted = null;
            });
        };

        vm.undoChange = function () {
            vm.isBusy = true;

            service.update(vm.lastUpdated)
                .then(function (data) {
                    angular.forEach(vm.users,
                        function (u, i) {
                            if (u.id === vm.lastUpdated.id) {
                                vm.users[i] = vm.lastUpdated;
                            }
                        });
                    logger.success('Successfully restored ' + data.userName);
                    vm.lastUpdated = null;
                })
                .finally(function () {
                    vm.isBusy = false;
                });
        };

        function clearCreate($event) {
            if ($event.keyCode === keyCodes.esc) {
                vm.user.userName = '';
            };
        };

        function parseFullName(name) {
            var arr = name.split('.');
            var fullname = '';

            _.forEach(arr, function (v) {
                fullname += _.capitalize(v) + ' ';
            });

            return _.trim(fullname);
        };
    };
})();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5tb2R1bGUuanMiLCJjb3JlL2NvcmUubW9kdWxlLmpzIiwiY29yZS9jb25maWcuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5tb2R1bGUuanMiLCJibG9ja3MvbG9nZ2VyL2xvZ2dlci5tb2R1bGUuanMiLCJjZW5zb3JzL2NlbnNvcnMubW9kdWxlLmpzIiwiY29uZmlndXJhdGlvbi9zZXR0aW5ncy5tb2R1bGUuanMiLCJmaWx0ZXJzL2ZpbHRlci5tb2R1bGUuanMiLCJob21lL2hvbWUubW9kdWxlLmpzIiwia2lvc2sva2lvc2subW9kdWxlLmpzIiwibmF2L25hdi5tb2R1bGUuanMiLCJwZW9wbGUvcGVvcGxlLm1vZHVsZS5qcyIsInByb2ZpbGUvcHJvZmlsZS5tb2R1bGUuanMiLCJzZXJ2aWNlcy9zZXJ2aWNlLm1vZHVsZS5qcyIsInVzZXJzL3VzZXJzLm1vZHVsZS5qcyIsImJsb2Nrcy9leGNlcHRpb24vZXhjZXB0aW9uLWhhbmRsZXIucHJvdmlkZXIuanMiLCJibG9ja3MvZXhjZXB0aW9uL2V4Y2VwdGlvbi5qcyIsImJsb2Nrcy9sb2dnZXIvbG9nZ2VyLmpzIiwiY2Vuc29ycy9jZW5zb3JzLmpzIiwiY29uZmlndXJhdGlvbi9zZXR0aW5ncy5qcyIsImRpcmVjdGl2ZXMvYmxhY2tsaXN0LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvY2xlYXIta2V5LmRpcmVjdGl2ZS5qcyIsImRpcmVjdGl2ZXMvc21hcnQtdGFibGUuZGlyZWN0aXZlLmpzIiwiZmlsdGVycy9hcHAuZmlsdGVycy5qcyIsImhvbWUvaG9tZS5qcyIsImtpb3NrL2tpb3NrLmpzIiwibmF2L25hdi5qcyIsInBlb3BsZS9wZW9wbGUuanMiLCJwcm9maWxlL3Byb2ZpbGUuanMiLCJzZXJ2aWNlcy9jZW5zb3Iuc2VydmljZS5qcyIsInNlcnZpY2VzL2NvbmZpZ3VyYXRpb24uc2VydmljZS5qcyIsInNlcnZpY2VzL3Blb3BsZS5zZXJ2aWNlLmpzIiwic2VydmljZXMvdXNlci5zZXJ2aWNlLmpzIiwidXNlcnMvdXNlcnMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDSkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ0pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3RJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM5REE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3JCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDUEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDNVFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25OQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ25EQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNoQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoibW9kdWxlcy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvL2FwcC5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcCcsXHJcbiAgICBbXHJcbiAgICAgICAgLy9hcHBsaWNhdGlvbiBtb2R1bGVzXHJcbiAgICAgICAgJ2FwcC5jb3JlJyxcclxuICAgICAgICAnYXBwLnNlcnZpY2UnLFxyXG4gICAgICAgICdhcHAuZmlsdGVyJyxcclxuXHJcbiAgICAgICAgLy9mZWF0dXJlIGFyZWFzXHJcbiAgICAgICAgJ2FwcC5uYXYnLFxyXG4gICAgICAgICdhcHAuaG9tZScsXHJcbiAgICAgICAgJ2FwcC5jZW5zb3JzJyxcclxuICAgICAgICAnYXBwLnBlb3BsZScsXHJcbiAgICAgICAgJ2FwcC5zZXR0aW5ncycsXHJcbiAgICAgICAgJ2FwcC51c2VycycsXHJcbiAgICAgICAgJ2FwcC5wcm9maWxlJyxcclxuICAgICAgICAnYXBwLmtpb3NrJ1xyXG4gICAgXSkuY29uZmlnKFsnJHN0YXRlUHJvdmlkZXInLCAnJHVybFJvdXRlclByb3ZpZGVyJywgY29uZmlnXSkucnVuKFsnJHJvb3RTY29wZScsICdsb2dnZXInLCAndXNlclNlcnZpY2UnLCBmdW5jdGlvbiAoJHJvb3RTY29wZSwgbG9nZ2VyLCBzZXJ2aWNlKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZygnYXBwIHJ1bm5pbmcnKTtcclxuICAgIH1dKTtcclxuXHJcbiAgICBmdW5jdGlvbiBjb25maWcoJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgICAgIC8vJGxvY2F0aW9uUHJvdmlkZXIuaHRtbDVNb2RlKHRydWUpO1xyXG5cclxuICAgICAgICAkc3RhdGVQcm92aWRlclxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL2hvbWUuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdLaW9za0NvbnRyb2xsZXInLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNlbnNvcnM6IGZ1bmN0aW9uIChjZW5zb3JTZXJ2aWNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnNvclNlcnZpY2UuZ2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uZmlnOiBmdW5jdGlvbiAoY29uZmlndXJhdGlvblNlcnZpY2UpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvblNlcnZpY2UuZ2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUuY3JlYXRlJyxcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHVybDogJ2NyZWF0ZScsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL3BhcnRpYWwtY3JlYXRlLmh0bWwnXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lLnNlYXJjaCcsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdzZWFyY2gnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLXNlYXJjaC5odG1sJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZS5wbGVkZ2UnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAncGxlZGdlJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1wbGVkZ2UuaHRtbCdcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAuc3RhdGUoJ2hvbWUubGlzdCcsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdsaXN0JyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1saXN0Lmh0bWwnXHJcbiAgICAgICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLnN0YXRlKCdob21lLmZpbmlzaCcsXHJcbiAgICAgICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB1cmw6ICdmaW5pc2gnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLWZpbmlzaC5odG1sJ1xyXG4gICAgICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIC5zdGF0ZSgnaG9tZS5jb25maWcnLFxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdXJsOiAnY29uZmlndXJhdGlvbicsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL3BhcnRpYWwtY29uZmlnLmh0bWwnXHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICR1cmxSb3V0ZXJQcm92aWRlci5vdGhlcndpc2UoJy8nKTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9jb3JlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLmNvcmUnLFxyXG4gICAgICAgIFtcclxuICAgICAgICAgICAgLy9hbmd1bGFyIG1vZHVsZXNcclxuICAgICAgICAgICAgJ25nTWVzc2FnZXMnLFxyXG4gICAgICAgICAgICAnYW5ndWxhckxvY2FsU3RvcmFnZScsXHJcbiAgICAgICAgICAgICd1aS5yb3V0ZXInLFxyXG4gICAgICAgICAgICAnbmdBbmltYXRlJyxcclxuXHJcbiAgICAgICAgICAgIC8vY3VzdG9tIG1vZHVsZXNcclxuICAgICAgICAgICAgJ2Jsb2Nrcy5sb2dnZXInLFxyXG4gICAgICAgICAgICAnYmxvY2tzLmV4Y2VwdGlvbicsXHJcblxyXG4gICAgICAgICAgICAvL3RoaXJkIHBhcnR5IG1vZHVsZXNcclxuICAgICAgICAgICAgJ3NtYXJ0LXRhYmxlJyxcclxuICAgICAgICAgICAgJ3VpLmJvb3RzdHJhcCcsXHJcbiAgICAgICAgICAgICduZ1RhZ3NJbnB1dCcsXHJcbiAgICAgICAgICAgICduZ0ZpbGVVcGxvYWQnLFxyXG4gICAgICAgICAgICAncnpNb2R1bGUnLFxyXG4gICAgICAgICAgICAnc3dpdGNoZXInLFxyXG4gICAgICAgICAgICAnZ2ZsLnRleHRBdmF0YXInXHJcbiAgICAgICAgXSlcclxuICAgICAgICAuY29uc3RhbnQoJ3RvYXN0cicsIHRvYXN0cilcclxuICAgICAgICAuY29uc3RhbnQoJ21vbWVudCcsIG1vbWVudCk7O1xyXG59KSgpOyIsIi8vY29uZmlnLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgZnVuY3Rpb24gdG9hc3RyQ29uZmlnKHRvYXN0cikge1xyXG4gICAgICAgIHRvYXN0ci5vcHRpb25zLnRpbWVPdXQgPSA0MDAwO1xyXG4gICAgICAgIHRvYXN0ci5vcHRpb25zLnBvc2l0aW9uQ2xhc3MgPSAndG9hc3QtYm90dG9tLXJpZ2h0JztcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGtleUNvZGVzID0ge1xyXG4gICAgICAgIGJhY2tzcGFjZTogOCxcclxuICAgICAgICB0YWI6IDksXHJcbiAgICAgICAgZW50ZXI6IDEzLFxyXG4gICAgICAgIGVzYzogMjcsXHJcbiAgICAgICAgc3BhY2U6IDMyLFxyXG4gICAgICAgIHBhZ2V1cDogMzMsXHJcbiAgICAgICAgcGFnZWRvd246IDM0LFxyXG4gICAgICAgIGVuZDogMzUsXHJcbiAgICAgICAgaG9tZTogMzYsXHJcbiAgICAgICAgbGVmdDogMzcsXHJcbiAgICAgICAgdXA6IDM4LFxyXG4gICAgICAgIHJpZ2h0OiAzOSxcclxuICAgICAgICBkb3duOiA0MCxcclxuICAgICAgICBpbnNlcnQ6IDQ1LFxyXG4gICAgICAgIGRlbDogNDZcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGFwaUVuZFBvaW50cyA9IHtcclxuICAgICAgICBDZW5zb3I6ICdjZW5zb3InLFxyXG4gICAgICAgIFBlcnNvbjogJ3BlcnNvbicsXHJcbiAgICAgICAgVXNlcjogJ3VzZXJzJyxcclxuICAgICAgICBDb25maWd1cmF0aW9uOiAnY29uZmlndXJhdGlvbidcclxuICAgIH07XHJcblxyXG4gICAgdmFyIGNvbmZpZyA9IHtcclxuICAgICAgICBhcHBFcnJvclByZWZpeDogJ1tDUk1DIEVycm9yXSAnLCAvL0NvbmZpZ3VyZSB0aGUgZXhjZXB0aW9uSGFuZGxlciBkZWNvcmF0b3JcclxuICAgICAgICBhcHBUaXRsZTogJ0NSTUMnLFxyXG4gICAgICAgIHZlcnNpb246ICcxLjAuMCcsXHJcbiAgICAgICAgYXBpVXJsOiAnaHR0cDovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArICcvYXBpLycsXHJcbiAgICAgICAga2V5Q29kZXM6IGtleUNvZGVzLFxyXG4gICAgICAgIGFwaUVuZFBvaW50czogYXBpRW5kUG9pbnRzXHJcbiAgICB9O1xyXG5cclxuICAgIHZhciBkZWZhdWx0cyA9IHtcclxuICAgICAgICBFTUFJTF9TVUZGSVg6ICdAc3BsY2VudGVyLm9yZycsXHJcbiAgICAgICAgR0VORVJJQ19QQVNTV09SRDogJzFQQHNzd29yZCdcclxuICAgIH07XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jb3JlJylcclxuICAgICAgICAuY29uZmlnKHRvYXN0ckNvbmZpZylcclxuICAgICAgICAuY29uc3RhbnQoJ2NvbmZpZycsIGNvbmZpZylcclxuICAgICAgICAudmFsdWUoJ2RlZmF1bHRzJywgZGVmYXVsdHMpO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2V4Y2VwdGlvbi5tb2R1bGUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYmxvY2tzLmV4Y2VwdGlvbicsIFsnYmxvY2tzLmxvZ2dlciddKTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibG9ja3MubG9nZ2VyJywgW10pO1xyXG59KSgpOyIsIi8vY2Vuc29ycy5tb2R1bGUuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jZW5zb3JzJywgW10pO1xyXG59KSgpOyIsIi8vc2V0dG9tZ3MubW9kdWxlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2V0dGluZ3MnLCBbXSk7XHJcbn0pKCk7IiwiLy9maWx0ZXIubW9kdWxlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuZmlsdGVyJywgW10pO1xyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5ob21lJywgW10pO1xyXG59KSgpOyIsIihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5raW9zaycsIFtdKTtcclxufSkoKTtcclxuXHJcbi8vKGZ1bmN0aW9uICgpIHtcclxuLy8gICAgXCJ1c2Ugc3RyaWN0XCI7XHJcbi8vICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAua2lvc2snLCBbXSk7XHJcblxyXG4vLyAgICAvL2FwcC5jb25maWcoWyckc3RhdGVQcm92aWRlcicsICckdXJsUm91dGVyUHJvdmlkZXInLCBjb25maWddKTtcclxuXHJcbi8vICAgIC8vZnVuY3Rpb24gY29uZmlnKCRzdGF0ZVByb3ZpZGVyLCAkdXJsUm91dGVyUHJvdmlkZXIpIHtcclxuLy8gICAgLy8gICAgLy8kbG9jYXRpb25Qcm92aWRlci5odG1sNU1vZGUodHJ1ZSk7XHJcblxyXG4vLyAgICAvLyAgICAkc3RhdGVQcm92aWRlclxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lJyxcclxuLy8gICAgLy8gICAgICAgICAgICAgICAge1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdXJsOiAnLycsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9ob21lLmh0bWwnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ0tpb3NrQ29udHJvbGxlcicsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgY2Vuc29yczogZnVuY3Rpb24gKGNlbnNvclNlcnZpY2UpIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbnNvclNlcnZpY2UuZ2V0KCk7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgfSxcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgICAgICBjb25maWc6IGZ1bmN0aW9uIChjb25maWd1cmF0aW9uU2VydmljZSkge1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uZmlndXJhdGlvblNlcnZpY2UuZ2V0KCk7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgfVxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lLmNyZWF0ZScsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHVybDogJ2NyZWF0ZScsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLWNyZWF0ZS5odG1sJ1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lLnNlYXJjaCcsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHVybDogJ3NlYXJjaCcsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLXNlYXJjaC5odG1sJ1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lLnBsZWRnZScsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHVybDogJ3BsZWRnZScsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLXBsZWRnZS5odG1sJ1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lLmxpc3QnLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB7XHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB1cmw6ICdsaXN0JyxcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnYXBwL2tpb3NrL3ZpZXdzL3BhcnRpYWwtbGlzdC5odG1sJ1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lLmZpbmlzaCcsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHVybDogJ2ZpbmlzaCcsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ2FwcC9raW9zay92aWV3cy9wYXJ0aWFsLWZpbmlzaC5odG1sJ1xyXG4vLyAgICAvLyAgICAgICAgICAgICAgICB9KVxyXG4vLyAgICAvLyAgICAgICAgLnN0YXRlKCdob21lLmNvbmZpZycsXHJcbi8vICAgIC8vICAgICAgICAgICAgICAgIHtcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgICAgIHVybDogJ2NvbmZpZ3VyYXRpb24nLFxyXG4vLyAgICAvLyAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdhcHAva2lvc2svdmlld3MvcGFydGlhbC1jb25maWcuaHRtbCdcclxuLy8gICAgLy8gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4vLyAgICAvLyAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XHJcbi8vICAgIC8vfVxyXG4vL30oKSk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vbmF2Lm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAubmF2JywgW10pO1xyXG59KSgpOyIsIi8vcGVvcGxlLm1vZHVsZS5qc1xyXG4vL21hcmsubGF3cmVuY2VcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnBlb3BsZScsIFtdKTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9wcm9maWxlLm1vZHVsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAucHJvZmlsZScsIFtdKTtcclxufSkoKTsiLCIvL3NlcnZpY2UubW9kdWxlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScsIFtdKTtcclxufSkoKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAudXNlcnMnLCBbXSk7XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vZXhjZXB0aW9uLWhhbmRsZXIucHJvdmlkZXIuanNcclxuXHJcbi8vIEluY2x1ZGUgaW4gaW5kZXguaHRtbCBzbyB0aGF0IGFwcCBsZXZlbCBleGNlcHRpb25zIGFyZSBoYW5kbGVkLlxyXG4vLyBFeGNsdWRlIGZyb20gdGVzdFJ1bm5lci5odG1sIHdoaWNoIHNob3VsZCBydW4gZXhhY3RseSB3aGF0IGl0IHdhbnRzIHRvIHJ1blxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXJcclxuICAgICAgICAubW9kdWxlKCdibG9ja3MuZXhjZXB0aW9uJylcclxuICAgICAgICAucHJvdmlkZXIoJ2V4Y2VwdGlvbkhhbmRsZXInLCBleGNlcHRpb25IYW5kbGVyUHJvdmlkZXIpXHJcbiAgICAgICAgLmNvbmZpZyhjb25maWcpO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogTXVzdCBjb25maWd1cmUgdGhlIGV4Y2VwdGlvbiBoYW5kbGluZ1xyXG4gICAgICogQHJldHVybiB7W3R5cGVdfVxyXG4gICAgICovXHJcbiAgICBmdW5jdGlvbiBleGNlcHRpb25IYW5kbGVyUHJvdmlkZXIoKSB7XHJcbiAgICAgICAgLyoganNoaW50IHZhbGlkdGhpczp0cnVlICovXHJcbiAgICAgICAgdGhpcy5jb25maWcgPSB7XHJcbiAgICAgICAgICAgIGFwcEVycm9yUHJlZml4OiB1bmRlZmluZWRcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmNvbmZpZ3VyZSA9IGZ1bmN0aW9uIChhcHBFcnJvclByZWZpeCkge1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5hcHBFcnJvclByZWZpeCA9IGFwcEVycm9yUHJlZml4O1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMuJGdldCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHsgY29uZmlnOiB0aGlzLmNvbmZpZyB9O1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogQ29uZmlndXJlIGJ5IHNldHRpbmcgYW4gb3B0aW9uYWwgc3RyaW5nIHZhbHVlIGZvciBhcHBFcnJvclByZWZpeC5cclxuICAgICAqIEFjY2Vzc2libGUgdmlhIGNvbmZpZy5hcHBFcnJvclByZWZpeCAodmlhIGNvbmZpZyB2YWx1ZSkuXHJcbiAgICAgKiBAcGFyYW0gIHtbdHlwZV19ICRwcm92aWRlXHJcbiAgICAgKiBAcmV0dXJuIHtbdHlwZV19XHJcbiAgICAgKiBAbmdJbmplY3RcclxuICAgICAqL1xyXG4gICAgZnVuY3Rpb24gY29uZmlnKCRwcm92aWRlKSB7XHJcbiAgICAgICAgJHByb3ZpZGUuZGVjb3JhdG9yKCckZXhjZXB0aW9uSGFuZGxlcicsIGV4dGVuZEV4Y2VwdGlvbkhhbmRsZXIpO1xyXG4gICAgfTtcclxuXHJcbiAgICAvKipcclxuICAgICAqIEV4dGVuZCB0aGUgJGV4Y2VwdGlvbkhhbmRsZXIgc2VydmljZSB0byBhbHNvIGRpc3BsYXkgYSB0b2FzdC5cclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gJGRlbGVnYXRlXHJcbiAgICAgKiBAcGFyYW0gIHtPYmplY3R9IGV4Y2VwdGlvbkhhbmRsZXJcclxuICAgICAqIEBwYXJhbSAge09iamVjdH0gbG9nZ2VyXHJcbiAgICAgKiBAcmV0dXJuIHtGdW5jdGlvbn0gdGhlIGRlY29yYXRlZCAkZXhjZXB0aW9uSGFuZGxlciBzZXJ2aWNlXHJcbiAgICAgKi9cclxuICAgIGZ1bmN0aW9uIGV4dGVuZEV4Y2VwdGlvbkhhbmRsZXIoJGRlbGVnYXRlLCBleGNlcHRpb25IYW5kbGVyLCBsb2dnZXIpIHtcclxuICAgICAgICByZXR1cm4gZnVuY3Rpb24gKGV4Y2VwdGlvbiwgY2F1c2UpIHtcclxuICAgICAgICAgICAgdmFyIGFwcEVycm9yUHJlZml4ID0gZXhjZXB0aW9uSGFuZGxlci5jb25maWcuYXBwRXJyb3JQcmVmaXggfHwgJyc7XHJcbiAgICAgICAgICAgIHZhciBlcnJvckRhdGEgPSB7IGV4Y2VwdGlvbjogZXhjZXB0aW9uLCBjYXVzZTogY2F1c2UgfTtcclxuICAgICAgICAgICAgZXhjZXB0aW9uLm1lc3NhZ2UgPSBhcHBFcnJvclByZWZpeCArIGV4Y2VwdGlvbi5tZXNzYWdlO1xyXG4gICAgICAgICAgICAkZGVsZWdhdGUoZXhjZXB0aW9uLCBjYXVzZSk7XHJcbiAgICAgICAgICAgIC8qKlxyXG4gICAgICAgICAgICAgKiBDb3VsZCBhZGQgdGhlIGVycm9yIHRvIGEgc2VydmljZSdzIGNvbGxlY3Rpb24sXHJcbiAgICAgICAgICAgICAqIGFkZCBlcnJvcnMgdG8gJHJvb3RTY29wZSwgbG9nIGVycm9ycyB0byByZW1vdGUgd2ViIHNlcnZlcixcclxuICAgICAgICAgICAgICogb3IgbG9nIGxvY2FsbHkuIE9yIHRocm93IGhhcmQuIEl0IGlzIGVudGlyZWx5IHVwIHRvIHlvdS5cclxuICAgICAgICAgICAgICogdGhyb3cgZXhjZXB0aW9uO1xyXG4gICAgICAgICAgICAgKlxyXG4gICAgICAgICAgICAgKiBAZXhhbXBsZVxyXG4gICAgICAgICAgICAgKiAgICAgdGhyb3cgeyBtZXNzYWdlOiAnZXJyb3IgbWVzc2FnZSB3ZSBhZGRlZCcgfTtcclxuICAgICAgICAgICAgICovXHJcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihleGNlcHRpb24ubWVzc2FnZSwgZXJyb3JEYXRhKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9leGNlcHRpb24uanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgYW5ndWxhclxyXG4gICAgICAgIC5tb2R1bGUoJ2Jsb2Nrcy5leGNlcHRpb24nKVxyXG4gICAgICAgIC5mYWN0b3J5KCdleGNlcHRpb24nLCBleGNlcHRpb24pO1xyXG5cclxuICAgIC8qIEBuZ0luamVjdCAqL1xyXG4gICAgZnVuY3Rpb24gZXhjZXB0aW9uKGxvZ2dlcikge1xyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBjYXRjaGVyOiBjYXRjaGVyXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNhdGNoZXIobWVzc2FnZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKHJlYXNvbikge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKG1lc3NhZ2UsIHJlYXNvbik7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vbG9nZ2VyLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdibG9ja3MubG9nZ2VyJykuZmFjdG9yeSgnbG9nZ2VyJywgbG9nZ2VyKTtcclxuXHJcbiAgICBsb2dnZXIuJGluamVjdCA9IFsnJGxvZycsICd0b2FzdHInXTtcclxuXHJcbiAgICBmdW5jdGlvbiBsb2dnZXIoJGxvZywgdG9hc3RyKSB7XHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIHNob3dUb2FzdHM6IHRydWUsXHJcblxyXG4gICAgICAgICAgICBlcnJvcjogZXJyb3IsXHJcbiAgICAgICAgICAgIGluZm86IGluZm8sXHJcbiAgICAgICAgICAgIHN1Y2Nlc3M6IHN1Y2Nlc3MsXHJcbiAgICAgICAgICAgIHdhcm5pbmc6IHdhcm5pbmcsXHJcblxyXG4gICAgICAgICAgICAvLyBzdHJhaWdodCB0byBjb25zb2xlOyBieXBhc3MgdG9hc3RyXHJcbiAgICAgICAgICAgIGxvZzogJGxvZy5sb2dcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuICAgICAgICAvLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZXJyb3IobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcclxuICAgICAgICAgICAgdG9hc3RyLmVycm9yKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy5lcnJvcignRXJyb3I6ICcgKyBtZXNzYWdlLCBkYXRhKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBpbmZvKG1lc3NhZ2UsIGRhdGEsIHRpdGxlKSB7XHJcbiAgICAgICAgICAgIHRvYXN0ci5pbmZvKG1lc3NhZ2UsIHRpdGxlKTtcclxuICAgICAgICAgICAgJGxvZy5pbmZvKCdJbmZvOiAnICsgbWVzc2FnZSwgZGF0YSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gc3VjY2VzcyhtZXNzYWdlLCBkYXRhLCB0aXRsZSkge1xyXG4gICAgICAgICAgICB0b2FzdHIuc3VjY2VzcyhtZXNzYWdlLCB0aXRsZSk7XHJcbiAgICAgICAgICAgICRsb2cuaW5mbygnU3VjY2VzczogJyArIG1lc3NhZ2UsIGRhdGEpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHdhcm5pbmcobWVzc2FnZSwgZGF0YSwgdGl0bGUpIHtcclxuICAgICAgICAgICAgdG9hc3RyLndhcm5pbmcobWVzc2FnZSwgdGl0bGUpO1xyXG4gICAgICAgICAgICAkbG9nLndhcm4oJ1dhcm5pbmc6ICcgKyBtZXNzYWdlLCBkYXRhKTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL21hbmFnZXIuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnQ2Vuc29yQ29udHJvbGxlcic7XHJcblxyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5jZW5zb3JzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIENlbnNvckNvbnRyb2xsZXIpO1xyXG5cclxuICAgIENlbnNvckNvbnRyb2xsZXIuJGluamVjdCA9IFsnbG9nZ2VyJywgJyR1aWJNb2RhbCcsICdjZW5zb3JTZXJ2aWNlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gQ2Vuc29yQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSkge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnQ2Vuc29yIE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gJ1ZpZXcgYW5kIGVkaXQgY2Vuc29yZWQgd29yZHMnO1xyXG4gICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG5cclxuICAgICAgICB2bS5jZW5zb3JzID0gW107XHJcbiAgICAgICAgdm0uY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgIHZtLml0ZW1Ub0VkaXQgPSB7fTtcclxuXHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2VhcmNoID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcblxyXG4gICAgICAgICAgICB2YXIgc2VhcmNoVGVybSA9ICcnO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgIHNlYXJjaFRlcm0gPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3Quc2VhcmNoVGVybTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnF1ZXJ5KHNlYXJjaFRlcm0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnNvcnMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsRWRpdCA9IGZ1bmN0aW9uIChpZCkge1xyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFtpZF0gPSBmYWxzZTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5jcmVhdGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciBpdGVtID0ge307XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9jZW5zb3JzL3ZpZXdzL2NlbnNvci5odG1sJyxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnJHVpYk1vZGFsSW5zdGFuY2UnLCAnY2Vuc29yU2VydmljZScsICdpdGVtJywgY3JlYXRlQ2Vuc29yQ29udHJvbGxlcl0sXHJcbiAgICAgICAgICAgICAgICBjb250cm9sbGVyQXM6ICd2bScsXHJcbiAgICAgICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgaXRlbTogZnVuY3Rpb24gKCkgeyByZXR1cm4gaXRlbTsgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uY2Vuc29ycy51bnNoaWZ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGZ1bmN0aW9uIChjZW5zb3IpIHtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBjZW5zb3I7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucmVtb3ZlKGNlbnNvci5pZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHZtLmNlbnNvcnMuaW5kZXhPZihjZW5zb3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnNvcnMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5lZGl0SXRlbSA9IGZ1bmN0aW9uIChjZW5zb3IpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbY2Vuc29yLmlkXSA9IHRydWU7XHJcbiAgICAgICAgICAgIHZtLml0ZW1Ub0VkaXQgPSBhbmd1bGFyLmNvcHkoY2Vuc29yKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlSXRlbSA9IGZ1bmN0aW9uIChjZW5zb3IpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbY2Vuc29yLmlkXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmNvcHkoY2Vuc29yLCB2bS5sYXN0VXBkYXRlZCA9IHt9KTtcclxuICAgICAgICAgICAgYW5ndWxhci5leHRlbmQoY2Vuc29yLCB2bS5pdGVtVG9FZGl0KTtcclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0uaXRlbVRvRWRpdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2Vuc29yID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnVuZG9EZWxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuY3JlYXRlKHZtLmxhc3REZWxldGVkKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHJlc3RvcmVkICcgKyBkYXRhLndvcmQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNlbnNvcnMudW5zaGlmdChkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZSh2bS5sYXN0VXBkYXRlZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHZtLmNlbnNvcnMsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh1LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pZCA9PT0gdm0ubGFzdFVwZGF0ZWQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5jZW5zb3JzW2ldID0gdm0ubGFzdFVwZGF0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEud29yZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgZnVuY3Rpb24gY3JlYXRlQ2Vuc29yQ29udHJvbGxlcigkbW9kYWwsIHNlcnZpY2UsIGl0ZW0pIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICB2bS5pdGVtID0gYW5ndWxhci5jb3B5KGl0ZW0pO1xyXG5cclxuICAgICAgICB2bS5jbG9zZSA9IGNsb3NlO1xyXG4gICAgICAgIHZtLnNhdmUgPSBzYXZlO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjbG9zZSgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5pdGVtKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pdGVtID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICAkbW9kYWwuY2xvc2Uodm0uaXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL21hbmFnZXIuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdTZXR0aW5nc0NvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2V0dGluZ3MnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgbWFpbkNvbnRyb2xsZXIpO1xyXG5cclxuICAgIG1haW5Db250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICckdGltZW91dCcsICdjb25maWd1cmF0aW9uU2VydmljZSddO1xyXG5cclxuICAgIGZ1bmN0aW9uIG1haW5Db250cm9sbGVyKGxvZ2dlciwgJHRpbWVvdXQsIHNlcnZpY2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZtLnRpdGxlID0gJ1NldHRpbmdzIENvbmZpZ3VyYXRpb24nO1xyXG5cclxuICAgICAgICB2bS5jb25maWcgPSB7fTtcclxuICAgICAgICB2YXIgaHViID0gJC5jb25uZWN0aW9uLndvdDtcclxuXHJcbiAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcblxyXG4gICAgICAgIHZtLmxhc3RTYXZlZCA9IHt9O1xyXG4gICAgICAgIHZtLnNhdmUgPSBzYXZlO1xyXG4gICAgICAgIHZtLnVuZG8gPSB1bmRvO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2ZWQnKTtcclxuICAgICAgICAgICAgJC5jb25uZWN0aW9uLmh1Yi5zdGFydCgpXHJcbiAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ2h1YiBjb25uZWN0aW9uIHN1Y2Nlc3NmdWwnKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICBnZXRTZXR0aW5ncygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldFNldHRpbmdzKCkge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLmdldCgpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNvbmZpZyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdFNhdmVkID0gYW5ndWxhci5jb3B5KHZtLmNvbmZpZyk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBzYXZlKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZSh2bS5jb25maWcpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmNvbmZpZyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICAgICAgaHViLnNlcnZlci5jb25maWd1cmF0aW9uQ2hhbmdlKHZtLmNvbmZpZylcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ0NoYW5nZXMgc2F2ZWQgYW5kIHNlbnQgdG8gV09UJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIubG9nKCdmaW5hbGx5IGNvbXBlbHRlZCcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gdW5kbygpIHtcclxuICAgICAgICAgICAgdm0uY29uZmlnID0gdm0ubGFzdFNhdmVkO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vIGJsYWNrbGlzdC5kaXJlY3RpdmUuanNcclxuLy8gbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJylcclxuICAgICAgICAuZGlyZWN0aXZlKCdibGFja2xpc3ROYW1lJyxcclxuICAgICAgICAgICAgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgICAgICAgICByZXN0cmljdDogJ0EnLFxyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJsYWNrbGlzdDogJz0nXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGUsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGN0cmwuJHZhbGlkYXRvcnMuYmxhY2tsaXN0ID0gZnVuY3Rpb24gdGVzdChtb2RlbFZhbHVlLCB2aWV3VmFsdWUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciB2YWx1ZSA9IG1vZGVsVmFsdWUgfHwgdmlld1ZhbHVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnZnJvbSBkaXJlY3RpdmU6IHZhbHVlOiAnICsgdmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZygnZnJvbSBkaXJlY3RpdmU6IGluZGV4T2Y6ICcgKyBzY29wZS5ibGFja2xpc3QuaW5kZXhPZih2YWx1ZS50b1VwcGVyQ2FzZSgpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUpIHJldHVybiBzY29wZS5ibGFja2xpc3QuaW5kZXhPZih2YWx1ZS50b1VwcGVyQ2FzZSgpKSA9PSAtMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2NsZWFyLWtleS5kaXJlY3RpdmUuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwJykuZGlyZWN0aXZlKFwiY2xlYXJLZXlcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlc3RyaWN0OiAnRUEnLFxyXG4gICAgICAgICAgICByZXF1aXJlOiAnbmdNb2RlbCcsXHJcbiAgICAgICAgICAgIGxpbms6IGZ1bmN0aW9uIChzY29wZSwgZWwsIGF0dHJzLCBjdHJsKSB7XHJcbiAgICAgICAgICAgICAgICBlbC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCAhPT0gMjcpIHsgcmV0dXJuOyB9IC8vIGNoZWNrIGtleSBob3cgeW91IHdhbnRcclxuICAgICAgICAgICAgICAgICAgICBjdHJsLiRzZXRWaWV3VmFsdWUobnVsbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgY3RybC4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUuJGFwcGx5KCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICB9KTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9zbWFydC10YWJsZS5jbGVhcktleS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5kaXJlY3RpdmUoXCJzdENsZWFyS2V5XCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXN0cmljdDogJ0VBJyxcclxuICAgICAgICAgICAgcmVxdWlyZTogJ15zdFRhYmxlJyxcclxuICAgICAgICAgICAgbGluazogZnVuY3Rpb24gKHNjb3BlLCBlbGVtZW50LCBhdHRycywgY3RybCkge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC5vbigna2V5ZG93bicsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChldmVudC53aGljaCAhPT0gMjcpIHsgcmV0dXJuOyB9IC8vIGNoZWNrIGtleSBob3cgeW91IHdhbnRcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2NvcGUuJGFwcGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGZpZWxkTmFtZSA9IGVsZW1lbnQuY29udGV4dC5hdHRyaWJ1dGVzWydzdC1zZWFyY2gnXS52YWx1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHRhYmxlU3RhdGUgPSBjdHJsLnRhYmxlU3RhdGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0W2ZpZWxkTmFtZV0gPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGN0cmwucGlwZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgfSk7XHJcbn0pKCk7IiwiLy9hcHAuZmlsdGVyLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuYW5ndWxhci5tb2R1bGUoJ2FwcC5maWx0ZXInKS5maWx0ZXIoJ3BlcmNlbnRhZ2UnLCBbJyRmaWx0ZXInLCBmdW5jdGlvbiAoJGZpbHRlcikge1xyXG4gICAgcmV0dXJuIGZ1bmN0aW9uIChpbnB1dCwgZGVjaW1hbHMpIHtcclxuICAgICAgICByZXR1cm4gJGZpbHRlcignbnVtYmVyJykoaW5wdXQgKiAxMDAsIGRlY2ltYWxzKSArICclJztcclxuICAgIH07XHJcbn1dKTsiLCIoZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnSG9tZUNvbnRyb2xsZXInO1xyXG5cclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuaG9tZScpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBtYWluQ29udHJvbGxlcik7XHJcblxyXG4gICAgbWFpbkNvbnRyb2xsZXIuJGluamVjdCA9IFsncGVvcGxlU2VydmljZScsICdjZW5zb3JTZXJ2aWNlJywgJ3VzZXJTZXJ2aWNlJywgJ3N0b3JhZ2UnLCAnbG9nZ2VyJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIocGVvcGxlU2VydmljZSwgY2Vuc29yU2VydmljZSwgdXNlclNlcnZpY2UsIHN0b3JhZ2UsIGxvZ2dlcikge1xyXG4gICAgICAgIHZhciB2bSA9IHRoaXM7XHJcbiAgICAgICAgdm0udGl0bGUgPSAnSG9tZSc7XHJcblxyXG4gICAgICAgIHZtLnN0YXQgPSB7fTtcclxuICAgICAgICB2bS5wZW9wbGUgPSBbXTtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgdmFyIGNlbnNvcnMgPSBbXTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmUnKTtcclxuXHJcbiAgICAgICAgICAgIHVzZXJTZXJ2aWNlLmdldCgpLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXIgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2N1cnJlbnRVc2VyJywgSlNPTi5zdHJpbmdpZnkodm0udXNlcikpO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGNlbnNvcnMgPSBKU09OLnBhcnNlKHN0b3JhZ2UuZ2V0KCdjZW5zb3JzJykpO1xyXG5cclxuICAgICAgICAgICAgaWYgKCFjZW5zb3JzKSB7XHJcbiAgICAgICAgICAgICAgICBjZW5zb3JTZXJ2aWNlLnF1ZXJ5KCcnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc3RvcmFnZS5zZXQoJ2NlbnNvcnMnLCBKU09OLnN0cmluZ2lmeShkYXRhKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjZW5zb3JzID0gSlNPTi5wYXJzZShzdG9yYWdlLmdldCgnY2Vuc29ycycpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVmcmVzaCgpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHJlZnJlc2goKSB7XHJcbiAgICAgICAgICAgIHBlb3BsZVNlcnZpY2UuZ2V0Q3VycmVudFN0YXRzKClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc3RhdCA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHBlb3BsZVNlcnZpY2UuZ2V0KClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGVvcGxlID0gZGF0YTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyIsIi8vbWFyay5sYXdyZW5jZVxyXG4vL2tpb3NrLmpzXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBjb250cm9sbGVySWQgPSAnS2lvc2tDb250cm9sbGVyJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAnKS5jb250cm9sbGVyKGNvbnRyb2xsZXJJZCwgS2lvc2tDb250cm9sbGVyKTtcclxuXHJcbiAgICBLaW9za0NvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRsb2cnLCAnJHN0YXRlJywgJyR0aW1lb3V0JywgJ3Blb3BsZVNlcnZpY2UnLCAnY29uZmlndXJhdGlvblNlcnZpY2UnLCAnY2Vuc29ycycsICdjb25maWcnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBLaW9za0NvbnRyb2xsZXIoJHNjb3BlLCBsb2dnZXIsICRzdGF0ZSwgJHRpbWVvdXQsIHBlb3BsZVNlcnZpY2UsIGNvbmZpZ3VyYXRpb25TZXJ2aWNlLCBjZW5zb3JzLCBjb25maWcpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciB0YWJsZVN0YXRlUmVmO1xyXG4gICAgICAgIHZhciBwcmV2U2VsZWN0aW9uID0gbnVsbDtcclxuICAgICAgICB2YXIgdGltZXI7XHJcbiAgICAgICAgdmFyIHdhaXRUaW1lID0gNTAwMDtcclxuICAgICAgICB2YXIga2V5Q29kZSA9ICcnO1xyXG4gICAgICAgIHZhciBodWIgPSAkLmNvbm5lY3Rpb24ud290O1xyXG5cclxuICAgICAgICB2bS50aXRsZSA9ICd3ZWxjb21lJztcclxuICAgICAgICB2bS5wZW9wbGUgPSBbXTtcclxuICAgICAgICB2bS5jb25maWcgPSBjb25maWc7XHJcbiAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSB7XHJcbiAgICAgICAgICAgIHBhZ2U6IDEsXHJcbiAgICAgICAgICAgIHBhZ2VTaXplOiAxM1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uc2hvd1ZhbGlkYXRpb25FcnJvcnMgPSBmYWxzZTtcclxuICAgICAgICB2bS5raW9zayA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdraW9zaycpID8gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ2tpb3NrJykgOiAnMSc7XHJcbiAgICAgICAgdm0uYXZhaWxhYmxlS2lvc2tzID0gWycxJywgJzInLCAnMycsICc0J107XHJcblxyXG4gICAgICAgICQuY29ubmVjdGlvbi5odWIuc3RhcnQoKS5kb25lKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ2h1YiBjb25uZWN0aW9uIHN1Y2Nlc3NmdWwnKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgdm0udG9nZ2xlTmFtZSA9IGZ1bmN0aW9uIChwZXJzb24pIHtcclxuICAgICAgICAgICAgaWYgKHByZXZTZWxlY3Rpb24pIHtcclxuICAgICAgICAgICAgICAgIHByZXZTZWxlY3Rpb24uJHNlbGVjdGVkID0gZmFsc2U7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHByZXZTZWxlY3Rpb24gPT09IHBlcnNvbikge1xyXG4gICAgICAgICAgICAgICAgcGVyc29uLiRzZWxlY3RlZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgdm0ucGVyc29uID0gdW5kZWZpbmVkO1xyXG4gICAgICAgICAgICAgICAgcHJldlNlbGVjdGlvbiA9IG51bGw7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBwZXJzb24uJHNlbGVjdGVkID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHZtLnBlcnNvbiA9IHBlcnNvbjtcclxuICAgICAgICAgICAgICAgIHByZXZTZWxlY3Rpb24gPSBwZXJzb247XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNldEZvY3VzID0gZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAgICAgICAgIHZtLmVkaXRJdGVtID0gZXZlbnQ7XHJcblxyXG4gICAgICAgICAgICBpZiAoZXZlbnQpIHZtLmVkaXRJdGVtID0gZXZlbnQ7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ua2V5Ym9hcmRJbnB1dCA9IGZ1bmN0aW9uIChrZXkpIHtcclxuICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICB2bS5zaG93VmFsaWRhdGlvbkVycm9ycyA9IHRydWU7XHJcbiAgICAgICAgICAgIHZhciBrZXlDb2RlID0ga2V5LmN1cnJlbnRUYXJnZXQub3V0ZXJUZXh0O1xyXG4gICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gJ1NQQUNFJykge1xyXG4gICAgICAgICAgICAgICAgdm0ubGFzdExldHRlcklzU3BhY2UgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBpZiAoa2V5Q29kZSA9PT0gJ0RFTCcpIHtcclxuICAgICAgICAgICAgICAgIHZtLmVkaXRJdGVtLiRzZXRWaWV3VmFsdWUodm0uZWRpdEl0ZW0uJHZpZXdWYWx1ZS5zdWJzdHIoMCwgdm0uZWRpdEl0ZW0uJHZpZXdWYWx1ZS5sZW5ndGggLSAxKSk7XHJcbiAgICAgICAgICAgICAgICB2bS5lZGl0SXRlbS4kcmVuZGVyKCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmICh2bS5sYXN0TGV0dGVySXNTcGFjZSkge1xyXG4gICAgICAgICAgICAgICAgdm0uZWRpdEl0ZW0uJHNldFZpZXdWYWx1ZSh2bS5lZGl0SXRlbS4kdmlld1ZhbHVlICsgJyAnICsga2V5Q29kZSk7XHJcbiAgICAgICAgICAgICAgICB2bS5sYXN0TGV0dGVySXNTcGFjZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdm0uZWRpdEl0ZW0uJHNldFZpZXdWYWx1ZSh2bS5lZGl0SXRlbS4kdmlld1ZhbHVlICsga2V5Q29kZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdm0uZWRpdEl0ZW0uJHJlbmRlcigpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnBhZ2VkID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBwcmV2U2VsZWN0aW9uID0gbnVsbDtcclxuICAgICAgICAgICAgdm0uc2VhcmNoTmFtZSh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51cGRhdGVLaW9zayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ2NoYW5nZWQga2lvc2snLCB2bS5raW9zayk7XHJcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdraW9zaycsIHZtLmtpb3NrKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2hOYW1lID0gZnVuY3Rpb24gKHRhYmxlU3RhdGUpIHtcclxuICAgICAgICAgICAgdGFibGVTdGF0ZVJlZiA9IHRhYmxlU3RhdGU7XHJcblxyXG4gICAgICAgICAgICBpZiAodm0uc2VhcmNoRm9ybSAhPT0gdW5kZWZpbmVkICYmIHZtLnNlYXJjaEZvcm0uJGludmFsaWQpIHtcclxuICAgICAgICAgICAgICAgIHZtLnNob3dWYWxpZGF0aW9uRXJyb3JzID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB2YXIgbmFtZXMgPSB2bS5zZWFyY2hUZXJtLnNwbGl0KCcgJyk7XHJcbiAgICAgICAgICAgIHZhciBmbiA9IG5hbWVzWzFdID8gbmFtZXNbMF0gOiAnJztcclxuICAgICAgICAgICAgdmFyIGxuID0gbmFtZXNbMV0gfHwgbmFtZXNbMF07XHJcblxyXG4gICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5maXJzdG5hbWUgPSBmbjtcclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwubGFzdG5hbWUgPSBsbjtcclxuICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwub3JkZXJCeSA9ICdmaXJzdG5hbWUnO1xyXG5cclxuICAgICAgICAgICAgcGVvcGxlU2VydmljZS5xdWVyeSh2bS5zZWFyY2hNb2RlbClcclxuICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICB2bS5wZW9wbGUgPSBkYXRhLml0ZW1zO1xyXG4gICAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IGRhdGE7XHJcblxyXG4gICAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUubGlzdCcpXHJcbiAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZ29CYWNrID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICByZXNldFRpbWVyKCk7XHJcbiAgICAgICAgICAgIGhpc3RvcnkuYmFjaygpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmdvdG9QbGVkZ2UgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIGlmICh2bS5jcmVhdGVGb3JtLiRpbnZhbGlkKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zaG93VmFsaWRhdGlvbkVycm9ycyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB0b2FzdHIuZXJyb3IoJ1BsZWFzZSBjb3JyZWN0IHlvdXIgaW5mb3JtYXRpb24nKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgdm0ucGVyc29uLmRhdGVDcmVhdGVkID0gbW9tZW50KCkuZm9ybWF0KCdNTS9ERC9ZWVlZIEhIOm1tOnNzJyk7XHJcbiAgICAgICAgICAgIHZtLnBlcnNvbi5pc0Rvbm9yID0gdm0ucGVyc29uLmlzUHJpb3JpdHkgPSBmYWxzZTtcclxuICAgICAgICAgICAgdm0ucGVyc29uLmZpcnN0bmFtZSA9IEh1bWFuaXplLnRpdGxlQ2FzZSh2bS5wZXJzb24uZmlyc3RuYW1lLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICB2bS5wZXJzb24ubGFzdG5hbWUgPSBIdW1hbml6ZS50aXRsZUNhc2Uodm0ucGVyc29uLmxhc3RuYW1lLnRvTG93ZXJDYXNlKCkpO1xyXG4gICAgICAgICAgICB2bS5wZXJzb24uZnV6enlNYXRjaFZhbHVlID0gbWF0Y2hWYWx1ZSh2bS5wZXJzb24pO1xyXG4gICAgICAgICAgICBpZiAodm0ucGVyc29uLmVtYWlsQWRkcmVzcykgdm0ucGVyc29uLmVtYWlsQWRkcmVzcyA9IHZtLnBlcnNvbi5lbWFpbEFkZHJlc3MudG9Mb3dlckNhc2UoKTtcclxuXHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZS5wbGVkZ2UnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJlc2V0VGltZXIoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmdvdG9TZWFyY2ggPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZS5zZWFyY2gnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnNob3dWYWxpZGF0aW9uRXJyb3JzID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZWRpdEl0ZW0gPSB2bS5zZWFyY2hGb3JtLnNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZ290b0NyZWF0ZSA9IGZ1bmN0aW9uIGdvdG9DcmVhdGUoKSB7XHJcbiAgICAgICAgICAgICRzdGF0ZS5nbygnaG9tZS5jcmVhdGUnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmVkaXRJdGVtID0gdm0uY3JlYXRlRm9ybS5maXJzdG5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2hvd1ZhbGlkYXRpb25FcnJvcnMgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgICAgICB2bS5wZXJzb24gPSB7IGZpcnN0bmFtZTogJycsIGxhc3RuYW1lOiAnJyB9O1xyXG4gICAgICAgICAgICAgICAgICAgIGNyZWF0ZVZhbGlkYXRpb25XYXRjaGVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmVzZXRUaW1lcigpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uY2FuY2VsID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5wZXJzb24gPSB7IGZpcnN0bmFtZTogJycsIGxhc3RuYW1lOiAnJyB9O1xyXG4gICAgICAgICAgICB2bS5zZWFyY2hUZXJtID0gJyc7XHJcbiAgICAgICAgICAgIHZtLnBlb3BsZSA9IFtdO1xyXG5cclxuICAgICAgICAgICAgJHN0YXRlLmdvKCdob21lJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAkdGltZW91dC5jYW5jZWwodGltZXIpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZmluaXNoID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUuZmluaXNoJylcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnc2VuZGluZyB0byBodWInKTtcclxuICAgICAgICAgICAgICAgICAgICBodWIuc2VydmVyLmFkZE5hbWUodm0ua2lvc2ssIHZtLnBlcnNvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ1NlbnQgcGVyc29uIHRvIFdPVCcsIHZtLnBlcnNvbik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXNldFRpbWVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgcGVvcGxlU2VydmljZS5jcmVhdGUodm0ucGVyc29uKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5maW5pc2goKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnVubG9ja1NldHRpbmdzID0gZnVuY3Rpb24gKGtleSkge1xyXG4gICAgICAgICAgICBsb2dnZXIuaW5mbygna2V5Q29kZScsIGtleUNvZGUsIGZhbHNlKTtcclxuICAgICAgICAgICAgaWYgKGtleUNvZGUubGVuZ3RoID4gNCkge1xyXG4gICAgICAgICAgICAgICAga2V5Q29kZSA9IGtleTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGtleUNvZGUgKz0ga2V5LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIGlmIChrZXlDb2RlID09PSAnMTInKSB7XHJcbiAgICAgICAgICAgICAgICAkc3RhdGUuZ28oJ2hvbWUuY29uZmlnJylcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGtleUNvZGUgPSAnJztcclxuICAgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oJ2N1cnJlbnQga2lvc2snLCB2bS5raW9zayk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlQ29uZmlnID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25maWd1cmF0aW9uU2VydmljZS51cGRhdGUodm0uY29uZmlnKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5jb25maWcgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHRvYXN0ci5zdWNjZXNzKCdTZXR0aW5ncyBTYXZlZCEnKTtcclxuICAgICAgICAgICAgICAgICAgICBodWIuc2VydmVyLmNvbmZpZ3VyYXRpb25DaGFuZ2Uodm0uY29uZmlnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbygnQ2hhbmdlcyBzYXZlZCBhbmQgc2VudCB0byBXT1QnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBtYXRjaFZhbHVlKHBlcnNvbikge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAwLjA7XHJcbiAgICAgICAgICAgIHZhciBmbiA9IGdldEZ1bGxOYW1lKHBlcnNvbik7XHJcblxyXG4gICAgICAgICAgICBfLmZvckVhY2goY2Vuc29ycywgZnVuY3Rpb24gKGNlbnNvcikge1xyXG4gICAgICAgICAgICAgICAgdmFyIGlkeCA9IGNsal9mdXp6eS5tZXRyaWNzLmRpY2UoZm4sIGNlbnNvci53b3JkKTtcclxuICAgICAgICAgICAgICAgIGlmIChpZHggPiB2YWx1ZSkgdmFsdWUgPSBpZHg7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm4gdmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0RnVsbE5hbWUocGVyc29uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBwZXJzb24uZmlyc3RuYW1lICsgJyAnICsgcGVyc29uLmxhc3RuYW1lO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVzZXRUaW1lcigpIHtcclxuICAgICAgICAgICAgJHRpbWVvdXQuY2FuY2VsKHRpbWVyKTtcclxuICAgICAgICAgICAgdGltZXIgPSAkdGltZW91dChmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5jYW5jZWwoKTtcclxuICAgICAgICAgICAgfSwgd2FpdFRpbWUpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZVZhbGlkYXRpb25XYXRjaGVyKCkge1xyXG4gICAgICAgICAgICAvL2xvZ2dlci5pbmZvKCdjcmVhdGluZyB3YXRjaGVyJywgdm0ucGVyc29uLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICRzY29wZS4kd2F0Y2hDb2xsZWN0aW9uKCd2bS5wZXJzb24nLCBmdW5jdGlvbiAobmV3VmFsLCBvbGRWYWwpIHtcclxuICAgICAgICAgICAgICAgIGlmICh2bS5wZXJzb24pIHtcclxuICAgICAgICAgICAgICAgICAgICByZXNldFRpbWVyKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIHZhbGlkID0gdmFsaWRhdGVQZXJzb24odm0ucGVyc29uKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodm0uY3JlYXRlRm9ybSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2bS5jcmVhdGVGb3JtLmZpcnN0bmFtZS4kc2V0VmFsaWRpdHkoJ2JsYWNrbGlzdCcsIHZhbGlkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdm0uY3JlYXRlRm9ybS5sYXN0bmFtZS4kc2V0VmFsaWRpdHkoJ2JsYWNrbGlzdCcsIHZhbGlkKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHZhbGlkYXRlUGVyc29uKHBlcnNvbikge1xyXG4gICAgICAgICAgICB2YXIgZnVsbE5hbWUgPSAocGVyc29uLmZpcnN0bmFtZSA/IHBlcnNvbi5maXJzdG5hbWUgOiAnJykgKyAnICcgKyAocGVyc29uLmxhc3RuYW1lID8gcGVyc29uLmxhc3RuYW1lIDogJycpO1xyXG4gICAgICAgICAgICB2YXIgZmlyc3RtYXRjaCA9IGNlbnNvcnMuc29tZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS53b3JkLnRvVXBwZXJDYXNlKCkgPT09IChwZXJzb24uZmlyc3RuYW1lID8gcGVyc29uLmZpcnN0bmFtZS50b1VwcGVyQ2FzZSgpIDogJycpOyB9KTtcclxuICAgICAgICAgICAgdmFyIGxhc3RtYXRjaCA9IGNlbnNvcnMuc29tZShmdW5jdGlvbiAoZSkgeyByZXR1cm4gZS53b3JkLnRvVXBwZXJDYXNlKCkgPT09IChwZXJzb24ubGFzdG5hbWUgPyBwZXJzb24ubGFzdG5hbWUudG9VcHBlckNhc2UoKSA6ICcnKTsgfSk7XHJcbiAgICAgICAgICAgIHZhciBmdWxsbWF0Y2ggPSBjZW5zb3JzLnNvbWUoZnVuY3Rpb24gKGUpIHsgcmV0dXJuIGUud29yZC50b1VwcGVyQ2FzZSgpID09PSBmdWxsTmFtZS50b1VwcGVyQ2FzZSgpOyB9KTtcclxuXHJcbiAgICAgICAgICAgIHZhciBtYXRjaCA9IGZpcnN0bWF0Y2ggfHwgbGFzdG1hdGNoIHx8IGZ1bGxtYXRjaDtcclxuICAgICAgICAgICAgcmV0dXJuICFtYXRjaDtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL21hcmsubGF3cmVuY2VcclxuLy9uYXYuanNcclxuXHJcbihmdW5jdGlvbiAoKSB7XHJcbiAgICAndXNlIHN0cmljdCc7XHJcblxyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdOYXZDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInXTtcclxuXHJcbiAgICBmdW5jdGlvbiBtYWluQ29udHJvbGxlcihsb2dnZXIpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG5cclxuICAgICAgICBhY3RpdmF0ZSgpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBhY3RpdmF0ZSgpIHtcclxuICAgICAgICAgICAgbG9nZ2VyLmxvZyhjb250cm9sbGVySWQgKyAnIGFjdGl2YXRlZCcpO1xyXG4gICAgICAgICAgICB2bS51c2VyID0gSlNPTi5wYXJzZShsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY3VycmVudFVzZXInKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufSkoKTsiLCIvL21hbmFnZXIuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGNvbnRyb2xsZXJJZCA9ICdQZW9wbGVDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnBlb3BsZScpLmNvbnRyb2xsZXIoY29udHJvbGxlcklkLCBQZW9wbGVDb250cm9sbGVyKTtcclxuXHJcbiAgICBQZW9wbGVDb250cm9sbGVyLiRpbmplY3QgPSBbJ2xvZ2dlcicsICdwZW9wbGVTZXJ2aWNlJywgJyR1aWJNb2RhbCcsICdjb25maWcnXTtcclxuXHJcbiAgICBmdW5jdGlvbiBQZW9wbGVDb250cm9sbGVyKGxvZ2dlciwgc2VydmljZSwgJG1vZGFsLCBjb25maWcpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIHZhciBrZXlDb2RlcyA9IGNvbmZpZy5rZXlDb2RlcztcclxuXHJcbiAgICAgICAgdm0udGl0bGUgPSBcIlBlb3BsZSBNYW5hZ2VyXCI7XHJcblxyXG4gICAgICAgIHZtLmN1cnJlbnRFZGl0ID0gbnVsbDtcclxuICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG5cclxuICAgICAgICB2bS5wZW9wbGUgPSBbXTtcclxuICAgICAgICB2bS5zZWFyY2hNb2RlbCA9IHtcclxuICAgICAgICAgICAgcGFnZTogMSxcclxuICAgICAgICAgICAgcGFnZVNpemU6IDE1LFxyXG4gICAgICAgICAgICBvcmRlckJ5OiAnRmlyc3RuYW1lJyxcclxuICAgICAgICAgICAgb3JkZXJEaXJlY3Rpb246ICdkZXNjJ1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgdm0uc2VhcmNoVGVybSA9ICcnO1xyXG5cclxuICAgICAgICB2YXIgdGFibGVTdGF0ZVJlZjtcclxuXHJcbiAgICAgICAgYWN0aXZhdGUoKTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYWN0aXZhdGUoKSB7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coY29udHJvbGxlcklkICsgJyBhY3RpdmF0ZWQnKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5hZGRJdGVtID0gZnVuY3Rpb24gYWRkSXRlbSgpIHtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wZW9wbGUvdmlld3MvcGVyc29uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgLy9jb250cm9sbGVyOiBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdwZW9wbGVTZXJ2aWNlJywgJ2l0ZW0nLCAndm0nLCAnc3RvcmFnZScsIGVkaXRQZXJzb25Db250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3Blb3BsZVNlcnZpY2UnLCAndm0nLCAnc3RvcmFnZScsIGVkaXRQZXJzb25Db250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB2bTogdm1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5yZXN1bHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBlb3BsZS51bnNoaWZ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgY3JlYXRlZCAnICsgZ2V0RnVsbE5hbWUoZGF0YSkpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZWRpdEl0ZW0gPSBmdW5jdGlvbiBlZGl0SXRlbShpdGVtKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0ID0gaXRlbTtcclxuICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5sYXN0VXBkYXRlZCA9IG51bGw7XHJcbiAgICAgICAgICAgICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL2FwcC9wZW9wbGUvdmlld3MvcGVyc29uLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgLy9jb250cm9sbGVyOiBbJ2xvZ2dlcicsICckdWliTW9kYWxJbnN0YW5jZScsICdwZW9wbGVTZXJ2aWNlJywgJ2l0ZW0nLCAndm0nLCAnc3RvcmFnZScsIGVkaXRQZXJzb25Db250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6IFsnbG9nZ2VyJywgJyR1aWJNb2RhbEluc3RhbmNlJywgJ3Blb3BsZVNlcnZpY2UnLCAndm0nLCAnc3RvcmFnZScsIGVkaXRQZXJzb25Db250cm9sbGVyXSxcclxuICAgICAgICAgICAgICAgIGNvbnRyb2xsZXJBczogJ3ZtJyxcclxuICAgICAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgICAgICB2bTogdm1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5yZXN1bHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RVcGRhdGVkID0gYW5ndWxhci5jb3B5KHZtLmN1cnJlbnRFZGl0KTtcclxuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmV4dGVuZChpdGVtLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuc3VjY2VzcygnU3VjY2Vzc2Z1bGx5IHVwZGF0ZWQgJyArIGdldEZ1bGxOYW1lKGRhdGEpKTtcclxuICAgICAgICAgICAgICAgIH0pLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0ID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmRlbGV0ZUl0ZW0gPSBmdW5jdGlvbiBkZWxldGVJdGVtKHBlcnNvbikge1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnJlbW92ZShwZXJzb24uaWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3REZWxldGVkID0gcGVyc29uO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBpZHggPSB2bS5wZW9wbGUuaW5kZXhPZihwZXJzb24pO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBlb3BsZS5zcGxpY2UoaWR4LCAxKTtcclxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZygnRGVsZXRlZCBwZXJzb24gJyArIHBlcnNvbi5maXJzdG5hbWUgKyAnICcgKyBwZXJzb24ubGFzdG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udW5kb0RlbGV0ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0ubGFzdERlbGV0ZWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEuZmlyc3RuYW1lICsgJyAnICsgZGF0YS5sYXN0bmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ucGVvcGxlLnVuc2hpZnQoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0udW5kb0NoYW5nZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0ubGFzdFVwZGF0ZWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS5wZW9wbGUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh1LCBpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAodS5pZCA9PT0gdm0ubGFzdFVwZGF0ZWQuaWQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB2bS5wZW9wbGVbaV0gPSB2bS5sYXN0VXBkYXRlZDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCAnICsgdm0ubGFzdFVwZGF0ZWQuZmlyc3RuYW1lICsgJyAnICsgdm0ubGFzdFVwZGF0ZWQubGFzdG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnNlYXJjaCA9IGZ1bmN0aW9uIHNlYXJjaCh0YWJsZVN0YXRlKSB7XHJcbiAgICAgICAgICAgIHRhYmxlU3RhdGVSZWYgPSB0YWJsZVN0YXRlO1xyXG5cclxuICAgICAgICAgICAgaWYgKCF2bS5zZWFyY2hNb2RlbC5pc1ByaW9yaXR5KSB2bS5zZWFyY2hNb2RlbC5pc1ByaW9yaXR5ID0gbnVsbDtcclxuXHJcbiAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmRhdGVDcmVhdGVkID0gdm0uZGF5c0ZpbHRlclxyXG4gICAgICAgICAgICAgICAgPyBtb21lbnQoKS5zdWJ0cmFjdChwYXJzZUludCh2bS5kYXlzRmlsdGVyKSwgJ2RheXMnKS5mb3JtYXQoJ01NL0REL1lZWVknKVxyXG4gICAgICAgICAgICAgICAgOiBudWxsO1xyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNvcnQucHJlZGljYXRlKSAhPSBcInVuZGVmaW5lZFwiKSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5vcmRlckJ5ID0gdGFibGVTdGF0ZS5zb3J0LnByZWRpY2F0ZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLm9yZGVyRGlyZWN0aW9uID0gdGFibGVTdGF0ZS5zb3J0LnJldmVyc2UgPyAnZGVzYycgOiAnYXNjJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9IFwidW5kZWZpbmVkXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZnV6enlNYXRjaFZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uZnV6enlNYXRjaFZhbHVlID0gbnVsbDtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5mdXp6eU1hdGNoVmFsdWUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuZnV6enlNYXRjaFZhbHVlIC8gMTAwO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5mdXp6eU1hdGNoVmFsdWUgPSB2bS5mdXp6eU1hdGNoVmFsdWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICAgICAgdm0uZGF5c0ZpbHRlciA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5kYXRlQ3JlYXRlZCA/IG51bGwgOiB2bS5kYXlzRmlsdGVyO1xyXG4gICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwuZGF0ZUNyZWF0ZWQgPSB2bS5kYXlzRmlsdGVyXHJcbiAgICAgICAgICAgICAgICAgICAgPyB2bS5zZWFyY2hNb2RlbC5kYXRlQ3JlYXRlZFxyXG4gICAgICAgICAgICAgICAgICAgIDogdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmRhdGVDcmVhdGVkO1xyXG5cclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmlzRG9ub3IgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuaXNEb25vcjtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmZpcnN0bmFtZSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5maXJzdG5hbWU7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5sYXN0bmFtZSA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5sYXN0bmFtZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLnppcGNvZGUgPSB0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QuemlwQ29kZTtcclxuICAgICAgICAgICAgICAgIHZtLnNlYXJjaE1vZGVsLmVtYWlsQWRkcmVzcyA9IHRhYmxlU3RhdGUuc2VhcmNoLnByZWRpY2F0ZU9iamVjdC5lbWFpbEFkZHJlc3M7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5pc1ByaW9yaXR5ID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LmlzUHJpb3JpdHk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB2bS5zZWFyY2hNb2RlbC5mdXp6eU1hdGNoVmFsdWUgPSB2bS5mdXp6eU1hdGNoVmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucXVlcnkodm0uc2VhcmNoTW9kZWwpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnBlb3BsZSA9IGRhdGEuaXRlbXM7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uc2VhcmNoTW9kZWwgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ucGFnZWQgPSBmdW5jdGlvbiBwYWdlZChwYWdlTnVtKSB7XHJcbiAgICAgICAgICAgIHZtLmxhc3REZWxldGVkID0gbnVsbDtcclxuICAgICAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB2bS5zZWFyY2godGFibGVTdGF0ZVJlZik7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0ucXVpY2tGaWx0ZXIgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZtLnNlYXJjaCh0YWJsZVN0YXRlUmVmKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRGdWxsTmFtZShwZXJzb24pIHtcclxuICAgICAgICAgICAgcmV0dXJuIHBlcnNvbi5maXJzdG5hbWUgKyAnICcgKyBwZXJzb24ubGFzdG5hbWU7XHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBlZGl0UGVyc29uQ29udHJvbGxlcihsb2dnZXIsICRtb2RhbCwgc2VydmljZSwgbW9kZWwsIHN0b3JhZ2UpIHtcclxuICAgICAgICB2YXIgdm0gPSB0aGlzO1xyXG4gICAgICAgIC8vVE9ETzogQ2FuIGJlIG1hZGUgZ2xvYmFsPz9cclxuICAgICAgICB2YXIgY2Vuc29ycyA9IEpTT04ucGFyc2Uoc3RvcmFnZS5nZXQoJ2NlbnNvcnMnKSk7XHJcblxyXG4gICAgICAgIHZtLml0ZW0gPSBhbmd1bGFyLmNvcHkobW9kZWwuY3VycmVudEVkaXQpO1xyXG5cclxuICAgICAgICB2bS5jbG9zZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgJG1vZGFsLmRpc21pc3MoKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5tYXRjaFZhbHVlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAwLjA7XHJcbiAgICAgICAgICAgIHZhciBmbiA9IGdldEZ1bGxOYW1lKHZtLml0ZW0pO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKGNlbnNvcnMsXHJcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoY2Vuc29yKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IGNsal9mdXp6eS5tZXRyaWNzLmRpY2UoZm4sIGNlbnNvci53b3JkKTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoaWR4ID4gdmFsdWUpIHZhbHVlID0gaWR4O1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHZtLml0ZW0uZnV6enlNYXRjaFZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uc2F2ZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgaWYgKHZtLml0ZW0uaWQpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZpY2UudXBkYXRlKHZtLml0ZW0pXHJcbiAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgJG1vZGFsLmNsb3NlKGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0uaXRlbSlcclxuICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAkbW9kYWwuY2xvc2UoZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBnZXRGdWxsTmFtZShpdGVtKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpdGVtLmZpcnN0bmFtZSArICcgJyArIGl0ZW0ubGFzdG5hbWU7XHJcbiAgICAgICAgfTtcclxuICAgIH07XHJcbn0pKCk7IiwiLy9tYXJrLmxhd3JlbmNlXHJcbi8vcHJvZmlsZS5qc1xyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ1Byb2ZpbGVDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIG1haW5Db250cm9sbGVyKTtcclxuXHJcbiAgICBtYWluQ29udHJvbGxlci4kaW5qZWN0ID0gWyckc2NvcGUnLCAnJGh0dHAnLCAnbG9nZ2VyJywgJ3VzZXJTZXJ2aWNlJywgJ2RlZmF1bHRzJywgJ2NvbmZpZycsICckcm9vdFNjb3BlJ107XHJcblxyXG4gICAgZnVuY3Rpb24gbWFpbkNvbnRyb2xsZXIoJHNjb3BlLCAkaHR0cCwgbG9nZ2VyLCBzZXJ2aWNlLCBkZWZhdWx0cywgY29uZmlnLCAkcm9vdFNjb3BlKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdQcm9maWxlIE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gJ1VwZGF0ZSB5b3VyIHByb2ZpbGUnO1xyXG5cclxuICAgICAgICB2bS51c2VyID0ge307XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIHZtLnVzZXIgPSBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50VXNlcicpKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5maWxlU2VsZWN0ZWQgPSBmdW5jdGlvbiAoJGZpbGVzLCAkZmlsZSwgJGV2ZW50LCAkcmVqZWN0ZWRGaWxlcykge1xyXG4gICAgICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uIChlKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgZGF0YVVSTCA9IHJlYWRlci5yZXN1bHQ7XHJcbiAgICAgICAgICAgICAgICB2bS51c2VyLnVzZXJQaG90byA9IGRhdGFVUkwuc3BsaXQoJywnKVsxXTtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXIudXNlclBob3RvVHlwZSA9ICRmaWxlLnR5cGU7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgIHJlYWRlci5yZWFkQXNEYXRhVVJMKCRmaWxlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG4gICAgICAgICAgICBzZXJ2aWNlLnVwZGF0ZSh2bS51c2VyKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2VyID0gZGF0YTtcclxuICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY3VycmVudFVzZXInLCBKU09OLnN0cmluZ2lmeSh2bS51c2VyKSk7XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmlzQnVzeSA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmZpbGUgPSBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLnByb2ZpbGVGb3JtLiRzZXRQcmlzdGluZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmF2YXRhckZvcm0uJHNldFByaXN0aW5lKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG4gICAgfTtcclxufSkoKTsiLCIvL2NlbnNvci5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ2NlbnNvclNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkJyk7XHJcbiAgICAgICAgdmFyIHVybCA9IGNvbmZpZy5hcGlVcmwgKyBjb25maWcuYXBpRW5kUG9pbnRzLkNlbnNvcjtcclxuXHJcbiAgICAgICAgdmFyIHNlcnZpY2UgPSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZTogY3JlYXRlLFxyXG4gICAgICAgICAgICBnZXQ6IGdldCxcclxuICAgICAgICAgICAgcXVlcnk6IHF1ZXJ5LFxyXG4gICAgICAgICAgICB1cGRhdGU6IHVwZGF0ZSxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmVcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKGNlbnNvcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucG9zdCh1cmwsIGNlbnNvcikudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkoc2VhcmNoVGVybSkge1xyXG4gICAgICAgICAgICBpZiAoc2VhcmNoVGVybSA9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBnZXQoKTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy8/c2VhcmNoPScgKyBzZWFyY2hUZXJtKS50aGVuKF9zdWNjZXNzKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIHVwZGF0ZShjZW5zb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnB1dCh1cmwsIGNlbnNvcikudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsICsgJy8nICsgaWQpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9zdWNjZXNzKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIHJldHVybiByZXNwb25zZS5kYXRhO1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbn0pKCk7IiwiLy9jb25maWd1cmF0aW9uLnNlcnZpY2UuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAnY29uZmlndXJhdGlvblNlcnZpY2UnO1xyXG4gICAgYW5ndWxhci5tb2R1bGUoJ2FwcC5zZXJ2aWNlJykuZmFjdG9yeShzZXJ2aWNlSWQsIHNlcnZpY2VDb250cm9sbGVyKTtcclxuXHJcbiAgICBmdW5jdGlvbiBzZXJ2aWNlQ29udHJvbGxlcihsb2dnZXIsICRodHRwLCBjb25maWcpIHtcclxuICAgICAgICBsb2dnZXIubG9nKHNlcnZpY2VJZCArICcgbG9hZGVkICcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5Db25maWd1cmF0aW9uO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUoY29uZmlnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBjb25maWcpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3N1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vcGVvcGxlLnNlcnZpY2UuanNcclxuLy9tYXJrLmxhd3JlbmNlXHJcblxyXG4oZnVuY3Rpb24gKCkge1xyXG4gICAgJ3VzZSBzdHJpY3QnO1xyXG5cclxuICAgIHZhciBzZXJ2aWNlSWQgPSAncGVvcGxlU2VydmljZSc7XHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnNlcnZpY2UnKS5mYWN0b3J5KHNlcnZpY2VJZCwgc2VydmljZUNvbnRyb2xsZXIpO1xyXG5cclxuICAgIGZ1bmN0aW9uIHNlcnZpY2VDb250cm9sbGVyKGxvZ2dlciwgJGh0dHAsIGNvbmZpZywgZXhjZXB0aW9uKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5QZXJzb247XHJcblxyXG4gICAgICAgIHZhciBzZXJ2aWNlID0ge1xyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgdXBkYXRlOiB1cGRhdGUsXHJcbiAgICAgICAgICAgIHJlbW92ZTogcmVtb3ZlLFxyXG4gICAgICAgICAgICBnZXRDdXJyZW50U3RhdHM6IGdldEN1cnJlbnRTdGF0c1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHNlcnZpY2U7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGNyZWF0ZShjZW5zb3IpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCBjZW5zb3IpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0KCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybClcclxuICAgICAgICAgICAgICAgIC50aGVuKF9zdWNjZXNzKVxyXG4gICAgICAgICAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChtZXNzYWdlKSB7IGV4Y2VwdGlvbi5jYXRjaGVyKCdGYWlsZWQgdG8gcmV0cmlldmUgcGVvcGxlJykobWVzc2FnZSk7IH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkoc2VhcmNoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wb3N0KHVybCArICcvc2VhcmNoJywgc2VhcmNoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oX3N1Y2Nlc3MpXHJcbiAgICAgICAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKG1lc3NhZ2UpIHsgZXhjZXB0aW9uLmNhdGNoZXIoJ0ZhaWxlZCB0byByZXRyaWV2ZSBwZW9wbGUnKShtZXNzYWdlKTsgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUocGVyc29uKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5wdXQodXJsLCBwZXJzb24pLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlKGlkKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5kZWxldGUodXJsICsgJy8nICsgaWQpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0Q3VycmVudFN0YXRzKCkge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCArICcvc3RhdCcpXHJcbiAgICAgICAgICAgICAgICAudGhlbihfc3VjY2VzcylcclxuICAgICAgICAgICAgICAgIC5jYXRjaChmdW5jdGlvbiAobWVzc2FnZSkgeyBleGNlcHRpb24uY2F0Y2hlcignRmFpbGVkIHRvIHJldHJpZXZlIHN0YXRzJykobWVzc2FnZSk7IH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gX3N1Y2Nlc3MocmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59KSgpOyIsIi8vdXNlci5zZXJ2aWNlLmpzXHJcbi8vbWFyay5sYXdyZW5jZVxyXG5cclxuKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgc2VydmljZUlkID0gJ3VzZXJTZXJ2aWNlJztcclxuICAgIGFuZ3VsYXIubW9kdWxlKCdhcHAuc2VydmljZScpLmZhY3Rvcnkoc2VydmljZUlkLCBzZXJ2aWNlQ29udHJvbGxlcik7XHJcblxyXG4gICAgZnVuY3Rpb24gc2VydmljZUNvbnRyb2xsZXIobG9nZ2VyLCAkaHR0cCwgY29uZmlnKSB7XHJcbiAgICAgICAgbG9nZ2VyLmxvZyhzZXJ2aWNlSWQgKyAnIGxvYWRlZCcpO1xyXG4gICAgICAgIHZhciB1cmwgPSBjb25maWcuYXBpVXJsICsgY29uZmlnLmFwaUVuZFBvaW50cy5Vc2VyO1xyXG5cclxuICAgICAgICB2YXIgc2VydmljZSA9IHtcclxuICAgICAgICAgICAgYXZhaWxhYmxlUm9sZXM6IGF2YWlsYWJsZVJvbGVzLFxyXG4gICAgICAgICAgICBjcmVhdGU6IGNyZWF0ZSxcclxuICAgICAgICAgICAgZ2V0OiBnZXQsXHJcbiAgICAgICAgICAgIHF1ZXJ5OiBxdWVyeSxcclxuICAgICAgICAgICAgcmVtb3ZlOiByZW1vdmUsXHJcbiAgICAgICAgICAgIHVwZGF0ZTogdXBkYXRlXHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2VydmljZTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gYXZhaWxhYmxlUm9sZXMoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAkaHR0cC5nZXQodXJsICsgJy9yb2xlcycpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gY3JlYXRlKHVzZXIpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLnBvc3QodXJsLCB1c2VyKS50aGVuKF9zdWNjZXNzLCBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ2Vycm9yJywgZXJyb3IpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vVE9ETzogTmVlZCBhIGdldGJ5bmFtZSBmdW5jdGlvblxyXG4gICAgICAgIGZ1bmN0aW9uIGdldCgpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmdldCh1cmwpLnRoZW4oX3N1Y2Nlc3MpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gcXVlcnkoc2VhcmNoVGVybSkge1xyXG4gICAgICAgICAgICB1cmwgKz0gJy9zZWFyY2gvJztcclxuXHJcbiAgICAgICAgICAgIGlmIChzZWFyY2hUZXJtICE9IHVuZGVmaW5lZCAmJiBzZWFyY2hUZXJtLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIHVybCArPSAnPycgKyBzZWFyY2hUZXJtO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAuZ2V0KHVybCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiB1cGRhdGUodXNlcikge1xyXG4gICAgICAgICAgICByZXR1cm4gJGh0dHAucHV0KHVybCwgdXNlcikudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiByZW1vdmUoaWQpIHtcclxuICAgICAgICAgICAgcmV0dXJuICRodHRwLmRlbGV0ZSh1cmwgKyAnLycgKyBpZCkudGhlbihfc3VjY2Vzcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmdW5jdGlvbiBfc3VjY2VzcyhyZXNwb25zZSkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzcG9uc2UuZGF0YTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn0pKCk7IiwiKGZ1bmN0aW9uICgpIHtcclxuICAgICd1c2Ugc3RyaWN0JztcclxuXHJcbiAgICB2YXIgY29udHJvbGxlcklkID0gJ1VzZXJDb250cm9sbGVyJztcclxuXHJcbiAgICBhbmd1bGFyLm1vZHVsZSgnYXBwLnVzZXJzJykuY29udHJvbGxlcihjb250cm9sbGVySWQsIFVzZXJDb250cm9sbGVyKTtcclxuXHJcbiAgICBVc2VyQ29udHJvbGxlci4kaW5qZWN0ID0gWydsb2dnZXInLCAndXNlclNlcnZpY2UnLCAnZGVmYXVsdHMnLCAnY29uZmlnJ107XHJcblxyXG4gICAgZnVuY3Rpb24gVXNlckNvbnRyb2xsZXIobG9nZ2VyLCBzZXJ2aWNlLCBkZWZhdWx0cywgY29uZmlnKSB7XHJcbiAgICAgICAgdmFyIHZtID0gdGhpcztcclxuICAgICAgICB2bS50aXRsZSA9ICdVc2VyIE1hbmFnZXInO1xyXG4gICAgICAgIHZtLmRlc2NyaXB0aW9uID0gJ0VkaXQgYW5kIHVwZGF0ZSB1c2Vycyc7XHJcbiAgICAgICAgdmFyIGtleUNvZGVzID0gY29uZmlnLmtleUNvZGVzO1xyXG5cclxuICAgICAgICB2bS5hdmFpbGFibGVSb2xlcyA9IFtdO1xyXG4gICAgICAgIHZtLmNsZWFyQ3JlYXRlID0gY2xlYXJDcmVhdGU7XHJcbiAgICAgICAgdm0uY3VycmVudEVkaXQgPSB7fTtcclxuICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICB2bS5sYXN0RGVsZXRlZCA9IG51bGw7XHJcbiAgICAgICAgdm0ubGFzdFVwZGF0ZWQgPSBudWxsO1xyXG4gICAgICAgIHZtLml0ZW1Ub0VkaXQgPSB7fTtcclxuXHJcbiAgICAgICAgdm0udXNlciA9IHtcclxuICAgICAgICAgICAgLy91c2VyTmFtZTogbnVsbCxcclxuICAgICAgICAgICAgcm9sZXM6IFsndXNlciddLFxyXG4gICAgICAgICAgICBmdWxsTmFtZTogJycsXHJcbiAgICAgICAgICAgIHBhc3N3b3JkOiBkZWZhdWx0cy5HRU5FUklDX1BBU1NXT1JEXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdmFyIHRhYmxlU3RhdGVSZWY7XHJcblxyXG4gICAgICAgIGFjdGl2YXRlKCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIGFjdGl2YXRlKCkge1xyXG4gICAgICAgICAgICBsb2dnZXIubG9nKGNvbnRyb2xsZXJJZCArICcgYWN0aXZhdGVkJyk7XHJcbiAgICAgICAgICAgIGdldEF2YWlsYWJsZVJvbGVzKCk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uYWRkSXRlbSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgdm0udXNlci5mdWxsTmFtZSA9IHBhcnNlRnVsbE5hbWUodm0udXNlci51c2VyTmFtZSk7XHJcbiAgICAgICAgICAgIHZtLnVzZXIuZW1haWwgPSB2bS51c2VyLnVzZXJOYW1lICsgZGVmYXVsdHMuRU1BSUxfU1VGRklYO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS5jcmVhdGUodm0udXNlcilcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBtYXBwaW5nIHdvdWxkIGFsbG93IHJlbW92YWwgb2YgZXh0ZW5kIG1ldGhvZFxyXG4gICAgICAgICAgICAgICAgICAgIHZtLnVzZXIgPSBhbmd1bGFyLmV4dGVuZCh2bS51c2VyLCBkYXRhKTtcclxuICAgICAgICAgICAgICAgICAgICB2bS51c2Vycy51bnNoaWZ0KGFuZ3VsYXIuY29weSh2bS51c2VyKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1VzZXIgJyArIHZtLnVzZXIudXNlck5hbWUgKyAnIGNyZWF0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlci51c2VyTmFtZSA9IG51bGw7XHJcbiAgICAgICAgICAgICAgICAgICAgLy9UT0RPOiBzaG93IGVycm9yIHVzZXIgYWxyZWFkeSBleGlzdHNcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLmNhbmNlbEVkaXQgPSBmdW5jdGlvbiAoaWQpIHtcclxuICAgICAgICAgICAgdm0uY3VycmVudEVkaXRbaWRdID0gZmFsc2U7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdm0uZGVsZXRlSXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIGFuZ3VsYXIuY29weSh1c2VyLCB2bS5sYXN0RGVsZXRlZCA9IHt9KTtcclxuICAgICAgICAgICAgc2VydmljZS5yZW1vdmUodXNlci5pZClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIGlkeCA9IHZtLnVzZXJzLmluZGV4T2YodXNlcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMuc3BsaWNlKGlkeCwgMSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5lZGl0SXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZtLmN1cnJlbnRFZGl0W3VzZXIuaWRdID0gdHJ1ZTtcclxuICAgICAgICAgICAgYW5ndWxhci5jb3B5KHVzZXIsIHZtLml0ZW1Ub0VkaXQgPSB7fSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gZ2V0QXZhaWxhYmxlUm9sZXMoKSB7XHJcbiAgICAgICAgICAgIHNlcnZpY2UuYXZhaWxhYmxlUm9sZXMoKVxyXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5hdmFpbGFibGVSb2xlcyA9IGRhdGE7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zYXZlSXRlbSA9IGZ1bmN0aW9uICh1c2VyKSB7XHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcblxyXG4gICAgICAgICAgICB2bS5jdXJyZW50RWRpdFt1c2VyLmlkXSA9IGZhbHNlO1xyXG4gICAgICAgICAgICBhbmd1bGFyLmNvcHkodXNlciwgdm0ubGFzdFVwZGF0ZWQgPSB7fSk7XHJcbiAgICAgICAgICAgIGxvZ2dlci5sb2coJ2xhc3RVcGRhdGVkJywgdm0ubGFzdFVwZGF0ZWQpO1xyXG4gICAgICAgICAgICB2YXIgcm9sZXMgPSBbXTtcclxuXHJcbiAgICAgICAgICAgIF8uZm9yRWFjaCh2bS5pdGVtVG9FZGl0LnJvbGVzLFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHJvbGUpIHtcclxuICAgICAgICAgICAgICAgICAgICByb2xlcy5wdXNoKHJvbGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdm0uaXRlbVRvRWRpdC5yb2xlcyA9IHJvbGVzO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0uaXRlbVRvRWRpdClcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5leHRlbmQodXNlciwgZGF0YSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1VzZXIgJyArIGRhdGEudXNlck5hbWUgKyAnIHVwZGF0ZWQhJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS5zZWFyY2ggPSBmdW5jdGlvbiAodGFibGVTdGF0ZSkge1xyXG4gICAgICAgICAgICB0YWJsZVN0YXRlUmVmID0gdGFibGVTdGF0ZTtcclxuICAgICAgICAgICAgdmFyIHNlYXJjaFRlcm07XHJcblxyXG4gICAgICAgICAgICBpZiAodHlwZW9mICh0YWJsZVN0YXRlLnNlYXJjaC5wcmVkaWNhdGVPYmplY3QpICE9ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgICAgICAgICBzZWFyY2hUZXJtID0gdGFibGVTdGF0ZS5zZWFyY2gucHJlZGljYXRlT2JqZWN0LnNlYXJjaFRlcm07XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHZtLmlzQnVzeSA9IHRydWU7XHJcbiAgICAgICAgICAgIHNlcnZpY2UucXVlcnkoc2VhcmNoVGVybSlcclxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0udXNlcnMgPSBkYXRhO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5sb2coJ3VzZXJzJywgdm0udXNlcnMpO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICAgIC5maW5hbGx5KGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICB2bS5pc0J1c3kgPSBmYWxzZTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHZtLnVuZG9EZWxldGUgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHZhciByb2xlcyA9IFtdO1xyXG5cclxuICAgICAgICAgICAgXy5mb3JFYWNoKHZtLmxhc3REZWxldGVkLnJvbGVzLCBmdW5jdGlvbiAocm9sZSkge1xyXG4gICAgICAgICAgICAgICAgcm9sZXMucHVzaChyb2xlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLmxvZygncm9sZScsIHJvbGUubmFtZSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB2bS5sYXN0RGVsZXRlZC5yb2xlcyA9IHJvbGVzO1xyXG4gICAgICAgICAgICB2bS5sYXN0RGVsZXRlZC5wYXNzd29yZCA9IGRlZmF1bHRzLkdFTkVSSUNfUEFTU1dPUkQ7XHJcblxyXG4gICAgICAgICAgICBzZXJ2aWNlLmNyZWF0ZSh2bS5sYXN0RGVsZXRlZCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgbG9nZ2VyLnN1Y2Nlc3MoJ1N1Y2Nlc3NmdWxseSByZXN0b3JlZCAnICsgZGF0YS51c2VyTmFtZSk7XHJcbiAgICAgICAgICAgICAgICB2bS51c2Vycy51bnNoaWZ0KGRhdGEpO1xyXG4gICAgICAgICAgICAgICAgdm0ubGFzdERlbGV0ZWQgPSBudWxsO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB2bS51bmRvQ2hhbmdlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICB2bS5pc0J1c3kgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgc2VydmljZS51cGRhdGUodm0ubGFzdFVwZGF0ZWQpXHJcbiAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCh2bS51c2VycyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gKHUsIGkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICh1LmlkID09PSB2bS5sYXN0VXBkYXRlZC5pZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZtLnVzZXJzW2ldID0gdm0ubGFzdFVwZGF0ZWQ7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5zdWNjZXNzKCdTdWNjZXNzZnVsbHkgcmVzdG9yZWQgJyArIGRhdGEudXNlck5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZtLmxhc3RVcGRhdGVkID0gbnVsbDtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgICAuZmluYWxseShmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdm0uaXNCdXN5ID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBjbGVhckNyZWF0ZSgkZXZlbnQpIHtcclxuICAgICAgICAgICAgaWYgKCRldmVudC5rZXlDb2RlID09PSBrZXlDb2Rlcy5lc2MpIHtcclxuICAgICAgICAgICAgICAgIHZtLnVzZXIudXNlck5hbWUgPSAnJztcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBwYXJzZUZ1bGxOYW1lKG5hbWUpIHtcclxuICAgICAgICAgICAgdmFyIGFyciA9IG5hbWUuc3BsaXQoJy4nKTtcclxuICAgICAgICAgICAgdmFyIGZ1bGxuYW1lID0gJyc7XHJcblxyXG4gICAgICAgICAgICBfLmZvckVhY2goYXJyLCBmdW5jdGlvbiAodikge1xyXG4gICAgICAgICAgICAgICAgZnVsbG5hbWUgKz0gXy5jYXBpdGFsaXplKHYpICsgJyAnO1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIHJldHVybiBfLnRyaW0oZnVsbG5hbWUpO1xyXG4gICAgICAgIH07XHJcbiAgICB9O1xyXG59KSgpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
